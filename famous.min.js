!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require){window.famous={core:{Context:require("./core/Context"),ElementAllocator:require("./core/ElementAllocator"),Engine:require("./core/Engine"),Entity:require("./core/Entity"),EventEmitter:require("./core/EventEmitter"),EventHandler:require("./core/EventHandler"),Group:require("./core/Group"),Modifier:require("./core/Modifier"),OptionsManager:require("./core/OptionsManager"),RenderNode:require("./core/RenderNode"),Scene:require("./core/Scene"),SpecParser:require("./core/SpecParser"),Surface:require("./core/Surface"),Transform:require("./core/Transform"),View:require("./core/View"),ViewSequence:require("./core/ViewSequence")},events:{EventArbiter:require("./events/EventArbiter"),EventFilter:require("./events/EventFilter"),EventMapper:require("./events/EventMapper")},inputs:{FastClick:require("./inputs/FastClick"),GenericSync:require("./inputs/GenericSync"),MouseSync:require("./inputs/MouseSync"),PinchSync:require("./inputs/PinchSync"),RotateSync:require("./inputs/RotateSync"),ScaleSync:require("./inputs/ScaleSync"),ScrollSync:require("./inputs/ScrollSync"),TouchSync:require("./inputs/TouchSync"),TouchTracker:require("./inputs/TouchTracker"),TwoFingerSync:require("./inputs/TwoFingerSync")},math:{Matrix:require("./math/Matrix"),Quaternion:require("./math/Quaternion"),Random:require("./math/Random"),Utilities:require("./math/Utilities"),Vector:require("./math/Vector")},modifiers:{Draggable:require("./modifiers/Draggable"),Fader:require("./modifiers/Fader"),ModifierChain:require("./modifiers/ModifierChain"),StateModifier:require("./modifiers/StateModifier")},physics:{bodies:{Body:require("./physics/bodies/Body"),Circle:require("./physics/bodies/Circle"),Particle:require("./physics/bodies/Particle"),Rectangle:require("./physics/bodies/Rectangle")},constraints:{Collision:require("./physics/constraints/Collision"),Constraint:require("./physics/constraints/Constraint"),Curve:require("./physics/constraints/Curve"),Distance:require("./physics/constraints/Distance"),Snap:require("./physics/constraints/Snap"),Surface:require("./physics/constraints/Surface"),Wall:require("./physics/constraints/Wall"),Walls:require("./physics/constraints/Walls")},forces:{Drag:require("./physics/forces/Drag"),Force:require("./physics/forces/Force"),Repulsion:require("./physics/forces/Repulsion"),RotationalDrag:require("./physics/forces/RotationalDrag"),RotationalSpring:require("./physics/forces/RotationalSpring"),Spring:require("./physics/forces/Spring"),VectorField:require("./physics/forces/VectorField")},integrators:{SymplecticEuler:require("./physics/integrators/SymplecticEuler")},PhysicsEngine:require("./physics/PhysicsEngine")},surfaces:{CanvasSurface:require("./surfaces/CanvasSurface"),ContainerSurface:require("./surfaces/ContainerSurface"),ImageSurface:require("./surfaces/ImageSurface"),InputSurface:require("./surfaces/InputSurface"),VideoSurface:require("./surfaces/VideoSurface")},transitions:{CachedMap:require("./transitions/CachedMap"),Easing:require("./transitions/Easing"),MultipleTransition:require("./transitions/MultipleTransition"),SnapTransition:require("./transitions/SnapTransition"),SpringTransition:require("./transitions/SpringTransition"),Transitionable:require("./transitions/Transitionable"),TransitionableTransform:require("./transitions/TransitionableTransform"),TweenTransition:require("./transitions/TweenTransition"),WallTransition:require("./transitions/WallTransition")},utilities:{KeyCodes:require("./utilities/KeyCodes"),Timer:require("./utilities/Timer"),Utility:require("./utilities/Utility")},views:{Deck:require("./views/Deck"),EdgeSwapper:require("./views/EdgeSwapper"),Flipper:require("./views/Flipper"),GridLayout:require("./views/GridLayout"),HeaderFooterLayout:require("./views/HeaderFooterLayout"),Lightbox:require("./views/Lightbox"),RenderController:require("./views/RenderController"),ScrollContainer:require("./views/ScrollContainer"),Scroller:require("./views/Scroller"),Scrollview:require("./views/ScrollView"),SequentialLayout:require("./views/SequentialLayout")},widgets:{NavigationBar:require("./widgets/NavigationBar"),Slider:require("./widgets/Slider"),TabBar:require("./widgets/TabBar"),ToggleButton:require("./widgets/ToggleButton")}}},{"./core/Context":2,"./core/ElementAllocator":3,"./core/Engine":4,"./core/Entity":5,"./core/EventEmitter":6,"./core/EventHandler":7,"./core/Group":8,"./core/Modifier":9,"./core/OptionsManager":10,"./core/RenderNode":11,"./core/Scene":12,"./core/SpecParser":13,"./core/Surface":14,"./core/Transform":15,"./core/View":16,"./core/ViewSequence":17,"./events/EventArbiter":18,"./events/EventFilter":19,"./events/EventMapper":20,"./inputs/FastClick":21,"./inputs/GenericSync":22,"./inputs/MouseSync":23,"./inputs/PinchSync":24,"./inputs/RotateSync":25,"./inputs/ScaleSync":26,"./inputs/ScrollSync":27,"./inputs/TouchSync":28,"./inputs/TouchTracker":29,"./inputs/TwoFingerSync":30,"./math/Matrix":31,"./math/Quaternion":32,"./math/Random":33,"./math/Utilities":34,"./math/Vector":35,"./modifiers/Draggable":36,"./modifiers/Fader":37,"./modifiers/ModifierChain":38,"./modifiers/StateModifier":39,"./physics/PhysicsEngine":40,"./physics/bodies/Body":41,"./physics/bodies/Circle":42,"./physics/bodies/Particle":43,"./physics/bodies/Rectangle":44,"./physics/constraints/Collision":45,"./physics/constraints/Constraint":46,"./physics/constraints/Curve":47,"./physics/constraints/Distance":48,"./physics/constraints/Snap":49,"./physics/constraints/Surface":50,"./physics/constraints/Wall":51,"./physics/constraints/Walls":52,"./physics/forces/Drag":53,"./physics/forces/Force":54,"./physics/forces/Repulsion":55,"./physics/forces/RotationalDrag":56,"./physics/forces/RotationalSpring":57,"./physics/forces/Spring":58,"./physics/forces/VectorField":59,"./physics/integrators/SymplecticEuler":60,"./surfaces/CanvasSurface":61,"./surfaces/ContainerSurface":62,"./surfaces/ImageSurface":63,"./surfaces/InputSurface":64,"./surfaces/VideoSurface":65,"./transitions/CachedMap":66,"./transitions/Easing":67,"./transitions/MultipleTransition":68,"./transitions/SnapTransition":69,"./transitions/SpringTransition":70,"./transitions/Transitionable":71,"./transitions/TransitionableTransform":72,"./transitions/TweenTransition":73,"./transitions/WallTransition":74,"./utilities/KeyCodes":75,"./utilities/Timer":76,"./utilities/Utility":77,"./views/Deck":78,"./views/EdgeSwapper":79,"./views/Flipper":80,"./views/GridLayout":81,"./views/HeaderFooterLayout":82,"./views/Lightbox":83,"./views/RenderController":84,"./views/ScrollContainer":85,"./views/ScrollView":86,"./views/Scroller":87,"./views/SequentialLayout":89,"./widgets/NavigationBar":90,"./widgets/Slider":91,"./widgets/TabBar":92,"./widgets/ToggleButton":93}],2:[function(require,module){function _getElementSize(element){return[element.clientWidth,element.clientHeight]}function Context(container){this.container=container,this._allocator=new ElementAllocator(container),this._node=new RenderNode,this._eventOutput=new EventHandler,this._size=_getElementSize(this.container),this._perspectiveState=new Transitionable(0),this._perspective=void 0,this._nodeContext={allocator:this._allocator,transform:Transform.identity,opacity:1,origin:_originZeroZero,size:this._size},this._eventOutput.on("resize",function(){this.setSize(_getElementSize(this.container))}.bind(this))}var RenderNode=require("./RenderNode"),EventHandler=require("./EventHandler"),ElementAllocator=require("./ElementAllocator"),Transform=require("./Transform"),Transitionable=require("../transitions/Transitionable"),_originZeroZero=[0,0];Context.prototype.getAllocator=function(){return this._allocator},Context.prototype.add=function(obj){return this._node.add(obj)},Context.prototype.migrate=function(container){container!==this.container&&(this.container=container,this._allocator.migrate(container))},Context.prototype.getSize=function(){return this._size},Context.prototype.setSize=function(size){size||(size=_getElementSize(this.container)),this._size[0]=size[0],this._size[1]=size[1]},Context.prototype.update=function(contextParameters){contextParameters&&(contextParameters.transform&&(this._nodeContext.transform=contextParameters.transform),contextParameters.opacity&&(this._nodeContext.opacity=contextParameters.opacity),contextParameters.origin&&(this._nodeContext.origin=contextParameters.origin),contextParameters.size&&(this._nodeContext.size=contextParameters.size));var perspective=this._perspectiveState.get();perspective!==this._perspective&&(this.container.style.perspective=perspective?perspective.toFixed()+"px":"",this.container.style.webkitPerspective=perspective?perspective.toFixed():"",this._perspective=perspective),this._node.commit(this._nodeContext)},Context.prototype.getPerspective=function(){return this._perspectiveState.get()},Context.prototype.setPerspective=function(perspective,transition,callback){return this._perspectiveState.set(perspective,transition,callback)},Context.prototype.emit=function(type,event){return this._eventOutput.emit(type,event)},Context.prototype.on=function(type,handler){return this._eventOutput.on(type,handler)},Context.prototype.removeListener=function(type,handler){return this._eventOutput.removeListener(type,handler)},Context.prototype.pipe=function(target){return this._eventOutput.pipe(target)},Context.prototype.unpipe=function(target){return this._eventOutput.unpipe(target)},module.exports=Context},{"../transitions/Transitionable":71,"./ElementAllocator":3,"./EventHandler":7,"./RenderNode":11,"./Transform":15}],3:[function(require,module){function ElementAllocator(container){container||(container=document.createDocumentFragment()),this.container=container,this.detachedNodes={},this.nodeCount=0}ElementAllocator.prototype.migrate=function(container){var oldContainer=this.container;if(container!==oldContainer){if(oldContainer instanceof DocumentFragment)container.appendChild(oldContainer);else for(;oldContainer.hasChildNodes();)container.appendChild(oldContainer.removeChild(oldContainer.firstChild));this.container=container}},ElementAllocator.prototype.allocate=function(type){type=type.toLowerCase(),type in this.detachedNodes||(this.detachedNodes[type]=[]);var result,nodeStore=this.detachedNodes[type];return nodeStore.length>0?result=nodeStore.pop():(result=document.createElement(type),this.container.appendChild(result)),this.nodeCount++,result},ElementAllocator.prototype.deallocate=function(element){var nodeType=element.nodeName.toLowerCase(),nodeStore=this.detachedNodes[nodeType];nodeStore.push(element),this.nodeCount--},ElementAllocator.prototype.getNodeCount=function(){return this.nodeCount},module.exports=ElementAllocator},{}],4:[function(require,module){function loop(){options.runLoop?(Engine.step(),requestAnimationFrame(loop)):loopEnabled=!1}function handleResize(event){if(document.activeElement&&"INPUT"===document.activeElement.nodeName)return void document.activeElement.addEventListener("blur",function deferredResize(){this.removeEventListener("blur",deferredResize),handleResize(event)});window.scrollTo(0,0);for(var i=0;i<contexts.length;i++)contexts[i].emit("resize");eventHandler.emit("resize")}var frameTime,frameTimeLimit,Context=require("./Context"),EventHandler=require("./EventHandler"),OptionsManager=require("./OptionsManager"),Engine={},contexts=[],nextTickQueue=[],deferQueue=[],lastTime=Date.now(),loopEnabled=!0,eventForwarders={},eventHandler=new EventHandler,options={containerType:"div",containerClass:"famous-container",fpsCap:void 0,runLoop:!0},optionsManager=new OptionsManager(options),MAX_DEFER_FRAME_TIME=10;Engine.step=function(){var currentTime=Date.now();if(!(frameTimeLimit&&frameTimeLimit>currentTime-lastTime)){var i=0;for(frameTime=currentTime-lastTime,lastTime=currentTime,eventHandler.emit("prerender"),i=0;i<nextTickQueue.length;i++)nextTickQueue[i].call(this);for(nextTickQueue.splice(0);deferQueue.length&&Date.now()-currentTime<MAX_DEFER_FRAME_TIME;)deferQueue.shift().call(this);for(i=0;i<contexts.length;i++)contexts[i].update();eventHandler.emit("postrender")}},requestAnimationFrame(loop),window.addEventListener("resize",handleResize,!1),handleResize(),window.addEventListener("touchmove",function(event){event.preventDefault()},!0),Engine.pipe=function(target){return target.subscribe instanceof Function?target.subscribe(Engine):eventHandler.pipe(target)},Engine.unpipe=function(target){return target.unsubscribe instanceof Function?target.unsubscribe(Engine):eventHandler.unpipe(target)},Engine.on=function(type,handler){return type in eventForwarders||(eventForwarders[type]=eventHandler.emit.bind(eventHandler,type),document.body.addEventListener(type,eventForwarders[type])),eventHandler.on(type,handler)},Engine.emit=function(type,event){return eventHandler.emit(type,event)},Engine.removeListener=function(type,handler){return eventHandler.removeListener(type,handler)},Engine.getFPS=function(){return 1e3/frameTime},Engine.setFPSCap=function(fps){frameTimeLimit=Math.floor(1e3/fps)},Engine.getOptions=function(){return optionsManager.getOptions.apply(optionsManager,arguments)},Engine.setOptions=function(){return optionsManager.setOptions.apply(optionsManager,arguments)},Engine.createContext=function(el){if(void 0===el)el=document.createElement(options.containerType),el.classList.add(options.containerClass),document.body.appendChild(el);else if(!(el instanceof Element))throw el=document.createElement(options.containerType),new Error("Tried to create context on non-existent element");var context=new Context(el);return Engine.registerContext(context),context},Engine.registerContext=function(context){return contexts.push(context),context},Engine.nextTick=function(fn){nextTickQueue.push(fn)},Engine.defer=function(fn){deferQueue.push(fn)},optionsManager.on("change",function(data){"fpsCap"===data.id?Engine.setFPSCap(data.value):"runLoop"===data.id&&!loopEnabled&&data.value&&(loopEnabled=!0,requestAnimationFrame(loop))}),module.exports=Engine},{"./Context":2,"./EventHandler":7,"./OptionsManager":10}],5:[function(require,module){function get(id){return entities[id]}function set(id,entity){entities[id]=entity}function register(entity){var id=entities.length;return set(id,entity),id}function unregister(id){set(id,null)}var entities=[];module.exports={register:register,unregister:unregister,get:get,set:set}},{}],6:[function(require,module){function EventEmitter(){this.listeners={},this._owner=this}EventEmitter.prototype.emit=function(type,event){var handlers=this.listeners[type];if(handlers)for(var i=0;i<handlers.length;i++)handlers[i].call(this._owner,event);return this},EventEmitter.prototype.on=function(type,handler){type in this.listeners||(this.listeners[type]=[]);var index=this.listeners[type].indexOf(handler);return 0>index&&this.listeners[type].push(handler),this},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.removeListener=function(type,handler){var index=this.listeners[type].indexOf(handler);return index>=0&&this.listeners[type].splice(index,1),this},EventEmitter.prototype.bindThis=function(owner){this._owner=owner},module.exports=EventEmitter},{}],7:[function(require,module){function EventHandler(){EventEmitter.apply(this,arguments),this.downstream=[],this.downstreamFn=[],this.upstream=[],this.upstreamListeners={}}var EventEmitter=require("./EventEmitter");EventHandler.prototype=Object.create(EventEmitter.prototype),EventHandler.prototype.constructor=EventHandler,EventHandler.setInputHandler=function(object,handler){object.trigger=handler.trigger.bind(handler),handler.subscribe&&handler.unsubscribe&&(object.subscribe=handler.subscribe.bind(handler),object.unsubscribe=handler.unsubscribe.bind(handler))},EventHandler.setOutputHandler=function(object,handler){handler instanceof EventHandler&&handler.bindThis(object),object.pipe=handler.pipe.bind(handler),object.unpipe=handler.unpipe.bind(handler),object.on=handler.on.bind(handler),object.addListener=handler.on,object.removeListener=handler.removeListener.bind(handler)},EventHandler.prototype.emit=function(type,event){EventEmitter.prototype.emit.apply(this,arguments);var i=0;for(i=0;i<this.downstream.length;i++)this.downstream[i].trigger(type,event);for(i=0;i<this.downstreamFn.length;i++)this.downstreamFn[i](type,event);return this},EventHandler.prototype.trigger=EventHandler.prototype.emit,EventHandler.prototype.pipe=function(target){if(target.subscribe instanceof Function)return target.subscribe(this);var downstreamCtx=target instanceof Function?this.downstreamFn:this.downstream,index=downstreamCtx.indexOf(target);return 0>index&&downstreamCtx.push(target),target instanceof Function?target("pipe",null):target.trigger&&target.trigger("pipe",null),target},EventHandler.prototype.unpipe=function(target){if(target.unsubscribe instanceof Function)return target.unsubscribe(this);var downstreamCtx=target instanceof Function?this.downstreamFn:this.downstream,index=downstreamCtx.indexOf(target);return index>=0?(downstreamCtx.splice(index,1),target instanceof Function?target("unpipe",null):target.trigger&&target.trigger("unpipe",null),target):!1},EventHandler.prototype.on=function(type){if(EventEmitter.prototype.on.apply(this,arguments),!(type in this.upstreamListeners)){var upstreamListener=this.trigger.bind(this,type);this.upstreamListeners[type]=upstreamListener;for(var i=0;i<this.upstream.length;i++)this.upstream[i].on(type,upstreamListener)}return this},EventHandler.prototype.addListener=EventHandler.prototype.on,EventHandler.prototype.subscribe=function(source){var index=this.upstream.indexOf(source);if(0>index){this.upstream.push(source);for(var type in this.upstreamListeners)source.on(type,this.upstreamListeners[type])}return this},EventHandler.prototype.unsubscribe=function(source){var index=this.upstream.indexOf(source);if(index>=0){this.upstream.splice(index,1);for(var type in this.upstreamListeners)source.removeListener(type,this.upstreamListeners[type])}return this},module.exports=EventHandler},{"./EventEmitter":6}],8:[function(require,module){function Group(options){Surface.call(this,options),this._shouldRecalculateSize=!1,this._container=document.createDocumentFragment(),this.context=new Context(this._container),this.setContent(this._container),this._groupSize=[void 0,void 0]}var Context=require("./Context"),Transform=require("./Transform"),Surface=require("./Surface");Group.SIZE_ZERO=[0,0],Group.prototype=Object.create(Surface.prototype),Group.prototype.elementType="div",Group.prototype.elementClass="famous-group",Group.prototype.add=function(){return this.context.add.apply(this.context,arguments)},Group.prototype.render=function(){return Surface.prototype.render.call(this)},Group.prototype.deploy=function(target){this.context.migrate(target)},Group.prototype.recall=function(){this._container=document.createDocumentFragment(),this.context.migrate(this._container)},Group.prototype.commit=function(context){var transform=context.transform,origin=context.origin,opacity=context.opacity,size=context.size,result=Surface.prototype.commit.call(this,{allocator:context.allocator,transform:Transform.thenMove(transform,[-origin[0]*size[0],-origin[1]*size[1],0]),opacity:opacity,origin:origin,size:Group.SIZE_ZERO});return(size[0]!==this._groupSize[0]||size[1]!==this._groupSize[1])&&(this._groupSize[0]=size[0],this._groupSize[1]=size[1],this.context.setSize(size)),this.context.update({transform:Transform.translate(-origin[0]*size[0],-origin[1]*size[1],0),origin:origin,size:size}),result},module.exports=Group},{"./Context":2,"./Surface":14,"./Transform":15}],9:[function(require,module){function Modifier(options){this._transformGetter=null,this._opacityGetter=null,this._originGetter=null,this._sizeGetter=null,this._legacyStates={},this._output={transform:Transform.identity,opacity:1,origin:null,size:null,target:null},options&&(options.transform&&this.transformFrom(options.transform),void 0!==options.opacity&&this.opacityFrom(options.opacity),options.origin&&this.originFrom(options.origin),options.size&&this.sizeFrom(options.size))}function _update(){this._transformGetter&&(this._output.transform=this._transformGetter()),this._opacityGetter&&(this._output.opacity=this._opacityGetter()),this._originGetter&&(this._output.origin=this._originGetter()),this._sizeGetter&&(this._output.size=this._sizeGetter())}var Transform=require("./Transform"),Transitionable=require("../transitions/Transitionable"),TransitionableTransform=require("../transitions/TransitionableTransform");Modifier.prototype.transformFrom=function(transform){return transform instanceof Function?this._transformGetter=transform:transform instanceof Object&&transform.get?this._transformGetter=transform.get.bind(transform):(this._transformGetter=null,this._output.transform=transform),this},Modifier.prototype.opacityFrom=function(opacity){return opacity instanceof Function?this._opacityGetter=opacity:opacity instanceof Object&&opacity.get?this._opacityGetter=opacity.get.bind(opacity):(this._opacityGetter=null,this._output.opacity=opacity),this},Modifier.prototype.originFrom=function(origin){return origin instanceof Function?this._originGetter=origin:origin instanceof Object&&origin.get?this._originGetter=origin.get.bind(origin):(this._originGetter=null,this._output.origin=origin),this},Modifier.prototype.sizeFrom=function(size){return size instanceof Function?this._sizeGetter=size:size instanceof Object&&size.get?this._sizeGetter=size.get.bind(size):(this._sizeGetter=null,this._output.size=size),this},Modifier.prototype.setTransform=function(transform,transition,callback){return transition||this._legacyStates.transform?(this._legacyStates.transform||(this._legacyStates.transform=new TransitionableTransform(this._output.transform)),this._transformGetter||this.transformFrom(this._legacyStates.transform),this._legacyStates.transform.set(transform,transition,callback),this):this.transformFrom(transform)},Modifier.prototype.setOpacity=function(opacity,transition,callback){return transition||this._legacyStates.opacity?(this._legacyStates.opacity||(this._legacyStates.opacity=new Transitionable(this._output.opacity)),this._opacityGetter||this.opacityFrom(this._legacyStates.opacity),this._legacyStates.opacity.set(opacity,transition,callback)):this.opacityFrom(opacity)},Modifier.prototype.setOrigin=function(origin,transition,callback){return transition||this._legacyStates.origin?(this._legacyStates.origin||(this._legacyStates.origin=new Transitionable(this._output.origin||[0,0])),this._originGetter||this.originFrom(this._legacyStates.origin),this._legacyStates.origin.set(origin,transition,callback),this):this.originFrom(origin)},Modifier.prototype.setSize=function(size,transition,callback){return size&&(transition||this._legacyStates.size)?(this._legacyStates.size||(this._legacyStates.size=new Transitionable(this._output.size||[0,0])),this._sizeGetter||this.sizeFrom(this._legacyStates.size),this._legacyStates.size.set(size,transition,callback),this):this.sizeFrom(size)},Modifier.prototype.halt=function(){this._legacyStates.transform&&this._legacyStates.transform.halt(),this._legacyStates.opacity&&this._legacyStates.opacity.halt(),this._legacyStates.origin&&this._legacyStates.origin.halt(),this._legacyStates.size&&this._legacyStates.size.halt(),this._transformGetter=null,this._opacityGetter=null,this._originGetter=null,this._sizeGetter=null},Modifier.prototype.getTransform=function(){return this._transformGetter()},Modifier.prototype.getFinalTransform=function(){return this._legacyStates.transform?this._legacyStates.transform.getFinal():this._output.transform},Modifier.prototype.getOpacity=function(){return this._opacityGetter()},Modifier.prototype.getOrigin=function(){return this._originGetter()},Modifier.prototype.getSize=function(){return this._sizeGetter?this._sizeGetter():this._output.size},Modifier.prototype.modify=function(target){return _update.call(this),this._output.target=target,this._output},module.exports=Modifier},{"../transitions/Transitionable":71,"../transitions/TransitionableTransform":72,"./Transform":15}],10:[function(require,module){function OptionsManager(value){this._value=value,this.eventOutput=null}function _createEventOutput(){this.eventOutput=new EventHandler,this.eventOutput.bindThis(this),EventHandler.setOutputHandler(this,this.eventOutput)}var EventHandler=require("./EventHandler");OptionsManager.patch=function(source){for(var manager=new OptionsManager(source),i=1;i<arguments.length;i++)manager.patch(arguments[i]);return source},OptionsManager.prototype.patch=function(){for(var myState=this._value,i=0;i<arguments.length;i++){var data=arguments[i];for(var k in data)k in myState&&data[k]&&data[k].constructor===Object&&myState[k]&&myState[k].constructor===Object?(myState.hasOwnProperty(k)||(myState[k]=Object.create(myState[k])),this.key(k).patch(data[k]),this.eventOutput&&this.eventOutput.emit("change",{id:k,value:this.key(k).value()})):this.set(k,data[k])}return this},OptionsManager.prototype.setOptions=OptionsManager.prototype.patch,OptionsManager.prototype.key=function(identifier){var result=new OptionsManager(this._value[identifier]);return(!(result._value instanceof Object)||result._value instanceof Array)&&(result._value={}),result},OptionsManager.prototype.get=function(key){return this._value[key]},OptionsManager.prototype.getOptions=OptionsManager.prototype.get,OptionsManager.prototype.set=function(key,value){var originalValue=this.get(key);return this._value[key]=value,this.eventOutput&&value!==originalValue&&this.eventOutput.emit("change",{id:key,value:value}),this},OptionsManager.prototype.value=function(){return this._value},OptionsManager.prototype.on=function(){return _createEventOutput.call(this),this.on.apply(this,arguments)},OptionsManager.prototype.removeListener=function(){return _createEventOutput.call(this),this.removeListener.apply(this,arguments)},OptionsManager.prototype.pipe=function(){return _createEventOutput.call(this),this.pipe.apply(this,arguments)},OptionsManager.prototype.unpipe=function(){return _createEventOutput.call(this),this.unpipe.apply(this,arguments)},module.exports=OptionsManager},{"./EventHandler":7}],11:[function(require,module){function RenderNode(object){this._object=null,this._child=null,this._hasMultipleChildren=!1,this._isRenderable=!1,this._isModifier=!1,this._resultCache={},this._prevResults={},this._childResult=null,object&&this.set(object)}function _applyCommit(spec,context,cacheStorage){for(var result=SpecParser.parse(spec,context),keys=Object.keys(result),i=0;i<keys.length;i++){var id=keys[i],childNode=Entity.get(id),commitParams=result[id];commitParams.allocator=context.allocator;var commitResult=childNode.commit(commitParams);commitResult?_applyCommit(commitResult,context,cacheStorage):cacheStorage[id]=commitParams}}var Entity=require("./Entity"),SpecParser=require("./SpecParser");RenderNode.prototype.add=function(child){var childNode=child instanceof RenderNode?child:new RenderNode(child);return this._child instanceof Array?this._child.push(childNode):this._child?(this._child=[this._child,childNode],this._hasMultipleChildren=!0,this._childResult=[]):this._child=childNode,childNode},RenderNode.prototype.get=function(){return this._object||(this._hasMultipleChildren?null:this._child?this._child.get():null)},RenderNode.prototype.set=function(child){return this._childResult=null,this._hasMultipleChildren=!1,this._isRenderable=child.render?!0:!1,this._isModifier=child.modify?!0:!1,this._object=child,this._child=null,child instanceof RenderNode?child:this},RenderNode.prototype.getSize=function(){var result=null,target=this.get();return target&&target.getSize&&(result=target.getSize()),!result&&this._child&&this._child.getSize&&(result=this._child.getSize()),result},RenderNode.prototype.commit=function(context){for(var prevKeys=Object.keys(this._prevResults),i=0;i<prevKeys.length;i++){var id=prevKeys[i];if(void 0===this._resultCache[id]){var object=Entity.get(id);object.cleanup&&object.cleanup(context.allocator)}}this._prevResults=this._resultCache,this._resultCache={},_applyCommit(this.render(),context,this._resultCache)},RenderNode.prototype.render=function(){if(this._isRenderable)return this._object.render();var result=null;if(this._hasMultipleChildren){result=this._childResult;for(var children=this._child,i=0;i<children.length;i++)result[i]=children[i].render()}else this._child&&(result=this._child.render());return this._isModifier?this._object.modify(result):result},module.exports=RenderNode},{"./Entity":5,"./SpecParser":13}],12:[function(require,module){function Scene(definition){this.id=null,this._objects=null,this.node=new RenderNode,this._definition=null,definition&&this.load(definition)}function _resolveTransformMatrix(matrixDefinition){for(var type in _MATRIX_GENERATORS)if(type in matrixDefinition){var args=matrixDefinition[type];return args instanceof Array||(args=[args]),_MATRIX_GENERATORS[type].apply(this,args)}}function _parseTransform(definition){var transformDefinition=definition.transform,opacity=definition.opacity,origin=definition.origin,size=definition.size,transform=Transform.identity;if(transformDefinition instanceof Array)if(16===transformDefinition.length&&"number"==typeof transformDefinition[0])transform=transformDefinition;else for(var i=0;i<transformDefinition.length;i++)transform=Transform.multiply(transform,_resolveTransformMatrix(transformDefinition[i]));else transformDefinition instanceof Object&&(transform=_resolveTransformMatrix(transformDefinition));var result=new Modifier({transform:transform,opacity:opacity,origin:origin,size:size});return result}function _parseArray(definition){for(var result=new RenderNode,i=0;i<definition.length;i++){var obj=_parse.call(this,definition[i]);obj&&result.add(obj)}return result}function _parse(definition){var result,id;if(definition instanceof Array)result=_parseArray.call(this,definition);else if(id=this._objects.length,definition.render&&definition.render instanceof Function)result=definition;else if(definition.target){var targetObj=_parse.call(this,definition.target),obj=_parseTransform.call(this,definition);result=new RenderNode(obj),result.add(targetObj),definition.id&&(this.id[definition.id]=obj)}else definition.id&&(result=new RenderNode,this.id[definition.id]=result);return this._objects[id]=result,result}var Transform=require("./Transform"),Modifier=require("./Modifier"),RenderNode=require("./RenderNode"),_MATRIX_GENERATORS={translate:Transform.translate,rotate:Transform.rotate,rotateX:Transform.rotateX,rotateY:Transform.rotateY,rotateZ:Transform.rotateZ,rotateAxis:Transform.rotateAxis,scale:Transform.scale,skew:Transform.skew,matrix3d:function(){return arguments}};Scene.prototype.create=function(){return new Scene(this._definition)},Scene.prototype.load=function(definition){this._definition=definition,this.id={},this._objects=[],this.node.set(_parse.call(this,definition))},Scene.prototype.add=function(){return this.node.add.apply(this.node,arguments)},Scene.prototype.render=function(){return this.node.render.apply(this.node,arguments)},module.exports=Scene},{"./Modifier":9,"./RenderNode":11,"./Transform":15}],13:[function(require,module){function SpecParser(){this.result={}}function _vecInContext(v,m){return[v[0]*m[0]+v[1]*m[4]+v[2]*m[8],v[0]*m[1]+v[1]*m[5]+v[2]*m[9],v[0]*m[2]+v[1]*m[6]+v[2]*m[10]]}var Transform=require("./Transform");SpecParser._instance=new SpecParser,SpecParser.parse=function(spec,context){return SpecParser._instance.parse(spec,context)},SpecParser.prototype.parse=function(spec,context){return this.reset(),this._parseSpec(spec,context,Transform.identity),this.result
},SpecParser.prototype.reset=function(){this.result={}};var _originZeroZero=[0,0];SpecParser.prototype._parseSpec=function(spec,parentContext,sizeContext){var id,target,transform,opacity,origin,size;if("number"==typeof spec){if(id=spec,transform=parentContext.transform,parentContext.size&&parentContext.origin&&(parentContext.origin[0]||parentContext.origin[1])){var originAdjust=[parentContext.origin[0]*parentContext.size[0],parentContext.origin[1]*parentContext.size[1],0];transform=Transform.thenMove(transform,_vecInContext(originAdjust,sizeContext))}this.result[id]={transform:transform,opacity:parentContext.opacity,origin:parentContext.origin||_originZeroZero,size:parentContext.size}}else{if(!spec)return;if(spec instanceof Array)for(var i=0;i<spec.length;i++)this._parseSpec(spec[i],parentContext,sizeContext);else{target=spec.target,transform=parentContext.transform,opacity=parentContext.opacity,origin=parentContext.origin,size=parentContext.size;var nextSizeContext=sizeContext;if(void 0!==spec.opacity&&(opacity=parentContext.opacity*spec.opacity),spec.transform&&(transform=Transform.multiply(parentContext.transform,spec.transform)),spec.origin&&(origin=spec.origin,nextSizeContext=parentContext.transform),spec.size){var parentSize=parentContext.size;size=[spec.size[0]||parentSize[0],spec.size[1]||parentSize[1]],parentSize&&origin&&(origin[0]||origin[1])&&(transform=Transform.thenMove(transform,_vecInContext([origin[0]*parentSize[0],origin[1]*parentSize[1],0],sizeContext)),transform=Transform.moveThen([-origin[0]*size[0],-origin[1]*size[1],0],transform)),nextSizeContext=parentContext.transform,origin=null}this._parseSpec(target,{transform:transform,opacity:opacity,origin:origin,size:size},nextSizeContext)}}},module.exports=SpecParser},{"./Transform":15}],14:[function(require,module){function Surface(options){this.options={},this.properties={},this.content="",this.classList=[],this.size=null,this._classesDirty=!0,this._stylesDirty=!0,this._sizeDirty=!0,this._contentDirty=!0,this._dirtyClasses=[],this._matrix=null,this._opacity=1,this._origin=null,this._size=null,this.eventForwarder=function(event){this.emit(event.type,event)}.bind(this),this.eventHandler=new EventHandler,this.eventHandler.bindThis(this),this.id=Entity.register(this),options&&this.setOptions(options),this._currTarget=null}function _addEventListeners(target){for(var i in this.eventHandler.listeners)target.addEventListener(i,this.eventForwarder)}function _removeEventListeners(target){for(var i in this.eventHandler.listeners)target.removeEventListener(i,this.eventForwarder)}function _cleanupClasses(target){for(var i=0;i<this._dirtyClasses.length;i++)target.classList.remove(this._dirtyClasses[i]);this._dirtyClasses=[]}function _applyStyles(target){for(var n in this.properties)target.style[n]=this.properties[n]}function _cleanupStyles(target){for(var n in this.properties)target.style[n]=""}function _formatCSSTransform(m){for(var result="matrix3d(",i=0;15>i;i++)result+=m[i]<1e-6&&m[i]>-1e-6?"0,":m[i]+",";return result+=m[15]+")"}function _formatCSSOrigin(origin){return(100*origin[0]).toFixed(6)+"% "+(100*origin[1]).toFixed(6)+"%"}function _xyNotEquals(a,b){return a&&b?a[0]!==b[0]||a[1]!==b[1]:a!==b}var Entity=require("./Entity"),EventHandler=require("./EventHandler"),Transform=require("./Transform"),usePrefix=void 0!==document.body.style.webkitTransform;Surface.prototype.elementType="div",Surface.prototype.elementClass="famous-surface",Surface.prototype.on=function(type,fn){this._currTarget&&this._currTarget.addEventListener(type,this.eventForwarder),this.eventHandler.on(type,fn)},Surface.prototype.removeListener=function(type,fn){this.eventHandler.removeListener(type,fn)},Surface.prototype.emit=function(type,event){event&&!event.origin&&(event.origin=this);var handled=this.eventHandler.emit(type,event);return handled&&event.stopPropagation&&event.stopPropagation(),handled},Surface.prototype.pipe=function(target){return this.eventHandler.pipe(target)},Surface.prototype.unpipe=function(target){return this.eventHandler.unpipe(target)},Surface.prototype.render=function(){return this.id},Surface.prototype.setProperties=function(properties){for(var n in properties)this.properties[n]=properties[n];this._stylesDirty=!0},Surface.prototype.getProperties=function(){return this.properties},Surface.prototype.addClass=function(className){this.classList.indexOf(className)<0&&(this.classList.push(className),this._classesDirty=!0)},Surface.prototype.removeClass=function(className){var i=this.classList.indexOf(className);i>=0&&(this._dirtyClasses.push(this.classList.splice(i,1)[0]),this._classesDirty=!0)},Surface.prototype.setClasses=function(classList){var i=0,removal=[];for(i=0;i<this.classList.length;i++)classList.indexOf(this.classList[i])<0&&removal.push(this.classList[i]);for(i=0;i<removal.length;i++)this.removeClass(removal[i]);for(i=0;i<classList.length;i++)this.addClass(classList[i])},Surface.prototype.getClassList=function(){return this.classList},Surface.prototype.setContent=function(content){this.content!==content&&(this.content=content,this._contentDirty=!0)},Surface.prototype.getContent=function(){return this.content},Surface.prototype.setOptions=function(options){options.size&&this.setSize(options.size),options.classes&&this.setClasses(options.classes),options.properties&&this.setProperties(options.properties),options.content&&this.setContent(options.content)};var _setMatrix=usePrefix?function(element,matrix){element.style.webkitTransform=_formatCSSTransform(matrix)}:function(element,matrix){element.style.transform=_formatCSSTransform(matrix)},_setOrigin=usePrefix?function(element,origin){element.style.webkitTransformOrigin=_formatCSSOrigin(origin)}:function(element,origin){element.style.transformOrigin=_formatCSSOrigin(origin)},_setInvisible=usePrefix?function(element){element.style.webkitTransform="scale3d(0.0001,0.0001,1)",element.style.opacity=0}:function(element){element.style.transform="scale3d(0.0001,0.0001,1)",element.style.opacity=0};Surface.prototype.setup=function(allocator){var target=allocator.allocate(this.elementType);if(this.elementClass)if(this.elementClass instanceof Array)for(var i=0;i<this.elementClass.length;i++)target.classList.add(this.elementClass[i]);else target.classList.add(this.elementClass);target.style.display="",_addEventListeners.call(this,target),_setOrigin(target,[0,0]),this._currTarget=target,this._stylesDirty=!0,this._classesDirty=!0,this._sizeDirty=!0,this._contentDirty=!0,this._matrix=null,this._opacity=void 0,this._origin=null,this._size=null},Surface.prototype.commit=function(context){this._currTarget||this.setup(context.allocator);var target=this._currTarget,matrix=context.transform,opacity=context.opacity,origin=context.origin,size=context.size;if(this.size){var origSize=size;size=[this.size[0],this.size[1]],void 0===size[0]&&origSize[0]&&(size[0]=origSize[0]),void 0===size[1]&&origSize[1]&&(size[1]=origSize[1])}if(_xyNotEquals(this._size,size)&&(this._size=[size[0],size[1]],this._sizeDirty=!0),!matrix&&this._matrix)return this._matrix=null,this._opacity=0,void _setInvisible(target);if(this._opacity!==opacity&&(this._opacity=opacity,target.style.opacity=opacity>=1?"0.999999":opacity),_xyNotEquals(this._origin,origin)||Transform.notEquals(this._matrix,matrix)){matrix||(matrix=Transform.identity),this._matrix=matrix;var aaMatrix=matrix;origin&&(this._origin||(this._origin=[0,0]),this._origin[0]=origin[0],this._origin[1]=origin[1],aaMatrix=Transform.moveThen([-this._size[0]*origin[0],-this._size[1]*origin[1],0],matrix)),_setMatrix(target,aaMatrix)}if(this._classesDirty||this._stylesDirty||this._sizeDirty||this._contentDirty){if(this._classesDirty){_cleanupClasses.call(this,target);for(var classList=this.getClassList(),i=0;i<classList.length;i++)target.classList.add(classList[i]);this._classesDirty=!1}this._stylesDirty&&(_applyStyles.call(this,target),this._stylesDirty=!1),this._sizeDirty&&(this._size&&(target.style.width=this._size[0]!==!0?this._size[0]+"px":"",target.style.height=this._size[1]!==!0?this._size[1]+"px":""),this._sizeDirty=!1),this._contentDirty&&(this.deploy(target),this.eventHandler.emit("deploy"),this._contentDirty=!1)}},Surface.prototype.cleanup=function(allocator){var i=0,target=this._currTarget;this.eventHandler.emit("recall"),this.recall(target),target.style.display="none",target.style.width="",target.style.height="",this._size=null,_cleanupStyles.call(this,target);var classList=this.getClassList();for(_cleanupClasses.call(this,target),i=0;i<classList.length;i++)target.classList.remove(classList[i]);if(this.elementClass)if(this.elementClass instanceof Array)for(i=0;i<this.elementClass.length;i++)target.classList.remove(this.elementClass[i]);else target.classList.remove(this.elementClass);_removeEventListeners.call(this,target),this._currTarget=null,allocator.deallocate(target),_setInvisible(target)},Surface.prototype.deploy=function(target){var content=this.getContent();if(content instanceof Node){for(;target.hasChildNodes();)target.removeChild(target.firstChild);target.appendChild(content)}else target.innerHTML=content},Surface.prototype.recall=function(target){for(var df=document.createDocumentFragment();target.hasChildNodes();)df.appendChild(target.firstChild);this.setContent(df)},Surface.prototype.getSize=function(actual){return actual?this._size:this.size||this._size},Surface.prototype.setSize=function(size){this.size=size?[size[0],size[1]]:null,this._sizeDirty=!0},module.exports=Surface},{"./Entity":5,"./EventHandler":7,"./Transform":15}],15:[function(require,module){function _normSquared(v){return 2===v.length?v[0]*v[0]+v[1]*v[1]:v[0]*v[0]+v[1]*v[1]+v[2]*v[2]}function _norm(v){return Math.sqrt(_normSquared(v))}function _sign(n){return 0>n?-1:1}var Transform={};Transform.precision=1e-6,Transform.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Transform.multiply4x4=function(a,b){return[a[0]*b[0]+a[4]*b[1]+a[8]*b[2]+a[12]*b[3],a[1]*b[0]+a[5]*b[1]+a[9]*b[2]+a[13]*b[3],a[2]*b[0]+a[6]*b[1]+a[10]*b[2]+a[14]*b[3],a[3]*b[0]+a[7]*b[1]+a[11]*b[2]+a[15]*b[3],a[0]*b[4]+a[4]*b[5]+a[8]*b[6]+a[12]*b[7],a[1]*b[4]+a[5]*b[5]+a[9]*b[6]+a[13]*b[7],a[2]*b[4]+a[6]*b[5]+a[10]*b[6]+a[14]*b[7],a[3]*b[4]+a[7]*b[5]+a[11]*b[6]+a[15]*b[7],a[0]*b[8]+a[4]*b[9]+a[8]*b[10]+a[12]*b[11],a[1]*b[8]+a[5]*b[9]+a[9]*b[10]+a[13]*b[11],a[2]*b[8]+a[6]*b[9]+a[10]*b[10]+a[14]*b[11],a[3]*b[8]+a[7]*b[9]+a[11]*b[10]+a[15]*b[11],a[0]*b[12]+a[4]*b[13]+a[8]*b[14]+a[12]*b[15],a[1]*b[12]+a[5]*b[13]+a[9]*b[14]+a[13]*b[15],a[2]*b[12]+a[6]*b[13]+a[10]*b[14]+a[14]*b[15],a[3]*b[12]+a[7]*b[13]+a[11]*b[14]+a[15]*b[15]]},Transform.multiply=function(a,b){return[a[0]*b[0]+a[4]*b[1]+a[8]*b[2],a[1]*b[0]+a[5]*b[1]+a[9]*b[2],a[2]*b[0]+a[6]*b[1]+a[10]*b[2],0,a[0]*b[4]+a[4]*b[5]+a[8]*b[6],a[1]*b[4]+a[5]*b[5]+a[9]*b[6],a[2]*b[4]+a[6]*b[5]+a[10]*b[6],0,a[0]*b[8]+a[4]*b[9]+a[8]*b[10],a[1]*b[8]+a[5]*b[9]+a[9]*b[10],a[2]*b[8]+a[6]*b[9]+a[10]*b[10],0,a[0]*b[12]+a[4]*b[13]+a[8]*b[14]+a[12],a[1]*b[12]+a[5]*b[13]+a[9]*b[14]+a[13],a[2]*b[12]+a[6]*b[13]+a[10]*b[14]+a[14],1]},Transform.thenMove=function(m,t){return t[2]||(t[2]=0),[m[0],m[1],m[2],0,m[4],m[5],m[6],0,m[8],m[9],m[10],0,m[12]+t[0],m[13]+t[1],m[14]+t[2],1]},Transform.moveThen=function(v,m){v[2]||(v[2]=0);var t0=v[0]*m[0]+v[1]*m[4]+v[2]*m[8],t1=v[0]*m[1]+v[1]*m[5]+v[2]*m[9],t2=v[0]*m[2]+v[1]*m[6]+v[2]*m[10];return Transform.thenMove(m,[t0,t1,t2])},Transform.translate=function(x,y,z){return void 0===z&&(z=0),[1,0,0,0,0,1,0,0,0,0,1,0,x,y,z,1]},Transform.thenScale=function(m,s){return[s[0]*m[0],s[1]*m[1],s[2]*m[2],0,s[0]*m[4],s[1]*m[5],s[2]*m[6],0,s[0]*m[8],s[1]*m[9],s[2]*m[10],0,s[0]*m[12],s[1]*m[13],s[2]*m[14],1]},Transform.scale=function(x,y,z){return void 0===z&&(z=1),[x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1]},Transform.rotateX=function(theta){var cosTheta=Math.cos(theta),sinTheta=Math.sin(theta);return[1,0,0,0,0,cosTheta,sinTheta,0,0,-sinTheta,cosTheta,0,0,0,0,1]},Transform.rotateY=function(theta){var cosTheta=Math.cos(theta),sinTheta=Math.sin(theta);return[cosTheta,0,-sinTheta,0,0,1,0,0,sinTheta,0,cosTheta,0,0,0,0,1]},Transform.rotateZ=function(theta){var cosTheta=Math.cos(theta),sinTheta=Math.sin(theta);return[cosTheta,sinTheta,0,0,-sinTheta,cosTheta,0,0,0,0,1,0,0,0,0,1]},Transform.rotate=function(phi,theta,psi){var cosPhi=Math.cos(phi),sinPhi=Math.sin(phi),cosTheta=Math.cos(theta),sinTheta=Math.sin(theta),cosPsi=Math.cos(psi),sinPsi=Math.sin(psi),result=[cosTheta*cosPsi,cosPhi*sinPsi+sinPhi*sinTheta*cosPsi,sinPhi*sinPsi-cosPhi*sinTheta*cosPsi,0,-cosTheta*sinPsi,cosPhi*cosPsi-sinPhi*sinTheta*sinPsi,sinPhi*cosPsi+cosPhi*sinTheta*sinPsi,0,sinTheta,-sinPhi*cosTheta,cosPhi*cosTheta,0,0,0,0,1];return result},Transform.rotateAxis=function(v,theta){var sinTheta=Math.sin(theta),cosTheta=Math.cos(theta),verTheta=1-cosTheta,xxV=v[0]*v[0]*verTheta,xyV=v[0]*v[1]*verTheta,xzV=v[0]*v[2]*verTheta,yyV=v[1]*v[1]*verTheta,yzV=v[1]*v[2]*verTheta,zzV=v[2]*v[2]*verTheta,xs=v[0]*sinTheta,ys=v[1]*sinTheta,zs=v[2]*sinTheta,result=[xxV+cosTheta,xyV+zs,xzV-ys,0,xyV-zs,yyV+cosTheta,yzV+xs,0,xzV+ys,yzV-xs,zzV+cosTheta,0,0,0,0,1];return result},Transform.aboutOrigin=function(v,m){var t0=v[0]-(v[0]*m[0]+v[1]*m[4]+v[2]*m[8]),t1=v[1]-(v[0]*m[1]+v[1]*m[5]+v[2]*m[9]),t2=v[2]-(v[0]*m[2]+v[1]*m[6]+v[2]*m[10]);return Transform.thenMove(m,[t0,t1,t2])},Transform.skew=function(phi,theta,psi){return[1,0,0,0,Math.tan(psi),1,0,0,Math.tan(theta),Math.tan(phi),1,0,0,0,0,1]},Transform.perspective=function(focusZ){return[1,0,0,0,0,1,0,0,0,0,1,-1/focusZ,0,0,0,1]},Transform.getTranslate=function(m){return[m[12],m[13],m[14]]},Transform.inverse=function(m){var c0=m[5]*m[10]-m[6]*m[9],c1=m[4]*m[10]-m[6]*m[8],c2=m[4]*m[9]-m[5]*m[8],c4=m[1]*m[10]-m[2]*m[9],c5=m[0]*m[10]-m[2]*m[8],c6=m[0]*m[9]-m[1]*m[8],c8=m[1]*m[6]-m[2]*m[5],c9=m[0]*m[6]-m[2]*m[4],c10=m[0]*m[5]-m[1]*m[4],detM=m[0]*c0-m[1]*c1+m[2]*c2,invD=1/detM,result=[invD*c0,-invD*c4,invD*c8,0,-invD*c1,invD*c5,-invD*c9,0,invD*c2,-invD*c6,invD*c10,0,0,0,0,1];return result[12]=-m[12]*result[0]-m[13]*result[4]-m[14]*result[8],result[13]=-m[12]*result[1]-m[13]*result[5]-m[14]*result[9],result[14]=-m[12]*result[2]-m[13]*result[6]-m[14]*result[10],result},Transform.transpose=function(m){return[m[0],m[4],m[8],m[12],m[1],m[5],m[9],m[13],m[2],m[6],m[10],m[14],m[3],m[7],m[11],m[15]]},Transform.interpret=function(M){var x=[M[0],M[1],M[2]],sgn=_sign(x[0]),xNorm=_norm(x),v=[x[0]+sgn*xNorm,x[1],x[2]],mult=2/_normSquared(v);if(mult>=1/0)return{translate:Transform.getTranslate(M),rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]};var Q1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];Q1[0]=1-mult*v[0]*v[0],Q1[5]=1-mult*v[1]*v[1],Q1[10]=1-mult*v[2]*v[2],Q1[1]=-mult*v[0]*v[1],Q1[2]=-mult*v[0]*v[2],Q1[6]=-mult*v[1]*v[2],Q1[4]=Q1[1],Q1[8]=Q1[2],Q1[9]=Q1[6];var MQ1=Transform.multiply(Q1,M),x2=[MQ1[5],MQ1[6]],sgn2=_sign(x2[0]),x2Norm=_norm(x2),v2=[x2[0]+sgn2*x2Norm,x2[1]],mult2=2/_normSquared(v2),Q2=[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];Q2[5]=1-mult2*v2[0]*v2[0],Q2[10]=1-mult2*v2[1]*v2[1],Q2[6]=-mult2*v2[0]*v2[1],Q2[9]=Q2[6];var Q=Transform.multiply(Q2,Q1),R=Transform.multiply(Q,M),remover=Transform.scale(R[0]<0?-1:1,R[5]<0?-1:1,R[10]<0?-1:1);R=Transform.multiply(R,remover),Q=Transform.multiply(remover,Q);var result={};return result.translate=Transform.getTranslate(M),result.rotate=[Math.atan2(-Q[6],Q[10]),Math.asin(Q[2]),Math.atan2(-Q[1],Q[0])],result.rotate[0]||(result.rotate[0]=0,result.rotate[2]=Math.atan2(Q[4],Q[5])),result.scale=[R[0],R[5],R[10]],result.skew=[Math.atan2(R[9],result.scale[2]),Math.atan2(R[8],result.scale[2]),Math.atan2(R[4],result.scale[0])],Math.abs(result.rotate[0])+Math.abs(result.rotate[2])>1.5*Math.PI&&(result.rotate[1]=Math.PI-result.rotate[1],result.rotate[1]>Math.PI&&(result.rotate[1]-=2*Math.PI),result.rotate[1]<-Math.PI&&(result.rotate[1]+=2*Math.PI),result.rotate[0]<0?result.rotate[0]+=Math.PI:result.rotate[0]-=Math.PI,result.rotate[2]<0?result.rotate[2]+=Math.PI:result.rotate[2]-=Math.PI),result},Transform.average=function(M1,M2,t){t=void 0===t?.5:t;for(var specM1=Transform.interpret(M1),specM2=Transform.interpret(M2),specAvg={translate:[0,0,0],rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]},i=0;3>i;i++)specAvg.translate[i]=(1-t)*specM1.translate[i]+t*specM2.translate[i],specAvg.rotate[i]=(1-t)*specM1.rotate[i]+t*specM2.rotate[i],specAvg.scale[i]=(1-t)*specM1.scale[i]+t*specM2.scale[i],specAvg.skew[i]=(1-t)*specM1.skew[i]+t*specM2.skew[i];return Transform.build(specAvg)},Transform.build=function(spec){var scaleMatrix=Transform.scale(spec.scale[0],spec.scale[1],spec.scale[2]),skewMatrix=Transform.skew(spec.skew[0],spec.skew[1],spec.skew[2]),rotateMatrix=Transform.rotate(spec.rotate[0],spec.rotate[1],spec.rotate[2]);return Transform.thenMove(Transform.multiply(Transform.multiply(rotateMatrix,skewMatrix),scaleMatrix),spec.translate)},Transform.equals=function(a,b){return!Transform.notEquals(a,b)},Transform.notEquals=function(a,b){return a===b?!1:a&&b?!(a&&b)||a[12]!==b[12]||a[13]!==b[13]||a[14]!==b[14]||a[0]!==b[0]||a[1]!==b[1]||a[2]!==b[2]||a[4]!==b[4]||a[5]!==b[5]||a[6]!==b[6]||a[8]!==b[8]||a[9]!==b[9]||a[10]!==b[10]:!0},Transform.normalizeRotation=function(rotation){var result=rotation.slice(0);for((result[0]===.5*Math.PI||result[0]===.5*-Math.PI)&&(result[0]=-result[0],result[1]=Math.PI-result[1],result[2]-=Math.PI),result[0]>.5*Math.PI&&(result[0]=result[0]-Math.PI,result[1]=Math.PI-result[1],result[2]-=Math.PI),result[0]<.5*-Math.PI&&(result[0]=result[0]+Math.PI,result[1]=-Math.PI-result[1],result[2]-=Math.PI);result[1]<-Math.PI;)result[1]+=2*Math.PI;for(;result[1]>=Math.PI;)result[1]-=2*Math.PI;for(;result[2]<-Math.PI;)result[2]+=2*Math.PI;for(;result[2]>=Math.PI;)result[2]-=2*Math.PI;return result},Transform.inFront=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,.001,1],Transform.behind=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,-.001,1],module.exports=Transform},{}],16:[function(require,module){function View(options){this._node=new RenderNode,this._eventInput=new EventHandler,this._eventOutput=new EventHandler,EventHandler.setInputHandler(this,this._eventInput),EventHandler.setOutputHandler(this,this._eventOutput),this.options=Object.create(this.constructor.DEFAULT_OPTIONS||View.DEFAULT_OPTIONS),this._optionsManager=new OptionsManager(this.options),options&&this.setOptions(options)}var EventHandler=require("./EventHandler"),OptionsManager=require("./OptionsManager"),RenderNode=require("./RenderNode");View.DEFAULT_OPTIONS={},View.prototype.getOptions=function(){return this._optionsManager.value()},View.prototype.setOptions=function(options){this._optionsManager.patch(options)},View.prototype.add=function(){return this._node.add.apply(this._node,arguments)},View.prototype._add=View.prototype.add,View.prototype.render=function(){return this._node.render()},View.prototype.getSize=function(){return this._node&&this._node.getSize?this._node.getSize.apply(this._node,arguments)||this.options.size:this.options.size},module.exports=View},{"./EventHandler":7,"./OptionsManager":10,"./RenderNode":11}],17:[function(require,module){function ViewSequence(options){options||(options=[]),options instanceof Array&&(options={array:options}),this._=null,this.index=options.index||0,options.array?this._=new this.constructor.Backing(options.array):options._&&(this._=options._),this.index===this._.firstIndex&&(this._.firstNode=this),this.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=this),void 0!==options.loop&&(this._.loop=options.loop),this._previousNode=null,this._nextNode=null}ViewSequence.Backing=function(array){this.array=array,this.firstIndex=0,this.loop=!1,this.firstNode=null,this.lastNode=null},ViewSequence.Backing.prototype.getValue=function(i){var _i=i-this.firstIndex;return 0>_i||_i>=this.array.length?null:this.array[_i]},ViewSequence.Backing.prototype.setValue=function(i,value){this.array[i-this.firstIndex]=value},ViewSequence.Backing.prototype.reindex=function(start,removeCount,insertCount){var i=0,index=this.firstIndex,indexShiftAmount=insertCount-removeCount,node=this.firstNode;if(start===this.firstIndex){for(var i=0;removeCount>i;i++)this.firstNode=this.firstNode.getNext();this.firstNode.index=this.firstIndex}for(;start-1>index;)node=node.getNext(),index++;var spliceStartNode=node;for(i=0;removeCount>i;i++)node=node.getNext(),node&&(node._previousNode=spliceStartNode);var spliceResumeNode=node?node.getNext():null;for(spliceStartNode._nextNode=null,node=spliceStartNode,i=0;insertCount>i;i++)node=node.getNext();if(index+=insertCount,node!==spliceResumeNode&&(node._nextNode=spliceResumeNode,spliceResumeNode&&(spliceResumeNode._previousNode=node)),spliceResumeNode)for(node=spliceResumeNode,index++;node&&index<this.array.length+this.firstIndex;)node._nextNode?node.index+=indexShiftAmount:node.index=index,node=node.getNext(),index++},ViewSequence.prototype.getPrevious=function(){return this.index===this._.firstIndex?this._.loop?(this._previousNode=this._.lastNode||new this.constructor({_:this._,index:this._.firstIndex+this._.array.length-1}),this._previousNode._nextNode=this):this._previousNode=null:this._previousNode||(this._previousNode=new this.constructor({_:this._,index:this.index-1}),this._previousNode._nextNode=this),this._previousNode},ViewSequence.prototype.getNext=function(){return this.index===this._.firstIndex+this._.array.length-1?this._.loop?(this._nextNode=this._.firstNode||new this.constructor({_:this._,index:this._.firstIndex}),this._nextNode._previousNode=this):this._nextNode=null:this._nextNode||(this._nextNode=new this.constructor({_:this._,index:this.index+1}),this._nextNode._previousNode=this),this._nextNode},ViewSequence.prototype.getIndex=function(){return this.index},ViewSequence.prototype.toString=function(){return""+this.index},ViewSequence.prototype.unshift=function(){this._.array.unshift.apply(this._.array,arguments),this._.firstIndex-=arguments.length},ViewSequence.prototype.push=function(){this._.array.push.apply(this._.array,arguments)},ViewSequence.prototype.splice=function(index,howMany){var values=Array.prototype.slice.call(arguments,2);this._.array.splice.apply(this._.array,[index-this._.firstIndex,howMany].concat(values)),this._.reindex(index,howMany,values.length)},ViewSequence.prototype.swap=function(other){var otherValue=other.get(),myValue=this.get();this._.setValue(this.index,otherValue),this._.setValue(other.index,myValue);var myPrevious=this._previousNode,myNext=this._nextNode,myIndex=this.index,otherPrevious=other._previousNode,otherNext=other._nextNode,otherIndex=other.index;this.index=otherIndex,this._previousNode=otherPrevious===this?other:otherPrevious,this._previousNode&&(this._previousNode._nextNode=this),this._nextNode=otherNext===this?other:otherNext,this._nextNode&&(this._nextNode._previousNode=this),other.index=myIndex,other._previousNode=myPrevious===other?this:myPrevious,other._previousNode&&(other._previousNode._nextNode=other),other._nextNode=myNext===other?this:myNext,other._nextNode&&(other._nextNode._previousNode=other),this.index===this._.firstIndex?this._.firstNode=this:this.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=this),other.index===this._.firstIndex?this._.firstNode=other:other.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=other)},ViewSequence.prototype.get=function(){return this._.getValue(this.index)},ViewSequence.prototype.getSize=function(){var target=this.get();return target?target.getSize():null},ViewSequence.prototype.render=function(){var target=this.get();return target?target.render.apply(target,arguments):null},module.exports=ViewSequence},{}],18:[function(require,module){function EventArbiter(startMode){this.dispatchers={},this.currMode=void 0,this.setMode(startMode)}var EventHandler=require("../core/EventHandler");EventArbiter.prototype.setMode=function(mode){if(mode!==this.currMode){var startMode=this.currMode;this.dispatchers[this.currMode]&&this.dispatchers[this.currMode].trigger("unpipe"),this.currMode=mode,this.dispatchers[mode]&&this.dispatchers[mode].emit("pipe"),this.emit("change",{from:startMode,to:mode})}},EventArbiter.prototype.forMode=function(mode){return this.dispatchers[mode]||(this.dispatchers[mode]=new EventHandler),this.dispatchers[mode]},EventArbiter.prototype.emit=function(eventType,event){if(void 0===this.currMode)return!1;event||(event={});var dispatcher=this.dispatchers[this.currMode];return dispatcher?dispatcher.trigger(eventType,event):void 0},module.exports=EventArbiter},{"../core/EventHandler":7}],19:[function(require,module){function EventFilter(condition){EventHandler.call(this),this._condition=condition}var EventHandler=require("../core/EventHandler");EventFilter.prototype=Object.create(EventHandler.prototype),EventFilter.prototype.constructor=EventFilter,EventFilter.prototype.emit=function(type,data){return this._condition(type,data)?EventHandler.prototype.emit.apply(this,arguments):void 0},EventFilter.prototype.trigger=EventFilter.prototype.emit,module.exports=EventFilter},{"../core/EventHandler":7}],20:[function(require,module){function EventMapper(mappingFunction){EventHandler.call(this),this._mappingFunction=mappingFunction}var EventHandler=require("../core/EventHandler");EventMapper.prototype=Object.create(EventHandler.prototype),EventMapper.prototype.constructor=EventMapper,EventMapper.prototype.subscribe=null,EventMapper.prototype.unsubscribe=null,EventMapper.prototype.emit=function(type,data){var target=this._mappingFunction.apply(this,arguments);target&&target.emit instanceof Function&&target.emit(type,data)},EventMapper.prototype.trigger=EventMapper.prototype.emit,module.exports=EventMapper},{"../core/EventHandler":7}],21:[function(){if(window.CustomEvent){var clickThreshold=300,potentialClicks={};window.addEventListener("touchstart",function(event){for(var timestamp=Date.now(),i=0;i<event.changedTouches.length;i++){var touch=event.changedTouches[i];potentialClicks[touch.identifier]=timestamp}}),window.addEventListener("touchmove",function(event){for(var i=0;i<event.changedTouches.length;i++){var touch=event.changedTouches[i];delete potentialClicks[touch.identifier]}}),window.addEventListener("touchend",function(event){for(var currTime=Date.now(),i=0;i<event.changedTouches.length;i++){var touch=event.changedTouches[i],startTime=potentialClicks[touch.identifier];if(startTime&&clickThreshold>currTime-startTime){event.preventDefault();var clickEvt=new window.CustomEvent("click",{bubbles:!0,details:touch});event.target.dispatchEvent(clickEvt)}delete potentialClicks[touch.identifier]}})}},{}],22:[function(require,module){function GenericSync(legacyGetter,options){2===arguments.length?this._legacyPositionGetter=legacyGetter:(this._legacyPositionGetter=null,options=legacyGetter),this.eventInput=new EventHandler,this.eventOutput=new EventHandler,EventHandler.setInputHandler(this,this.eventInput),EventHandler.setOutputHandler(this,this.eventOutput),this._handlers=void 0,options?(this.options=options,options.syncClasses||(this.options.syncClasses=defaultClasses),this.setOptions(options)):this.options={syncClasses:defaultClasses},this._handlers&&_updateHandlers.call(this)}function _updateHandlers(){var SyncClass=null,i=0;if(this._handlers)for(i=0;i<this._handlers.length;i++)this.eventInput.unpipe(this._handlers[i]),this._handlers[i].unpipe(this.eventOutput);for(this._handlers=[],i=0;i<this.options.syncClasses.length;i++)SyncClass=this.options.syncClasses[i],this._handlers[i]=new SyncClass(this._legacyPositionGetter,this._handlerOptions),this.eventInput.pipe(this._handlers[i]),this._handlers[i].pipe(this.eventOutput)}var EventHandler=require("../core/EventHandler"),TouchSync=require("./TouchSync"),ScrollSync=require("./ScrollSync"),defaultClasses=[TouchSync,ScrollSync];GenericSync.register=function(syncClass){defaultClasses.indexOf(syncClass)<0&&defaultClasses.push(syncClass)},GenericSync.DIRECTION_X=0,GenericSync.DIRECTION_Y=1,GenericSync.DIRECTION_Z=2,GenericSync.prototype.setOptions=function(options){if(this._handlerOptions=options,options.syncClasses&&(this.options.syncClasses=options.syncClasses,_updateHandlers.call(this)),this._handlers)for(var i=0;i<this._handlers.length;i++)this._handlers[i].setOptions(this._handlerOptions)},module.exports=GenericSync},{"../core/EventHandler":7,"./ScrollSync":27,"./TouchSync":28}],23:[function(require,module){function MouseSync(legacyGetter,options){2===arguments.length?(this._legacyPositionGetter=arguments[0],options=arguments[1]):(this._legacyPositionGetter=null,options=arguments[0]),this.options={direction:void 0,rails:!1,scale:1,stallTime:50,propogate:!0},this._payload={delta:null,position:null,velocity:null,clientX:void 0,clientY:void 0,offsetX:void 0,offsetY:void 0},this.setOptions(options?options:this.options),this.input=new EventHandler,this.output=new EventHandler,EventHandler.setInputHandler(this,this.input),EventHandler.setOutputHandler(this,this.output),this._prevCoord=void 0,this._prevTime=void 0,this._prevVel=void 0,this.input.on("mousedown",_handleStart.bind(this)),this.input.on("mousemove",_handleMove.bind(this)),this.input.on("mouseup",_handleEnd.bind(this)),this.options.propogate?this.input.on("mouseleave",_handleLeave.bind(this)):this.input.on("mouseleave",_handleEnd.bind(this))}function _clearPayload(){var payload=this._payload;payload.delta=null,payload.position=null,payload.velocity=null,payload.clientX=void 0,payload.clientY=void 0,payload.offsetX=void 0,payload.offsetY=void 0}function _handleStart(event){event.preventDefault(),_clearPayload.call(this);var x=event.clientX,y=event.clientY;this._prevCoord=[x,y],this._prevTime=Date.now(),this._prevVel=void 0!==this.options.direction?0:[0,0];var payload=this._payload;payload.clientX=x,payload.clientY=y,payload.offsetX=event.offsetX,payload.offsetY=event.offsetY,this.output.emit("start",payload)}function _handleMove(event){if(this._prevCoord){var prevCoord=this._prevCoord,prevTime=this._prevTime,x=event.clientX,y=event.clientY,currCoord=[x,y],currTime=Date.now(),diffX=currCoord[0]-prevCoord[0],diffY=currCoord[1]-prevCoord[1];this.options.rails&&(Math.abs(diffX)>Math.abs(diffY)?diffY=0:diffX=0);var prevPos,nextPos,nextVel,nextDelta,diffTime=Math.max(currTime-prevTime,8),velX=diffX/diffTime,velY=diffY/diffTime,scale=this.options.scale;this.options.direction===MouseSync.DIRECTION_X?(prevPos=this._legacyPositionGetter?this._legacyPositionGetter():0,nextDelta=scale*diffX,nextPos=prevPos+nextDelta,nextVel=scale*velX):this.options.direction===MouseSync.DIRECTION_Y?(prevPos=this._legacyPositionGetter?this._legacyPositionGetter():0,nextDelta=scale*diffY,nextPos=prevPos+nextDelta,nextVel=scale*velY):(prevPos=this._legacyPositionGetter?this._legacyPositionGetter():[0,0],nextDelta=[scale*diffX,scale*diffY],nextPos=[prevPos[0]+nextDelta[0],prevPos[1]+nextDelta[1]],nextVel=[scale*velX,scale*velY]);var payload=this._payload;payload.delta=nextDelta,payload.position=nextPos,payload.velocity=nextVel,payload.clientX=x,payload.clientY=y,payload.offsetX=event.offsetX,payload.offsetY=event.offsetY,this.output.emit("update",payload),this._prevCoord=currCoord,this._prevTime=currTime,this._prevVel=nextVel}}function _handleEnd(event){if(this._prevCoord){var prevTime=this._prevTime,currTime=Date.now();currTime-prevTime>this.options.stallTime&&(this._prevVel=void 0===this.options.direction?[0,0]:0);var payload=this._payload;payload.velocity=this._prevVel,payload.clientX=event.clientX,payload.clientY=event.clientY,payload.offsetX=event.offsetX,payload.offsetY=event.offsetY,this.output.emit("end",payload),this._prevCoord=void 0,this._prevTime=void 0,this._prevVel=void 0}}function _handleLeave(){if(this._prevCoord){var boundMove=_handleMove.bind(this),boundEnd=function(event){_handleEnd.call(this,event),document.removeEventListener("mousemove",boundMove),document.removeEventListener("mouseup",boundEnd)}.bind(this);document.addEventListener("mousemove",boundMove),document.addEventListener("mouseup",boundEnd)}}var EventHandler=require("../core/EventHandler");MouseSync.DIRECTION_X=0,MouseSync.DIRECTION_Y=1,MouseSync.prototype.getOptions=function(){return this.options},MouseSync.prototype.setOptions=function(options){void 0!==options.direction&&(this.options.direction=options.direction),void 0!==options.rails&&(this.options.rails=options.rails),void 0!==options.scale&&(this.options.scale=options.scale),void 0!==options.stallTime&&(this.options.stallTime=options.stallTime),void 0!==options.propogate&&(this.options.propogate=options.propogate)
},module.exports=MouseSync},{"../core/EventHandler":7}],24:[function(require,module){function PinchSync(legacyGetter,options){2===arguments.length?(this._legacyPositionGetter=arguments[0],options=arguments[1]):(this._legacyPositionGetter=null,options=arguments[0]),TwoFingerSync.call(this,this._legacyPositionGetter,options),this._dist=void 0}function _calcDist(posA,posB){var diffX=posB[0]-posA[0],diffY=posB[1]-posA[1];return Math.sqrt(diffX*diffX+diffY*diffY)}var TwoFingerSync=require("./TwoFingerSync");PinchSync.prototype=Object.create(TwoFingerSync.prototype),PinchSync.prototype.constructor=PinchSync,PinchSync.prototype._startUpdate=function(event){this._dist=_calcDist(this.posA,this.posB),this.output.emit("start",{count:event.touches.length,touches:[this.touchAId,this.touchBId],distance:this._dist})},PinchSync.prototype._moveUpdate=function(diffTime){var currDist=_calcDist(this.posA,this.posB),diffZ=currDist-this._dist,veloZ=diffZ/diffTime,prevPos=this._legacyPositionGetter?this._legacyPositionGetter():0,scale=this.options.scale;this.output.emit("update",{delta:diffZ,position:prevPos+scale*diffZ,velocity:scale*veloZ,touches:[this.touchAId,this.touchBId],distance:currDist}),this._dist=currDist},module.exports=PinchSync},{"./TwoFingerSync":30}],25:[function(require,module){function RotateSync(legacyGetter,options){2===arguments.length?(this._legacyPositionGetter=arguments[0],options=arguments[1]):(this._legacyPositionGetter=null,options=arguments[0]),TwoFingerSync.call(this,this._legacyPositionGetter,options),this._angle=0}function _calcAngle(posA,posB){var diffX=posB[0]-posA[0],diffY=posB[1]-posA[1];return Math.atan2(diffY,diffX)}var TwoFingerSync=require("./TwoFingerSync");RotateSync.prototype=Object.create(TwoFingerSync.prototype),RotateSync.prototype.constructor=RotateSync,RotateSync.prototype._startUpdate=function(event){this._angle=_calcAngle(this.posA,this.posB),this.output.emit("start",{count:event.touches.length,touches:[this.touchAId,this.touchBId],angle:this._angle})},RotateSync.prototype._moveUpdate=function(diffTime){var currAngle=_calcAngle(this.posA,this.posB),diffTheta=currAngle-this._angle,velTheta=diffTheta/diffTime,prevPos=this._legacyPositionGetter?this._legacyPositionGetter():0,scale=this.options.scale;this.output.emit("update",{delta:diffTheta,position:prevPos+scale*diffTheta,velocity:scale*velTheta,touches:[this.touchAId,this.touchBId],angle:currAngle}),this._angle=currAngle},module.exports=RotateSync},{"./TwoFingerSync":30}],26:[function(require,module){function ScaleSync(legacyGetter,options){2===arguments.length?(this._legacyPositionGetter=arguments[0],options=arguments[1]):(this._legacyPositionGetter=null,options=arguments[0]),TwoFingerSync.call(this,this._legacyPositionGetter,options),this._startDist=0,this._prevScale=1,this.input.on("pipe",_reset.bind(this))}function _calcDist(posA,posB){var diffX=posB[0]-posA[0],diffY=posB[1]-posA[1];return Math.sqrt(diffX*diffX+diffY*diffY)}function _reset(){this.touchAId=void 0,this.touchBId=void 0}var TwoFingerSync=require("./TwoFingerSync");ScaleSync.prototype=Object.create(TwoFingerSync.prototype),ScaleSync.prototype.constructor=ScaleSync,ScaleSync.prototype._startUpdate=function(event){this._prevScale=1,this._startDist=_calcDist(this.posA,this.posB),this._vel=0,this.output.emit("start",{count:event.touches.length,touches:[this.touchAId,this.touchBId],distance:this._startDist})},ScaleSync.prototype._moveUpdate=function(diffTime){var currDist=_calcDist(this.posA,this.posB),currScale=currDist/this._startDist,diffScale=currScale-this._prevScale,veloScale=diffScale/diffTime,prevPos=this._legacyPositionGetter?this._legacyPositionGetter():0,scale=this.options.scale;this.output.emit("update",{delta:diffScale,position:prevPos+scale*diffScale,velocity:scale*veloScale,touches:[this.touchAId,this.touchBId],distance:currDist}),this._prevScale=currScale,this._vel=veloScale},module.exports=ScaleSync},{"./TwoFingerSync":30}],27:[function(require,module){function ScrollSync(legacyGetter,options){2===arguments.length?(this._legacyPositionGetter=arguments[0],options=arguments[1]):(this._legacyPositionGetter=null,options=arguments[0]),this.options={direction:void 0,minimumEndSpeed:1/0,rails:!1,scale:1,stallTime:50,lineHeight:40},this.setOptions(options?options:this.options),this._payload={delta:null,position:null,velocity:null,slip:!0},this.input=new EventHandler,this.output=new EventHandler,EventHandler.setInputHandler(this,this.input),EventHandler.setOutputHandler(this,this.output),this._prevTime=void 0,this._prevVel=void 0,this.input.on("mousewheel",_handleMove.bind(this)),this.input.on("wheel",_handleMove.bind(this)),this.inProgress=!1,this._loopBound=!1}function _newFrame(){var now=Date.now();if(this.inProgress&&now-this._prevTime>this.options.stallTime){var pos=void 0===this.options.direction?this._legacyPositionGetter?this._legacyPositionGetter:[0,0]:this._legacyPositionGetter?this._legacyPositionGetter:0;this.inProgress=!1;var finalVel=0;Math.abs(this._prevVel)>=this.options.minimumEndSpeed&&(finalVel=this._prevVel);var payload=this._payload;payload.position=pos,payload.velocity=finalVel,payload.slip=!0,this.output.emit("end",payload)}}function _handleMove(event){event.preventDefault(),this.inProgress||(this.inProgress=!0,this.output.emit("start",{slip:!0}),this._loopBound||(Engine.on("prerender",_newFrame.bind(this)),this._loopBound=!0));var prevTime=this._prevTime||Date.now(),diffX=void 0!==event.wheelDeltaX?event.wheelDeltaX:-event.deltaX,diffY=void 0!==event.wheelDeltaY?event.wheelDeltaY:-event.deltaY;1===event.deltaMode&&(diffX*=this.options.lineHeight,diffY*=this.options.lineHeight);var currTime=Date.now();this.options.rails&&(Math.abs(diffX)>Math.abs(diffY)?diffY=0:diffX=0);var prevPos,nextPos,nextVel,nextDelta,diffTime=Math.max(currTime-prevTime,8),velX=diffX/diffTime,velY=diffY/diffTime,scale=this.options.scale;this.options.direction===ScrollSync.DIRECTION_X?(prevPos=this._legacyPositionGetter?this._legacyPositionGetter():0,nextDelta=scale*diffX,nextPos=prevPos+nextDelta,nextVel=scale*velX):this.options.direction===ScrollSync.DIRECTION_Y?(prevPos=this._legacyPositionGetter?this._legacyPositionGetter():0,nextDelta=scale*diffY,nextPos=prevPos+nextDelta,nextVel=scale*velY):(prevPos=this._legacyPositionGetter?this._legacyPositionGetter():[0,0],nextDelta=[scale*diffX,scale*diffY],nextPos=[prevPos[0]+nextDelta[0],prevPos[1]+nextDelta[1]],nextVel=[scale*velX,scale*velY]);var payload=this._payload;payload.delta=nextDelta,payload.position=nextPos,payload.velocity=nextVel,payload.slip=!0,this.output.emit("update",payload),this._prevTime=currTime,this._prevVel=nextVel}var EventHandler=require("../core/EventHandler"),Engine=require("../core/Engine");ScrollSync.DIRECTION_X=0,ScrollSync.DIRECTION_Y=1,ScrollSync.prototype.getOptions=function(){return this.options},ScrollSync.prototype.setOptions=function(options){void 0!==options.direction&&(this.options.direction=options.direction),void 0!==options.minimumEndSpeed&&(this.options.minimumEndSpeed=options.minimumEndSpeed),void 0!==options.rails&&(this.options.rails=options.rails),void 0!==options.scale&&(this.options.scale=options.scale),void 0!==options.stallTime&&(this.options.stallTime=options.stallTime)},module.exports=ScrollSync},{"../core/Engine":4,"../core/EventHandler":7}],28:[function(require,module){function TouchSync(legacyGetter,options){2===arguments.length?(this._legacyPositionGetter=arguments[0],options=arguments[1]):(this._legacyPositionGetter=null,options=arguments[0]),this.output=new EventHandler,this.touchTracker=new TouchTracker,this.options={direction:void 0,rails:!1,scale:1},this._payload={delta:null,position:null,velocity:null,clientX:void 0,clientY:void 0,count:0,touch:void 0},this.setOptions(options?options:this.options),EventHandler.setOutputHandler(this,this.output),EventHandler.setInputHandler(this,this.touchTracker),this.touchTracker.on("trackstart",_handleStart.bind(this)),this.touchTracker.on("trackmove",_handleMove.bind(this)),this.touchTracker.on("trackend",_handleEnd.bind(this))}function _clearPayload(){var payload=this._payload;payload.position=null,payload.velocity=null,payload.clientX=void 0,payload.clientY=void 0,payload.count=void 0,payload.touch=void 0}function _handleStart(data){_clearPayload.call(this);var payload=this._payload;payload.count=data.count,payload.touch=data.identifier,this.output.emit("start",payload)}function _handleMove(data){var history=data.history,prevTime=history[history.length-2].timestamp,currTime=history[history.length-1].timestamp,prevTouch=history[history.length-2].touch,currTouch=history[history.length-1].touch,diffX=currTouch.pageX-prevTouch.pageX,diffY=currTouch.pageY-prevTouch.pageY;this.options.rails&&(Math.abs(diffX)>Math.abs(diffY)?diffY=0:diffX=0);var prevPos,nextPos,nextVel,nextDelta,diffTime=Math.max(currTime-prevTime,8),velX=diffX/diffTime,velY=diffY/diffTime,scale=this.options.scale;this.options.direction===TouchSync.DIRECTION_X?(prevPos=this._legacyPositionGetter?this._legacyPositionGetter():0,nextDelta=scale*diffX,nextPos=prevPos+nextDelta,nextVel=scale*velX):this.options.direction===TouchSync.DIRECTION_Y?(prevPos=this._legacyPositionGetter?this._legacyPositionGetter():0,nextDelta=scale*diffY,nextPos=prevPos+nextDelta,nextVel=scale*velY):(prevPos=this._legacyPositionGetter?this._legacyPositionGetter():[0,0],nextDelta=[scale*diffX,scale*diffY],nextPos=[prevPos[0]+nextDelta[0],prevPos[1]+nextDelta[1]],nextVel=[scale*velX,scale*velY]);var payload=this._payload;payload.delta=nextDelta,payload.position=nextPos,payload.velocity=nextVel,payload.clientX=data.touch.clientX,payload.clientY=data.touch.clientY,payload.count=data.count,payload.touch=data.touch.identifier,this.output.emit("update",payload)}function _handleEnd(data){var nextVel=void 0!==this.options.direction?0:[0,0],history=data.history,count=data.count;if(history.length>1){var prevTime=history[history.length-2].timestamp,currTime=history[history.length-1].timestamp,prevTouch=history[history.length-2].touch,currTouch=history[history.length-1].touch,diffX=currTouch.pageX-prevTouch.pageX,diffY=currTouch.pageY-prevTouch.pageY;this.options.rails&&(Math.abs(diffX)>Math.abs(diffY)?diffY=0:diffX=0);var diffTime=Math.max(currTime-prevTime,1),velX=diffX/diffTime,velY=diffY/diffTime,scale=this.options.scale;nextVel=this.options.direction===TouchSync.DIRECTION_X?scale*velX:this.options.direction===TouchSync.DIRECTION_Y?scale*velY:[scale*velX,scale*velY]}var payload=this._payload;payload.velocity=nextVel,payload.clientX=data.clientX,payload.clientY=data.clientY,payload.count=count,payload.touch=data.touch.identifier,this.output.emit("end",payload)}var TouchTracker=require("./TouchTracker"),EventHandler=require("../core/EventHandler");TouchSync.DIRECTION_X=0,TouchSync.DIRECTION_Y=1,TouchSync.prototype.setOptions=function(options){void 0!==options.direction&&(this.options.direction=options.direction),void 0!==options.rails&&(this.options.rails=options.rails),void 0!==options.scale&&(this.options.scale=options.scale)},TouchSync.prototype.getOptions=function(){return this.options},module.exports=TouchSync},{"../core/EventHandler":7,"./TouchTracker":29}],29:[function(require,module){function _timestampTouch(touch,origin,history,count){var touchClone={};for(var i in touch)touchClone[i]=touch[i];return{touch:touchClone,origin:origin,timestamp:Date.now(),count:count,history:history}}function _handleStart(event){for(var i=0;i<event.changedTouches.length;i++){var touch=event.changedTouches[i],data=_timestampTouch(touch,event.origin,void 0,event.touches.length);this.eventOutput.emit("trackstart",data),this.selective||this.touchHistory[touch.identifier]||this.track(data)}}function _handleMove(event){for(var i=0;i<event.changedTouches.length;i++){var touch=event.changedTouches[i],history=this.touchHistory[touch.identifier];if(history){var data=_timestampTouch(touch,event.origin,history,event.touches.length);this.touchHistory[touch.identifier].push(data),this.eventOutput.emit("trackmove",data)}}}function _handleEnd(event){for(var i=0;i<event.changedTouches.length;i++){var touch=event.changedTouches[i],history=this.touchHistory[touch.identifier];if(history){var data=_timestampTouch(touch,event.origin,history,event.touches.length);this.eventOutput.emit("trackend",data),delete this.touchHistory[touch.identifier]}}}function _handleUnpipe(){for(var i in this.touchHistory){var history=this.touchHistory[i];this.eventOutput.emit("trackend",{touch:history[history.length-1].touch,timestamp:Date.now(),count:0,history:history}),delete this.touchHistory[i]}}function TouchTracker(selective){this.selective=selective,this.touchHistory={},this.eventInput=new EventHandler,this.eventOutput=new EventHandler,EventHandler.setInputHandler(this,this.eventInput),EventHandler.setOutputHandler(this,this.eventOutput),this.eventInput.on("touchstart",_handleStart.bind(this)),this.eventInput.on("touchmove",_handleMove.bind(this)),this.eventInput.on("touchend",_handleEnd.bind(this)),this.eventInput.on("touchcancel",_handleEnd.bind(this)),this.eventInput.on("unpipe",_handleUnpipe.bind(this))}var EventHandler=require("../core/EventHandler");TouchTracker.prototype.track=function(data){this.touchHistory[data.touch.identifier]=[data]},module.exports=TouchTracker},{"../core/EventHandler":7}],30:[function(require,module){function TwoFingerSync(legacyGetter,options){2===arguments.length?(this._legacyPositionGetter=arguments[0],options=arguments[1]):(this._legacyPositionGetter=null,options=arguments[0]),this.options={scale:1},this.setOptions(options?options:this.options),this.input=new EventHandler,this.output=new EventHandler,EventHandler.setInputHandler(this,this.input),EventHandler.setOutputHandler(this,this.output),this.touchAEnabled=!1,this.touchAId=0,this.posA=null,this.timestampA=0,this.touchBEnabled=!1,this.touchBId=0,this.posB=null,this.timestampB=0,this.input.on("touchstart",this.handleStart.bind(this)),this.input.on("touchmove",this.handleMove.bind(this)),this.input.on("touchend",this.handleEnd.bind(this)),this.input.on("touchcancel",this.handleEnd.bind(this))}var EventHandler=require("../core/EventHandler");TwoFingerSync.prototype.getOptions=function(){return this.options},TwoFingerSync.prototype.setOptions=function(options){void 0!==options.scale&&(this.options.scale=options.scale)},TwoFingerSync.prototype.handleStart=function(event){for(var i=0;i<event.changedTouches.length;i++){var touch=event.changedTouches[i];this.touchAEnabled?this.touchBEnabled||(this.touchBId=touch.identifier,this.touchBEnabled=!0,this.posB=[touch.pageX,touch.pageY],this.timestampB=Date.now(),this._startUpdate(event)):(this.touchAId=touch.identifier,this.touchAEnabled=!0,this.posA=[touch.pageX,touch.pageY],this.timestampA=Date.now())}},TwoFingerSync.prototype.handleMove=function(event){if(this.touchAEnabled&&this.touchBEnabled){for(var diffTime,prevTimeA=this.timestampA,prevTimeB=this.timestampB,i=0;i<event.changedTouches.length;i++){var touch=event.changedTouches[i];touch.identifier===this.touchAId?(this.posA=[touch.pageX,touch.pageY],this.timestampA=Date.now(),diffTime=this.timestampA-prevTimeA):touch.identifier===this.touchBId&&(this.posB=[touch.pageX,touch.pageY],this.timestampB=Date.now(),diffTime=this.timestampB-prevTimeB)}diffTime&&this._moveUpdate(diffTime)}},TwoFingerSync.prototype.handleEnd=function(event){for(var pos=void 0===this.options.direction?this._legacyPositionGetter?this._legacyPositionGetter:[0,0]:this._legacyPositionGetter?this._legacyPositionGetter:0,scale=this.options.scale,i=0;i<event.changedTouches.length;i++){var touch=event.changedTouches[i];(touch.identifier===this.touchAId||touch.identifier===this.touchBId)&&(this.touchAEnabled&&this.touchBEnabled&&this.output.emit("end",{position:pos,velocity:scale*this._vel,touches:[this.touchAId,this.touchBId],angle:this._angle}),this.touchAEnabled=!1,this.touchAId=0,this.touchBEnabled=!1,this.touchBId=0)}},module.exports=TwoFingerSync},{"../core/EventHandler":7}],31:[function(require,module){function Matrix(values){return this.values=values||[[1,0,0],[0,1,0],[0,0,1]],this}var Vector=require("./Vector"),_register=new Matrix,_vectorRegister=new Vector;Matrix.prototype.get=function(){return this.values},Matrix.prototype.set=function(values){this.values=values},Matrix.prototype.vectorMultiply=function(v){var M=this.get(),v0=v.x,v1=v.y,v2=v.z,M0=M[0],M1=M[1],M2=M[2],M00=M0[0],M01=M0[1],M02=M0[2],M10=M1[0],M11=M1[1],M12=M1[2],M20=M2[0],M21=M2[1],M22=M2[2];return _vectorRegister.setXYZ(M00*v0+M01*v1+M02*v2,M10*v0+M11*v1+M12*v2,M20*v0+M21*v1+M22*v2)},Matrix.prototype.multiply=function(M2){for(var M1=this.get(),result=[[]],i=0;3>i;i++){result[i]=[];for(var j=0;3>j;j++){for(var sum=0,k=0;3>k;k++)sum+=M1[i][k]*M2[k][j];result[i][j]=sum}}return _register.set(result)},Matrix.prototype.transpose=function(){for(var result=[],M=this.get(),row=0;3>row;row++)for(var col=0;3>col;col++)result[row][col]=M[col][row];return _register.set(result)},Matrix.prototype.clone=function(){for(var values=this.get(),M=[],row=0;3>row;row++)M[row]=values[row].slice();return new Matrix(M)},module.exports=Matrix},{"./Vector":35}],32:[function(require,module){function Quaternion(w,x,y,z){return 1===arguments.length?this.set(w):(this.w=void 0!==w?w:1,this.x=void 0!==x?x:0,this.y=void 0!==y?y:0,this.z=void 0!==z?z:0),this}var Matrix=require("./Matrix"),register=new Quaternion(1,0,0,0);Quaternion.prototype.add=function(q){return register.setWXYZ(this.w+q.w,this.x+q.x,this.y+q.y,this.z+q.z)},Quaternion.prototype.sub=function(q){return register.setWXYZ(this.w-q.w,this.x-q.x,this.y-q.y,this.z-q.z)},Quaternion.prototype.scalarDivide=function(s){return this.scalarMultiply(1/s)},Quaternion.prototype.scalarMultiply=function(s){return register.setWXYZ(this.w*s,this.x*s,this.y*s,this.z*s)},Quaternion.prototype.multiply=function(q){var x1=this.x,y1=this.y,z1=this.z,w1=this.w,x2=q.x,y2=q.y,z2=q.z,w2=q.w||0;return register.setWXYZ(w1*w2-x1*x2-y1*y2-z1*z2,x1*w2+x2*w1+y2*z1-y1*z2,y1*w2+y2*w1+x1*z2-x2*z1,z1*w2+z2*w1+x2*y1-x1*y2)};var conj=new Quaternion(1,0,0,0);Quaternion.prototype.rotateVector=function(v){return conj.set(this.conj()),register.set(this.multiply(v).multiply(conj))},Quaternion.prototype.inverse=function(){return register.set(this.conj().scalarDivide(this.normSquared()))},Quaternion.prototype.negate=function(){return this.scalarMultiply(-1)},Quaternion.prototype.conj=function(){return register.setWXYZ(this.w,-this.x,-this.y,-this.z)},Quaternion.prototype.normalize=function(length){return length=void 0===length?1:length,this.scalarDivide(length*this.norm())},Quaternion.prototype.makeFromAngleAndAxis=function(angle,v){var n=v.normalize(),ha=.5*angle,s=-Math.sin(ha);return this.x=s*n.x,this.y=s*n.y,this.z=s*n.z,this.w=Math.cos(ha),this},Quaternion.prototype.setWXYZ=function(w,x,y,z){return register.clear(),this.w=w,this.x=x,this.y=y,this.z=z,this},Quaternion.prototype.set=function(v){return v instanceof Array?(this.w=v[0],this.x=v[1],this.y=v[2],this.z=v[3]):(this.w=v.w,this.x=v.x,this.y=v.y,this.z=v.z),this!==register&&register.clear(),this},Quaternion.prototype.put=function(q){q.set(register)},Quaternion.prototype.clone=function(){return new Quaternion(this)},Quaternion.prototype.clear=function(){return this.w=1,this.x=0,this.y=0,this.z=0,this},Quaternion.prototype.isEqual=function(q){return q.w===this.w&&q.x===this.x&&q.y===this.y&&q.z===this.z},Quaternion.prototype.dot=function(q){return this.w*q.w+this.x*q.x+this.y*q.y+this.z*q.z},Quaternion.prototype.normSquared=function(){return this.dot(this)},Quaternion.prototype.norm=function(){return Math.sqrt(this.normSquared())},Quaternion.prototype.isZero=function(){return!(this.x||this.y||this.z)},Quaternion.prototype.getTransform=function(){var temp=this.normalize(1),x=temp.x,y=temp.y,z=temp.z,w=temp.w;return[1-2*y*y-2*z*z,2*x*y-2*z*w,2*x*z+2*y*w,0,2*x*y+2*z*w,1-2*x*x-2*z*z,2*y*z-2*x*w,0,2*x*z-2*y*w,2*y*z+2*x*w,1-2*x*x-2*y*y,0,0,0,0,1]};var matrixRegister=new Matrix;Quaternion.prototype.getMatrix=function(){var temp=this.normalize(1),x=temp.x,y=temp.y,z=temp.z,w=temp.w;return matrixRegister.set([[1-2*y*y-2*z*z,2*x*y+2*z*w,2*x*z-2*y*w],[2*x*y-2*z*w,1-2*x*x-2*z*z,2*y*z+2*x*w],[2*x*z+2*y*w,2*y*z-2*x*w,1-2*x*x-2*y*y]])};var epsilon=1e-5;Quaternion.prototype.slerp=function(q,t){var omega,cosomega,sinomega,scaleFrom,scaleTo;return cosomega=this.dot(q),1-cosomega>epsilon?(omega=Math.acos(cosomega),sinomega=Math.sin(omega),scaleFrom=Math.sin((1-t)*omega)/sinomega,scaleTo=Math.sin(t*omega)/sinomega):(scaleFrom=1-t,scaleTo=t),register.set(this.scalarMultiply(scaleFrom/scaleTo).add(q).multiply(scaleTo))},module.exports=Quaternion},{"./Matrix":31}],33:[function(require,module){function _randomFloat(min,max){return min+RAND()*(max-min)}function _randomInteger(min,max){return min+RAND()*(max-min+1)>>0}var RAND=Math.random,Random={};Random.integer=function(min,max,dim){if(min=void 0!==min?min:0,max=void 0!==max?max:1,void 0!==dim){for(var result=[],i=0;dim>i;i++)result.push(_randomInteger(min,max));return result}return _randomInteger(min,max)},Random.range=function(min,max,dim){if(min=void 0!==min?min:0,max=void 0!==max?max:1,void 0!==dim){for(var result=[],i=0;dim>i;i++)result.push(_randomFloat(min,max));return result}return _randomFloat(min,max)},Random.sign=function(prob){return prob=void 0!==prob?prob:.5,RAND()<prob?1:-1},Random.bool=function(prob){return prob=void 0!==prob?prob:.5,RAND()<prob},module.exports=Random},{}],34:[function(require,module){var Utilities={};Utilities.clamp=function(value,range){return Math.max(Math.min(value,range[1]),range[0])},Utilities.length=function(array){for(var distanceSquared=0,i=0;i<array.length;i++)distanceSquared+=array[i]*array[i];return Math.sqrt(distanceSquared)},module.exports=Utilities},{}],35:[function(require,module){function Vector(x,y,z){return 1===arguments.length?this.set(x):(this.x=x||0,this.y=y||0,this.z=z||0),this}function _setXYZ(x,y,z){return this.x=x,this.y=y,this.z=z,this}function _setFromArray(v){return _setXYZ.call(this,v[0],v[1],v[2]||0)}function _setFromVector(v){return _setXYZ.call(this,v.x,v.y,v.z)}function _setFromNumber(x){return _setXYZ.call(this,x,0,0)}var _register=new Vector(0,0,0);Vector.prototype.add=function(v){return _setXYZ.call(_register,this.x+v.x,this.y+v.y,this.z+v.z)},Vector.prototype.sub=function(v){return _setXYZ.call(_register,this.x-v.x,this.y-v.y,this.z-v.z)},Vector.prototype.mult=function(r){return _setXYZ.call(_register,r*this.x,r*this.y,r*this.z)},Vector.prototype.div=function(r){return this.mult(1/r)},Vector.prototype.cross=function(v){var x=this.x,y=this.y,z=this.z,vx=v.x,vy=v.y,vz=v.z;return _setXYZ.call(_register,z*vy-y*vz,x*vz-z*vx,y*vx-x*vy)},Vector.prototype.equals=function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z},Vector.prototype.rotateX=function(theta){var x=this.x,y=this.y,z=this.z,cosTheta=Math.cos(theta),sinTheta=Math.sin(theta);return _setXYZ.call(_register,x,y*cosTheta-z*sinTheta,y*sinTheta+z*cosTheta)},Vector.prototype.rotateY=function(theta){var x=this.x,y=this.y,z=this.z,cosTheta=Math.cos(theta),sinTheta=Math.sin(theta);return _setXYZ.call(_register,z*sinTheta+x*cosTheta,y,z*cosTheta-x*sinTheta)},Vector.prototype.rotateZ=function(theta){var x=this.x,y=this.y,z=this.z,cosTheta=Math.cos(theta),sinTheta=Math.sin(theta);return _setXYZ.call(_register,x*cosTheta-y*sinTheta,x*sinTheta+y*cosTheta,z)},Vector.prototype.dot=function(v){return this.x*v.x+this.y*v.y+this.z*v.z},Vector.prototype.normSquared=function(){return this.dot(this)},Vector.prototype.norm=function(){return Math.sqrt(this.normSquared())},Vector.prototype.normalize=function(length){0===arguments.length&&(length=1);var norm=this.norm();return norm>1e-7?_setFromVector.call(_register,this.mult(length/norm)):_setXYZ.call(_register,length,0,0)},Vector.prototype.clone=function(){return new Vector(this)},Vector.prototype.isZero=function(){return!(this.x||this.y||this.z)},Vector.prototype.set=function(v){return v instanceof Array?_setFromArray.call(this,v):v instanceof Vector?_setFromVector.call(this,v):"number"==typeof v?_setFromNumber.call(this,v):void 0},Vector.prototype.setXYZ=function(){return _setXYZ.apply(this,arguments)},Vector.prototype.set1D=function(x){return _setFromNumber.call(this,x)},Vector.prototype.put=function(v){_setFromVector.call(v,_register)},Vector.prototype.clear=function(){return _setXYZ.call(this,0,0,0)},Vector.prototype.cap=function cap(cap){if(1/0===cap)return _setFromVector.call(_register,this);var norm=this.norm();return norm>cap?_setFromVector.call(_register,this.mult(cap/norm)):_setFromVector.call(_register,this)},Vector.prototype.project=function(n){return n.mult(this.dot(n))},Vector.prototype.reflectAcross=function(n){return n.normalize().put(n),_setFromVector(_register,this.sub(this.project(n).mult(2)))},Vector.prototype.get=function(){return[this.x,this.y,this.z]},Vector.prototype.get1D=function(){return this.x},module.exports=Vector},{}],36:[function(require,module){function Draggable(options){this.options=Object.create(Draggable.DEFAULT_OPTIONS),options&&this.setOptions(options),this._positionState=new Transitionable([0,0]),this._differential=[0,0],this._active=!0,this.sync=new GenericSync(function(){return this._differential}.bind(this),{scale:this.options.scale,syncClasses:[MouseSync,TouchSync]}),this.eventOutput=new EventHandler,EventHandler.setInputHandler(this,this.sync),EventHandler.setOutputHandler(this,this.eventOutput),_bindEvents.call(this)}function _mapDifferential(differential){var opts=this.options,projection=opts.projection,snapX=opts.snapX,snapY=opts.snapY,tx=projection&_direction.x?differential[0]:0,ty=projection&_direction.y?differential[1]:0;return snapX>0&&(tx-=tx%snapX),snapY>0&&(ty-=ty%snapY),[tx,ty]}function _handleStart(){this._active&&(this._positionState.isActive()&&this._positionState.halt(),this.eventOutput.emit("start",{position:this.getPosition()}))}function _handleMove(event){if(this._active){var options=this.options;this._differential=event.position;var newDifferential=_mapDifferential.call(this,this._differential);this._differential[0]-=newDifferential[0],this._differential[1]-=newDifferential[1];var pos=this.getPosition();pos[0]+=newDifferential[0],pos[1]+=newDifferential[1];var xRange=[options.xRange[0]+.5*options.snapX,options.xRange[1]-.5*options.snapX],yRange=[options.yRange[0]+.5*options.snapY,options.yRange[1]-.5*options.snapY];pos[0]=_clamp(pos[0],xRange),pos[1]=_clamp(pos[1],yRange),this.eventOutput.emit("update",{position:pos})}}function _handleEnd(){this._active&&this.eventOutput.emit("end",{position:this.getPosition()})}function _bindEvents(){this.sync.on("start",_handleStart.bind(this)),this.sync.on("update",_handleMove.bind(this)),this.sync.on("end",_handleEnd.bind(this))}var Transform=require("../core/Transform"),MouseSync=require("../inputs/MouseSync"),TouchSync=require("../inputs/TouchSync"),GenericSync=require("../inputs/GenericSync"),Transitionable=require("../transitions/Transitionable"),EventHandler=require("../core/EventHandler"),Utilities=require("../math/Utilities"),_direction={x:1,y:2},_clamp=Utilities.clamp;Draggable.DEFAULT_OPTIONS={projection:_direction.x|_direction.y,scale:1,xRange:[-1/0,1/0],yRange:[-1/0,1/0],snapX:0,snapY:0,transition:{duration:0}},Draggable.prototype.setOptions=function(options){var currentOptions=this.options;if(void 0!==options.projection){var proj=options.projection;this.options.projection=0,["x","y"].forEach(function(val){-1!==proj.indexOf(val)&&(currentOptions.projection|=_direction[val])})}void 0!==options.scale&&(currentOptions.scale=options.scale),void 0!==options.xRange&&(currentOptions.xRange=options.xRange),void 0!==options.yRange&&(currentOptions.yRange=options.yRange),void 0!==options.snapX&&(currentOptions.snapX=options.snapX),void 0!==options.snapY&&(currentOptions.snapY=options.snapY)},Draggable.prototype.getPosition=function(){return this._positionState.get()},Draggable.prototype.setRelativePosition=function(p,transition,callback){var pos=this.getPosition(),relativePosition=[pos[0]+p[0],pos[1]+p[1]];this.setPosition(relativePosition,transition,callback)},Draggable.prototype.setPosition=function(p,transition,callback){this._positionState.isActive()&&this._positionState.halt(),this._positionState.set(p,transition,callback)},Draggable.prototype.activate=function(){this._active=!0},Draggable.prototype.deactivate=function(){this._active=!1},Draggable.prototype.toggle=function(){this._active=!this._active},Draggable.prototype.modify=function(target){var pos=this.getPosition();return{transform:Transform.translate(pos[0],pos[1]),target:target}},module.exports=Draggable},{"../core/EventHandler":7,"../core/Transform":15,"../inputs/GenericSync":22,"../inputs/MouseSync":23,"../inputs/TouchSync":28,"../math/Utilities":34,"../transitions/Transitionable":71}],37:[function(require,module){function Fader(options,startState){this.options=Object.create(Fader.DEFAULT_OPTIONS),this._optionsManager=new OptionsManager(this.options),options&&this.setOptions(options),startState||(startState=0),this.transitionHelper=new Transitionable(startState)}var Transitionable=require("../transitions/Transitionable"),OptionsManager=require("../core/OptionsManager");Fader.DEFAULT_OPTIONS={cull:!1,transition:!0,pulseInTransition:!0,pulseOutTransition:!0},Fader.prototype.setOptions=function(options){return this._optionsManager.setOptions(options)},Fader.prototype.show=function(transition,callback){transition=transition||this.options.transition,this.set(1,transition,callback)},Fader.prototype.hide=function(transition,callback){transition=transition||this.options.transition,this.set(0,transition,callback)},Fader.prototype.set=function(state,transition,callback){this.halt(),this.transitionHelper.set(state,transition,callback)},Fader.prototype.halt=function(){this.transitionHelper.halt()},Fader.prototype.isVisible=function(){return this.transitionHelper.get()>0},Fader.prototype.modify=function(target){var currOpacity=this.transitionHelper.get();return this.options.cull&&!currOpacity?void 0:{opacity:currOpacity,target:target}},module.exports=Fader},{"../core/OptionsManager":10,"../transitions/Transitionable":71}],38:[function(require,module){function ModifierChain(){this._chain=[],arguments.length&&this.add.apply(this,arguments)}ModifierChain.prototype.addModifier=function(){Array.prototype.push.apply(this._chain,arguments)},ModifierChain.prototype.removeModifier=function(modifier){var index=this._chain.indexOf(modifier);0>index||this._chain.splice(index,1)},ModifierChain.prototype.modify=function(input){for(var chain=this._chain,result=input,i=0;i<chain.length;i++)result=chain[i].modify(result);return result},module.exports=ModifierChain},{}],39:[function(require,module){function StateModifier(options){this._transformState=new TransitionableTransform(Transform.identity),this._opacityState=new Transitionable(1),this._originState=new Transitionable([0,0]),this._sizeState=new Transitionable([0,0]),this._modifier=new Modifier({transform:this._transformState,opacity:this._opacityState,origin:null,size:null}),this._hasOrigin=!1,this._hasSize=!1,options&&(options.transform&&this.setTransform(options.transform),options.opacity&&this.setOpacity(options.opacity),options.origin&&this.setOrigin(options.origin),options.size&&this.setSize(options.size))}var Modifier=require("../core/Modifier"),Transform=require("../core/Transform"),Transitionable=require("../transitions/Transitionable"),TransitionableTransform=require("../transitions/TransitionableTransform");StateModifier.prototype.setTransform=function(transform,transition,callback){return this._transformState.set(transform,transition,callback),this},StateModifier.prototype.setOpacity=function(opacity,transition,callback){return this._opacityState.set(opacity,transition,callback),this},StateModifier.prototype.setOrigin=function(origin,transition,callback){return null===origin?(this._hasOrigin&&(this._modifier.originFrom(null),this._hasOrigin=!1),this):(this._hasOrigin||(this._hasOrigin=!0,this._modifier.originFrom(this._originState)),this._originState.set(origin,transition,callback),this)
},StateModifier.prototype.setSize=function(size,transition,callback){return null===size?(this._hasSize&&(this._modifier.sizeFrom(null),this._hasSize=!1),this):(this._hasSize||(this._hasSize=!0,this._modifier.sizeFrom(this._sizeState)),this._sizeState.set(size,transition,callback),this)},StateModifier.prototype.halt=function(){this._transformState.halt(),this._opacityState.halt(),this._originState.halt(),this._sizeState.halt()},StateModifier.prototype.getTransform=function(){return this._transformState.get()},StateModifier.prototype.getFinalTransform=function(){return this._transformState.getFinal()},StateModifier.prototype.getOpacity=function(){return this._opacityState.get()},StateModifier.prototype.getOrigin=function(){return this._hasOrigin?this._originState.get():null},StateModifier.prototype.getSize=function(){return this._hasSize?this._sizeState.get():null},StateModifier.prototype.modify=function(target){return this._modifier.modify(target)},module.exports=StateModifier},{"../core/Modifier":9,"../core/Transform":15,"../transitions/Transitionable":71,"../transitions/TransitionableTransform":72}],40:[function(require,module){function PhysicsEngine(options){this.options=Object.create(PhysicsEngine.DEFAULT_OPTIONS),options&&this.setOptions(options),this._particles=[],this._bodies=[],this._agents={},this._forces=[],this._constraints=[],this._buffer=0,this._timestamp=17,this._minTimeStep=1e3/120,this._maxTimestep=17,this._prevTime=now(),this._isSleeping=!1,this._eventHandler=null,this._currAgentId=0,this._hasBodies=!1}function _mapAgentArray(agent){return agent.applyForce?this._forces:agent.applyConstraint?this._constraints:void 0}function _attachOne(agent,targets,source){return void 0===targets&&(targets=this.getParticlesAndBodies()),targets instanceof Array||(targets=[targets]),this._agents[this._currAgentId]={agent:agent,targets:targets,source:source},_mapAgentArray.call(this,agent).push(this._currAgentId),this._currAgentId++}function _getBoundAgent(id){return this._agents[id]}function _updateForce(index){var boundAgent=_getBoundAgent.call(this,this._forces[index]);boundAgent.agent.applyForce(boundAgent.targets,boundAgent.source)}function _updateForces(){for(var index=this._forces.length-1;index>-1;index--)_updateForce.call(this,index)}function _updateConstraint(index,dt){var boundAgent=this._agents[this._constraints[index]];return boundAgent.agent.applyConstraint(boundAgent.targets,boundAgent.source,dt)}function _updateConstraints(dt){for(var iteration=0;iteration<this.options.constraintSteps;){for(var index=this._constraints.length-1;index>-1;index--)_updateConstraint.call(this,index,dt);iteration++}}function _updateVelocities(particle,dt){particle.integrateVelocity(dt)}function _updateAngularVelocities(body,dt){body.integrateAngularMomentum(dt),body.updateAngularVelocity()}function _updateOrientations(body,dt){body.integrateOrientation(dt)}function _updatePositions(particle,dt){particle.integratePosition(dt),particle.emit("update",particle)}function _integrate(dt){_updateForces.call(this,dt),this.forEach(_updateVelocities,dt),this.forEachBody(_updateAngularVelocities,dt),_updateConstraints.call(this,dt),this.forEachBody(_updateOrientations,dt),this.forEach(_updatePositions,dt)}function _getEnergyParticles(){var energy=0,particleEnergy=0;return this.forEach(function(particle){particleEnergy=particle.getEnergy(),energy+=particleEnergy,particleEnergy<particle.sleepTolerance&&particle.sleep()}),energy}function _getEnergyForces(){for(var energy=0,index=this._forces.length-1;index>-1;index--)energy+=this._forces[index].getEnergy()||0;return energy}function _getEnergyConstraints(){for(var energy=0,index=this._constraints.length-1;index>-1;index--)energy+=this._constraints[index].getEnergy()||0;return energy}var EventHandler=require("../core/EventHandler");PhysicsEngine.DEFAULT_OPTIONS={constraintSteps:1,sleepTolerance:1e-7};var now=function(){return Date.now}();PhysicsEngine.prototype.setOptions=function(opts){for(var key in opts)this.options[key]&&(this.options[key]=opts[key])},PhysicsEngine.prototype.addBody=function(body){return body._engine=this,body.isBody?(this._bodies.push(body),this._hasBodies=!0):this._particles.push(body),body},PhysicsEngine.prototype.removeBody=function(body){var array=body.isBody?this._bodies:this._particles,index=array.indexOf(body);if(index>-1){for(var i=0;i<Object.keys(this._agents);i++)this.detachFrom(i,body);array.splice(index,1)}0===this.getBodies().length&&(this._hasBodies=!1)},PhysicsEngine.prototype.attach=function(agents,targets,source){if(agents instanceof Array){for(var agentIDs=[],i=0;i<agents.length;i++)agentIDs[i]=_attachOne.call(this,agents[i],targets,source);return agentIDs}return _attachOne.call(this,agents,targets,source)},PhysicsEngine.prototype.attachTo=function(agentID,target){_getBoundAgent.call(this,agentID).targets.push(target)},PhysicsEngine.prototype.detach=function(id){var agent=this.getAgent(id),agentArray=_mapAgentArray.call(this,agent),index=agentArray.indexOf(id);agentArray.splice(index,1),delete this._agents[id]},PhysicsEngine.prototype.detachFrom=function(id,target){var boundAgent=_getBoundAgent.call(this,id);if(boundAgent.source===target)this.detach(id);else{var targets=boundAgent.targets,index=targets.indexOf(target);index>-1&&targets.splice(index,1)}},PhysicsEngine.prototype.detachAll=function(){this._agents={},this._forces=[],this._constraints=[],this._currAgentId=0},PhysicsEngine.prototype.getAgent=function(id){return _getBoundAgent.call(this,id).agent},PhysicsEngine.prototype.getParticles=function(){return this._particles},PhysicsEngine.prototype.getBodies=function(){return this._bodies},PhysicsEngine.prototype.getParticlesAndBodies=function(){return this.getParticles().concat(this.getBodies())},PhysicsEngine.prototype.forEachParticle=function(fn,dt){for(var particles=this.getParticles(),index=0,len=particles.length;len>index;index++)fn.call(this,particles[index],dt)},PhysicsEngine.prototype.forEachBody=function(fn,dt){if(this._hasBodies)for(var bodies=this.getBodies(),index=0,len=bodies.length;len>index;index++)fn.call(this,bodies[index],dt)},PhysicsEngine.prototype.forEach=function(fn,dt){this.forEachParticle(fn,dt),this.forEachBody(fn,dt)},PhysicsEngine.prototype.getEnergy=function(){return _getEnergyParticles.call(this)+_getEnergyForces.call(this)+_getEnergyConstraints.call(this)},PhysicsEngine.prototype.step=function(){var currTime=now(),dtFrame=currTime-this._prevTime;this._prevTime=currTime,dtFrame<this._minTimeStep||(dtFrame>this._maxTimeStep&&(dtFrame=this._maxTimestep),_integrate.call(this,this._timestamp))},PhysicsEngine.prototype.isSleeping=function(){return this._isSleeping},PhysicsEngine.prototype.sleep=function(){this.emit("end",this),this._isSleeping=!0},PhysicsEngine.prototype.wake=function(){this._prevTime=now(),this.emit("start",this),this._isSleeping=!1},PhysicsEngine.prototype.emit=function(type,data){null!==this._eventHandler&&this._eventHandler.emit(type,data)},PhysicsEngine.prototype.on=function(event,fn){null===this._eventHandler&&(this._eventHandler=new EventHandler),this._eventHandler.on(event,fn)},module.exports=PhysicsEngine},{"../core/EventHandler":7}],41:[function(require,module){function Body(options){Particle.call(this,options),options=options||{},this.orientation=new Quaternion,this.angularVelocity=new Vector,this.angularMomentum=new Vector,this.torque=new Vector,options.orientation&&this.orientation.set(options.orientation),options.angularVelocity&&this.angularVelocity.set(options.angularVelocity),options.angularMomentum&&this.angularMomentum.set(options.angularMomentum),options.torque&&this.torque.set(options.torque),this.setMomentsOfInertia(),this.angularVelocity.w=0,this.pWorld=new Vector}var Particle=require("./Particle"),Transform=require("../../core/Transform"),Vector=require("../../math/Vector"),Quaternion=require("../../math/Quaternion"),Matrix=require("../../math/Matrix");Body.DEFAULT_OPTIONS=Particle.DEFAULT_OPTIONS,Body.DEFAULT_OPTIONS.orientation=[0,0,0,1],Body.DEFAULT_OPTIONS.angularVelocity=[0,0,0],Body.AXES=Particle.AXES,Body.SLEEP_TOLERANCE=Particle.SLEEP_TOLERANCE,Body.INTEGRATOR=Particle.INTEGRATOR,Body.prototype=Object.create(Particle.prototype),Body.prototype.constructor=Body,Body.prototype.isBody=!0,Body.prototype.setMass=function(){Particle.prototype.setMass.apply(this,arguments),this.setMomentsOfInertia()},Body.prototype.setMomentsOfInertia=function(){this.inertia=new Matrix,this.inverseInertia=new Matrix},Body.prototype.updateAngularVelocity=function(){this.angularVelocity.set(this.inverseInertia.vectorMultiply(this.angularMomentum))},Body.prototype.toWorldCoordinates=function(localPosition){return this.pWorld.set(this.orientation.rotateVector(localPosition))},Body.prototype.getEnergy=function(){return Particle.prototype.getEnergy.call(this)+.5*this.inertia.vectorMultiply(this.angularVelocity).dot(this.angularVelocity)},Body.prototype.reset=function(p,v,q,L){Particle.prototype.reset.call(this,p,v),this.angularVelocity.clear(),this.setOrientation(q||[1,0,0,0]),this.setAngularMomentum(L||[0,0,0])},Body.prototype.setOrientation=function(q){this.orientation.set(q)},Body.prototype.setAngularVelocity=function(w){this.wake(),this.angularVelocity.set(w)},Body.prototype.setAngularMomentum=function(L){this.wake(),this.angularMomentum.set(L)},Body.prototype.applyForce=function(force,location){Particle.prototype.applyForce.call(this,force),void 0!==location&&this.applyTorque(location.cross(force))},Body.prototype.applyTorque=function(torque){this.wake(),this.torque.set(this.torque.add(torque))},Body.prototype.getTransform=function(){return Transform.thenMove(this.orientation.getTransform(),Transform.getTranslate(Particle.prototype.getTransform.call(this)))},Body.prototype._integrate=function(dt){Particle.prototype._integrate.call(this,dt),this.integrateAngularMomentum(dt),this.updateAngularVelocity(dt),this.integrateOrientation(dt)},Body.prototype.integrateAngularMomentum=function(dt){Body.INTEGRATOR.integrateAngularMomentum(this,dt)},Body.prototype.integrateOrientation=function(dt){Body.INTEGRATOR.integrateOrientation(this,dt)},module.exports=Body},{"../../core/Transform":15,"../../math/Matrix":31,"../../math/Quaternion":32,"../../math/Vector":35,"./Particle":43}],42:[function(require,module){function Circle(options){options=options||{},this.setRadius(options.radius||0),Body.call(this,options)}var Body=require("./Body"),Matrix=require("../../math/Matrix");Circle.prototype=Object.create(Body.prototype),Circle.prototype.constructor=Circle,Circle.prototype.setRadius=function(r){this.radius=r,this.size=[2*this.radius,2*this.radius],this.setMomentsOfInertia()},Circle.prototype.setMomentsOfInertia=function(){var m=this.mass,r=this.radius;this.inertia=new Matrix([[.25*m*r*r,0,0],[0,.25*m*r*r,0],[0,0,.5*m*r*r]]),this.inverseInertia=new Matrix([[4/(m*r*r),0,0],[0,4/(m*r*r),0],[0,0,2/(m*r*r)]])},module.exports=Circle},{"../../math/Matrix":31,"./Body":41}],43:[function(require,module){function Particle(options){options=options||{},this.position=new Vector,this.velocity=new Vector,this.force=new Vector;var defaults=Particle.DEFAULT_OPTIONS;this.setPosition(options.position||defaults.position),this.setVelocity(options.velocity||defaults.velocity),this.force.set(options.force||[0,0,0]),this.mass=void 0!==options.mass?options.mass:defaults.mass,this.axis=void 0!==options.axis?options.axis:defaults.axis,this.inverseMass=1/this.mass,this._isSleeping=!1,this._engine=null,this._eventOutput=null,this._positionGetter=null,this.transform=Transform.identity.slice(),this._spec={transform:this.transform,target:null}}function _createEventOutput(){this._eventOutput=new EventHandler,this._eventOutput.bindThis(this),EventHandler.setOutputHandler(this,this._eventOutput)}var Vector=require("../../math/Vector"),Transform=require("../../core/Transform"),EventHandler=require("../../core/EventHandler"),Integrator=require("../integrators/SymplecticEuler");Particle.DEFAULT_OPTIONS={position:[0,0,0],velocity:[0,0,0],mass:1,axis:void 0},Particle.SLEEP_TOLERANCE=1e-7,Particle.AXES={X:0,Y:1,Z:2},Particle.INTEGRATOR=new Integrator;var _events={start:"start",update:"update",end:"end"},now=function(){return Date.now}();Particle.prototype.sleep=function(){this._isSleeping||(this.emit(_events.end,this),this._isSleeping=!0)},Particle.prototype.wake=function(){this._isSleeping&&(this.emit(_events.start,this),this._isSleeping=!1,this._prevTime=now())},Particle.prototype.isBody=!1,Particle.prototype.setPosition=function(position){this.position.set(position)},Particle.prototype.setPosition1D=function(x){this.position.x=x},Particle.prototype.getPosition=function(){return this._positionGetter instanceof Function&&this.setPosition(this._positionGetter()),this._engine.step(),this.position.get()},Particle.prototype.getPosition1D=function(){return this._engine.step(),this.position.x},Particle.prototype.positionFrom=function(positionGetter){this._positionGetter=positionGetter},Particle.prototype.setVelocity=function(velocity){this.velocity.set(velocity),this.wake()},Particle.prototype.setVelocity1D=function(x){this.velocity.x=x,this.wake()},Particle.prototype.getVelocity=function(){return this.velocity.get()},Particle.prototype.getVelocity1D=function(){return this.velocity.x},Particle.prototype.setMass=function(mass){this.mass=mass,this.inverseMass=1/mass},Particle.prototype.getMass=function(){return this.mass},Particle.prototype.reset=function(position,velocity){this.setPosition(position||[0,0,0]),this.setVelocity(velocity||[0,0,0])},Particle.prototype.applyForce=function(force){force.isZero()||(this.force.add(force).put(this.force),this.wake())},Particle.prototype.applyImpulse=function(impulse){if(!impulse.isZero()){var velocity=this.velocity;velocity.add(impulse.mult(this.inverseMass)).put(velocity)}},Particle.prototype.integrateVelocity=function(dt){Particle.INTEGRATOR.integrateVelocity(this,dt)},Particle.prototype.integratePosition=function(dt){Particle.INTEGRATOR.integratePosition(this,dt)},Particle.prototype._integrate=function(dt){this.integrateVelocity(dt),this.integratePosition(dt)},Particle.prototype.getEnergy=function(){return.5*this.mass*this.velocity.normSquared()},Particle.prototype.getTransform=function(){this._engine.step();var position=this.position,axis=this.axis,transform=this.transform;return void 0!==axis&&(axis&~Particle.AXES.X&&(position.x=0),axis&~Particle.AXES.Y&&(position.y=0),axis&~Particle.AXES.Z&&(position.z=0)),transform[12]=position.x,transform[13]=position.y,transform[14]=position.z,transform},Particle.prototype.modify=function(target){var _spec=this._spec;return _spec.transform=this.getTransform(),_spec.target=target,_spec},Particle.prototype.emit=function(type,data){this._eventOutput&&this._eventOutput.emit(type,data)},Particle.prototype.on=function(){return _createEventOutput.call(this),this.on.apply(this,arguments)},Particle.prototype.removeListener=function(){return _createEventOutput.call(this),this.removeListener.apply(this,arguments)},Particle.prototype.pipe=function(){return _createEventOutput.call(this),this.pipe.apply(this,arguments)},Particle.prototype.unpipe=function(){return _createEventOutput.call(this),this.unpipe.apply(this,arguments)},module.exports=Particle},{"../../core/EventHandler":7,"../../core/Transform":15,"../../math/Vector":35,"../integrators/SymplecticEuler":60}],44:[function(require,module){function Rectangle(options){options=options||{},this.size=options.size||[0,0],Body.call(this,options)}var Body=require("./Body"),Matrix=require("../../math/Matrix");Rectangle.prototype=Object.create(Body.prototype),Rectangle.prototype.constructor=Rectangle,Rectangle.prototype.setSize=function(size){this.size=size,this.setMomentsOfInertia()},Rectangle.prototype.setMomentsOfInertia=function(){var m=this.mass,w=this.size[0],h=this.size[1];this.inertia=new Matrix([[m*h*h/12,0,0],[0,m*w*w/12,0],[0,0,m*(w*w+h*h)/12]]),this.inverseInertia=new Matrix([[12/(m*h*h),0,0],[0,12/(m*w*w),0],[0,0,12/(m*(w*w+h*h))]])},module.exports=Rectangle},{"../../math/Matrix":31,"./Body":41}],45:[function(require,module){function Collision(options){this.options=Object.create(Collision.DEFAULT_OPTIONS),options&&this.setOptions(options),this.normal=new Vector,this.pDiff=new Vector,this.vDiff=new Vector,this.impulse1=new Vector,this.impulse2=new Vector,Constraint.call(this)}var Constraint=require("./Constraint"),Vector=require("../../math/Vector");Collision.prototype=Object.create(Constraint.prototype),Collision.prototype.constructor=Collision,Collision.DEFAULT_OPTIONS={restitution:.5,drift:.5,slop:0},Collision.prototype.setOptions=function(options){for(var key in options)this.options[key]=options[key]},Collision.prototype.applyConstraint=function(targets,source,dt){if(void 0!==source)for(var v1=source.velocity,p1=source.position,w1=source.inverseMass,r1=source.radius,options=this.options,drift=options.drift,slop=-options.slop,restitution=options.restitution,n=this.normal,pDiff=this.pDiff,vDiff=this.vDiff,impulse1=this.impulse1,impulse2=this.impulse2,i=0;i<targets.length;i++){var target=targets[i];if(target!==source){var v2=target.velocity,p2=target.position,w2=target.inverseMass,r2=target.radius;pDiff.set(p2.sub(p1)),vDiff.set(v2.sub(v1));var dist=pDiff.norm(),overlap=dist-(r1+r2),effMass=1/(w1+w2),gamma=0;if(0>overlap){if(n.set(pDiff.normalize()),this._eventOutput){var collisionData={target:target,source:source,overlap:overlap,normal:n};this._eventOutput.emit("preCollision",collisionData),this._eventOutput.emit("collision",collisionData)}var lambda=slop>=overlap?((1+restitution)*n.dot(vDiff)+drift/dt*(overlap-slop))/(gamma+dt/effMass):(1+restitution)*n.dot(vDiff)/(gamma+dt/effMass);n.mult(dt*lambda).put(impulse1),impulse1.mult(-1).put(impulse2),source.applyImpulse(impulse1),target.applyImpulse(impulse2),this._eventOutput&&this._eventOutput.emit("postCollision",collisionData)}}}},module.exports=Collision},{"../../math/Vector":35,"./Constraint":46}],46:[function(require,module){function Constraint(){this.options=this.options||{},this._energy=0,this._eventOutput=null}function _createEventOutput(){this._eventOutput=new EventHandler,this._eventOutput.bindThis(this),EventHandler.setOutputHandler(this,this._eventOutput)}var EventHandler=require("../../core/EventHandler");Constraint.prototype.setOptions=function(options){for(var key in options)this.options[key]=options[key]},Constraint.prototype.applyConstraint=function(){},Constraint.prototype.getEnergy=function(){return this._energy},Constraint.prototype.setEnergy=function(energy){this._energy=energy},Constraint.prototype.on=function(){return _createEventOutput.call(this),this.on.apply(this,arguments)},Constraint.prototype.addListener=function(){return _createEventOutput.call(this),this.addListener.apply(this,arguments)},Constraint.prototype.pipe=function(){return _createEventOutput.call(this),this.pipe.apply(this,arguments)},Constraint.prototype.removeListener=function(){return this.removeListener.apply(this,arguments)},Constraint.prototype.unpipe=function(){return this.unpipe.apply(this,arguments)},module.exports=Constraint},{"../../core/EventHandler":7}],47:[function(require,module){function Curve(options){this.options=Object.create(Curve.DEFAULT_OPTIONS),options&&this.setOptions(options),this.J=new Vector,this.impulse=new Vector,Constraint.call(this)}var Constraint=require("./Constraint"),Vector=require("../../math/Vector");Curve.prototype=Object.create(Constraint.prototype),Curve.prototype.constructor=Curve;var epsilon=1e-7,pi=Math.PI;Curve.DEFAULT_OPTIONS={equation:function(){return 0},plane:function(x,y,z){return z},period:0,dampingRatio:0},Curve.prototype.setOptions=function(options){for(var key in options)this.options[key]=options[key]},Curve.prototype.applyConstraint=function(targets,source,dt){for(var options=this.options,impulse=this.impulse,J=this.J,f=options.equation,g=options.plane,dampingRatio=options.dampingRatio,period=options.period,i=0;i<targets.length;i++){var body=targets[i],v=body.velocity,p=body.position,m=body.mass;if(0===period)var gamma=0,beta=1;else var c=4*m*pi*dampingRatio/period,k=4*m*pi*pi/(period*period),gamma=1/(c+dt*k),beta=dt*k/(c+dt*k);var x=p.x,y=p.y,z=p.z,f0=f(x,y,z),dfx=(f(x+epsilon,p,p)-f0)/epsilon,dfy=(f(x,y+epsilon,p)-f0)/epsilon,dfz=(f(x,y,p+epsilon)-f0)/epsilon,g0=g(x,y,z),dgx=(g(x+epsilon,y,z)-g0)/epsilon,dgy=(g(x,y+epsilon,z)-g0)/epsilon,dgz=(g(x,y,z+epsilon)-g0)/epsilon;J.setXYZ(dfx+dgx,dfy+dgy,dfz+dgz);var antiDrift=beta/dt*(f0+g0),lambda=-(J.dot(v)+antiDrift)/(gamma+dt*J.normSquared()/m);impulse.set(J.mult(dt*lambda)),body.applyImpulse(impulse)}},module.exports=Curve},{"../../math/Vector":35,"./Constraint":46}],48:[function(require,module){function Distance(options){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),options&&this.setOptions(options),this.impulse=new Vector,this.normal=new Vector,this.diffP=new Vector,this.diffV=new Vector,Constraint.call(this)}var Constraint=require("./Constraint"),Vector=require("../../math/Vector");Distance.prototype=Object.create(Constraint.prototype),Distance.prototype.constructor=Distance,Distance.DEFAULT_OPTIONS={anchor:null,length:0,minLength:0,period:0,dampingRatio:0};var pi=Math.PI;Distance.prototype.setOptions=function(options){options.anchor&&(options.anchor.position instanceof Vector&&(this.options.anchor=options.anchor.position),options.anchor instanceof Vector&&(this.options.anchor=options.anchor),options.anchor instanceof Array&&(this.options.anchor=new Vector(options.anchor))),void 0!==options.length&&(this.options.length=options.length),void 0!==options.dampingRatio&&(this.options.dampingRatio=options.dampingRatio),void 0!==options.period&&(this.options.period=options.period),void 0!==options.minLength&&(this.options.minLength=options.minLength)},Distance.prototype.setAnchor=function(anchor){this.options.anchor||(this.options.anchor=new Vector),this.options.anchor.set(anchor)},Distance.prototype.applyConstraint=function(targets,source,dt){var n=this.normal,diffP=this.diffP,diffV=this.diffV,impulse=this.impulse,options=this.options,dampingRatio=options.dampingRatio,period=options.period,minLength=options.minLength;if(source)var p2=source.position,w2=source.inverseMass,v2=source.velocity;else var p2=this.options.anchor,w2=0;for(var length=this.options.length,i=0;i<targets.length;i++){var body=targets[i],v1=body.velocity,p1=body.position,w1=body.inverseMass;diffP.set(p1.sub(p2)),n.set(diffP.normalize());var dist=diffP.norm()-length;if(Math.abs(dist)<minLength)return;diffV.set(source?v1.sub(v2):v1);var effMass=1/(w1+w2);if(0===period)var gamma=0,beta=1;else var c=4*effMass*pi*dampingRatio/period,k=4*effMass*pi*pi/(period*period),gamma=1/(c+dt*k),beta=dt*k/(c+dt*k);var antiDrift=beta/dt*dist,lambda=-(n.dot(diffV)+antiDrift)/(gamma+dt/effMass);impulse.set(n.mult(dt*lambda)),body.applyImpulse(impulse),source&&source.applyImpulse(impulse.mult(-1))}},module.exports=Distance},{"../../math/Vector":35,"./Constraint":46}],49:[function(require,module){function Snap(options){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),options&&this.setOptions(options),this.pDiff=new Vector,this.vDiff=new Vector,this.impulse1=new Vector,this.impulse2=new Vector,Constraint.call(this)}function _calcEnergy(impulse,disp,dt){return Math.abs(impulse.dot(disp)/dt)}var Constraint=require("./Constraint"),Vector=require("../../math/Vector");Snap.prototype=Object.create(Constraint.prototype),Snap.prototype.constructor=Snap,Snap.DEFAULT_OPTIONS={period:300,dampingRatio:.1,length:0,anchor:void 0};var pi=Math.PI;Snap.prototype.setOptions=function(options){void 0!==options.anchor&&(options.anchor instanceof Vector&&(this.options.anchor=options.anchor),options.anchor.position instanceof Vector&&(this.options.anchor=options.anchor.position),options.anchor instanceof Array&&(this.options.anchor=new Vector(options.anchor))),void 0!==options.length&&(this.options.length=options.length),void 0!==options.dampingRatio&&(this.options.dampingRatio=options.dampingRatio),void 0!==options.period&&(this.options.period=options.period)},Snap.prototype.setAnchor=function(v){void 0!==this.options.anchor&&(this.options.anchor=new Vector),this.options.anchor.set(v)},Snap.prototype.getEnergy=function(target,source){var options=this.options,restLength=options.length,anchor=options.anchor||source.position,strength=Math.pow(2*pi/options.period,2),dist=anchor.sub(target.position).norm()-restLength;return.5*strength*dist*dist},Snap.prototype.applyConstraint=function(targets,source,dt){for(var options=this.options,pDiff=this.pDiff,vDiff=this.vDiff,impulse1=this.impulse1,impulse2=this.impulse2,length=options.length,anchor=options.anchor||source.position,period=options.period,dampingRatio=options.dampingRatio,i=0;i<targets.length;i++){var target=targets[i],p1=target.position,v1=target.velocity,m1=target.mass,w1=target.inverseMass;pDiff.set(p1.sub(anchor));var dist=pDiff.norm()-length;if(source){var w2=source.inverseMass,v2=source.velocity;vDiff.set(v1.sub(v2));var effMass=1/(w1+w2)}else{vDiff.set(v1);var effMass=m1}if(0===this.options.period)var gamma=0,beta=1;else var k=4*effMass*pi*pi/(period*period),c=4*effMass*pi*dampingRatio/period,beta=dt*k/(c+dt*k),gamma=1/(c+dt*k);var antiDrift=beta/dt*dist;pDiff.normalize(-antiDrift).sub(vDiff).mult(dt/(gamma+dt/effMass)).put(impulse1),target.applyImpulse(impulse1),source&&(impulse1.mult(-1).put(impulse2),source.applyImpulse(impulse2)),this.setEnergy(_calcEnergy(impulse1,pDiff,dt))}},module.exports=Snap},{"../../math/Vector":35,"./Constraint":46}],50:[function(require,module){function Surface(options){this.options=Object.create(Surface.DEFAULT_OPTIONS),options&&this.setOptions(options),this.J=new Vector,this.impulse=new Vector,Constraint.call(this)}var Constraint=require("./Constraint"),Vector=require("../../math/Vector");Surface.prototype=Object.create(Constraint.prototype),Surface.prototype.constructor=Surface,Surface.DEFAULT_OPTIONS={equation:void 0,period:0,dampingRatio:0};var epsilon=1e-7,pi=Math.PI;Surface.prototype.setOptions=function(options){for(var key in options)this.options[key]=options[key]},Surface.prototype.applyConstraint=function(targets,source,dt){for(var impulse=this.impulse,J=this.J,options=this.options,f=options.equation,dampingRatio=options.dampingRatio,period=options.period,i=0;i<targets.length;i++){var particle=targets[i],v=particle.velocity,p=particle.position,m=particle.mass;if(0===period)var gamma=0,beta=1;else var c=4*m*pi*dampingRatio/period,k=4*m*pi*pi/(period*period),gamma=1/(c+dt*k),beta=dt*k/(c+dt*k);var x=p.x,y=p.y,z=p.z,f0=f(x,y,z),dfx=(f(x+epsilon,p,p)-f0)/epsilon,dfy=(f(x,y+epsilon,p)-f0)/epsilon,dfz=(f(x,y,p+epsilon)-f0)/epsilon;J.setXYZ(dfx,dfy,dfz);var antiDrift=beta/dt*f0,lambda=-(J.dot(v)+antiDrift)/(gamma+dt*J.normSquared()/m);impulse.set(J.mult(dt*lambda)),particle.applyImpulse(impulse)}},module.exports=Surface},{"../../math/Vector":35,"./Constraint":46}],51:[function(require,module){function Wall(options){this.options=Object.create(Wall.DEFAULT_OPTIONS),options&&this.setOptions(options),this.diff=new Vector,this.impulse=new Vector,Constraint.call(this)}function _getNormalVelocity(n,v){return v.dot(n)}function _getDistanceFromOrigin(p){var n=this.options.normal,d=this.options.distance;return p.dot(n)+d}function _onEnter(particle,overlap,dt){var p=particle.position,v=particle.velocity,m=particle.mass,n=this.options.normal,action=this.options.onContact,restitution=this.options.restitution,impulse=this.impulse,drift=this.options.drift,slop=-this.options.slop,gamma=0;if(this._eventOutput){var data={particle:particle,wall:this,overlap:overlap,normal:n};this._eventOutput.emit("preCollision",data),this._eventOutput.emit("collision",data)}switch(action){case Wall.ON_CONTACT.REFLECT:var lambda=slop>overlap?-((1+restitution)*n.dot(v)+drift/dt*(overlap-slop))/(m*dt+gamma):-((1+restitution)*n.dot(v))/(m*dt+gamma);impulse.set(n.mult(dt*lambda)),particle.applyImpulse(impulse),particle.setPosition(p.add(n.mult(-overlap)))}this._eventOutput&&this._eventOutput.emit("postCollision",data)}function _onExit(particle,overlap){var action=this.options.onContact,p=particle.position,n=this.options.normal;action===Wall.ON_CONTACT.REFLECT&&particle.setPosition(p.add(n.mult(-overlap)))}var Constraint=require("./Constraint"),Vector=require("../../math/Vector");Wall.prototype=Object.create(Constraint.prototype),Wall.prototype.constructor=Wall,Wall.ON_CONTACT={REFLECT:0,SILENT:1},Wall.DEFAULT_OPTIONS={restitution:.5,drift:.5,slop:0,normal:[1,0,0],distance:0,onContact:Wall.ON_CONTACT.REFLECT},Wall.prototype.setOptions=function(options){void 0!==options.normal&&(options.normal instanceof Vector&&(this.options.normal=options.normal.clone()),options.normal instanceof Array&&(this.options.normal=new Vector(options.normal))),void 0!==options.restitution&&(this.options.restitution=options.restitution),void 0!==options.drift&&(this.options.drift=options.drift),void 0!==options.slop&&(this.options.slop=options.slop),void 0!==options.distance&&(this.options.distance=options.distance),void 0!==options.onContact&&(this.options.onContact=options.onContact)},Wall.prototype.applyConstraint=function(targets,source,dt){for(var n=this.options.normal,i=0;i<targets.length;i++){var particle=targets[i],p=particle.position,v=particle.velocity,r=particle.radius||0,overlap=_getDistanceFromOrigin.call(this,p.add(n.mult(-r))),nv=_getNormalVelocity.call(this,n,v);0>=overlap&&(0>nv?_onEnter.call(this,particle,overlap,dt):_onExit.call(this,particle,overlap,dt))}},module.exports=Wall},{"../../math/Vector":35,"./Constraint":46}],52:[function(require,module){function Walls(options){this.options=Object.create(Walls.DEFAULT_OPTIONS),options&&this.setOptions(options),_createComponents.call(this,options.sides||this.options.sides),Constraint.call(this)}function _getDistance(side,size,origin){var distance,SIDES=Walls.SIDES;switch(parseInt(side)){case SIDES.LEFT:distance=size[0]*origin[0];break;case SIDES.TOP:distance=size[1]*origin[1];break;case SIDES.FRONT:distance=size[2]*origin[2];break;case SIDES.RIGHT:distance=size[0]*(1-origin[0]);break;case SIDES.BOTTOM:distance=size[1]*(1-origin[1]);break;case SIDES.BACK:distance=size[2]*(1-origin[2])}return distance}function _createComponents(sides){this.components={};for(var components=this.components,i=0;i<sides.length;i++){var side=sides[i];components[i]=new Wall({normal:_SIDE_NORMALS[side].clone(),distance:_getDistance(side,this.options.size,this.options.origin)})}}function _setOptionsForEach(options){this.forEach(function(wall){wall.setOptions(options)});for(var key in options)this.options[key]=options[key]}var Constraint=require("./Constraint"),Wall=require("./Wall"),Vector=require("../../math/Vector");Walls.prototype=Object.create(Constraint.prototype),Walls.prototype.constructor=Walls,Walls.ON_CONTACT=Wall.ON_CONTACT,Walls.DEFAULT_OPTIONS={sides:Walls.TWO_DIMENSIONAL,size:[window.innerWidth,window.innerHeight,0],origin:[.5,.5,.5],drift:.5,slop:0,restitution:.5,onContact:Walls.ON_CONTACT.REFLECT},Walls.SIDES={LEFT:0,RIGHT:1,TOP:2,BOTTOM:3,FRONT:4,BACK:5,TWO_DIMENSIONAL:[0,1,2,3],THREE_DIMENSIONAL:[0,1,2,3,4,5]};var _SIDE_NORMALS={0:new Vector(1,0,0),1:new Vector(-1,0,0),2:new Vector(0,1,0),3:new Vector(0,-1,0),4:new Vector(0,0,1),5:new Vector(0,0,-1)};Walls.prototype.setOptions=function(options){var resizeFlag=!1;void 0!==options.restitution&&_setOptionsForEach.call(this,{restitution:options.restitution}),void 0!==options.drift&&_setOptionsForEach.call(this,{drift:options.drift}),void 0!==options.slop&&_setOptionsForEach.call(this,{slop:options.slop}),void 0!==options.onContact&&_setOptionsForEach.call(this,{onContact:options.onContact}),void 0!==options.size&&(resizeFlag=!0),void 0!==options.sides&&(this.options.sides=options.sides),void 0!==options.origin&&(resizeFlag=!0),resizeFlag&&this.setSize(options.size,options.origin)},Walls.prototype.setSize=function(size,origin){origin=origin||this.options.origin,origin.length<3&&(origin[2]=.5),this.forEach(function(wall,side){var d=_getDistance(side,size,origin);
wall.setOptions({distance:d})}),this.options.size=size,this.options.origin=origin},Walls.prototype.applyConstraint=function(targets,source,dt){this.forEach(function(wall){wall.applyConstraint(targets,source,dt)})},Walls.prototype.forEach=function(fn){for(var key in this.sides)fn(this.sides[key],key)},Walls.prototype.rotateZ=function(angle){this.forEach(function(wall){var n=wall.options.normal;n.rotateZ(angle).put(n)})},Walls.prototype.rotateX=function(angle){this.forEach(function(wall){var n=wall.options.normal;n.rotateX(angle).put(n)})},Walls.prototype.rotateY=function(angle){this.forEach(function(wall){var n=wall.options.normal;n.rotateY(angle).put(n)})},module.exports=Walls},{"../../math/Vector":35,"./Constraint":46,"./Wall":51}],53:[function(require,module){function Drag(options){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),options&&this.setOptions(options),Force.call(this)}var Force=require("./Force");Drag.prototype=Object.create(Force.prototype),Drag.prototype.constructor=Drag,Drag.FORCE_FUNCTIONS={LINEAR:function(velocity){return velocity},QUADRATIC:function(velocity){return velocity.mult(velocity.norm())}},Drag.DEFAULT_OPTIONS={strength:.01,forceFunction:Drag.FORCE_FUNCTIONS.LINEAR},Drag.prototype.applyForce=function(targets){for(var strength=this.options.strength,forceFunction=this.options.forceFunction,force=this.force,index=0;index<targets.length;index++){var particle=targets[index];forceFunction(particle.velocity).mult(-strength).put(force),particle.applyForce(force)}},Drag.prototype.setOptions=function(options){for(var key in options)this.options[key]=options[key]},module.exports=Drag},{"./Force":54}],54:[function(require,module){function Force(force){this.force=new Vector(force),this._energy=0,this._eventOutput=null}function _createEventOutput(){this._eventOutput=new EventHandler,this._eventOutput.bindThis(this),EventHandler.setOutputHandler(this,this._eventOutput)}var Vector=require("../../math/Vector"),EventHandler=require("../../core/EventHandler");Force.prototype.setOptions=function(options){for(var key in options)this.options[key]=options[key]},Force.prototype.applyForce=function(body){body.applyForce(this.force)},Force.prototype.getEnergy=function(){return this._energy},Force.prototype.setEnergy=function(energy){this._energy=energy},Force.prototype.on=function(){return _createEventOutput.call(this),this.on.apply(this,arguments)},Force.prototype.addListener=function(){return _createEventOutput.call(this),this.addListener.apply(this,arguments)},Force.prototype.pipe=function(){return _createEventOutput.call(this),this.pipe.apply(this,arguments)},Force.prototype.removeListener=function(){return this.removeListener.apply(this,arguments)},Force.prototype.unpipe=function(){return this.unpipe.apply(this,arguments)},module.exports=Force},{"../../core/EventHandler":7,"../../math/Vector":35}],55:[function(require,module){function Repulsion(options){this.options=Object.create(Repulsion.DEFAULT_OPTIONS),options&&this.setOptions(options),this.disp=new Vector,Force.call(this)}var Force=require("./Force"),Vector=require("../../math/Vector");Repulsion.prototype=Object.create(Force.prototype),Repulsion.prototype.constructor=Repulsion,Repulsion.DECAY_FUNCTIONS={LINEAR:function(r,cutoff){return Math.max(1-1/cutoff*r,0)},MORSE:function(r,cutoff){var r0=0===cutoff?100:cutoff,rShifted=r+r0*(1-Math.log(2));return Math.max(1-Math.pow(1-Math.exp(rShifted/r0-1),2),0)},INVERSE:function(r,cutoff){return 1/(1-cutoff+r)},GRAVITY:function(r,cutoff){return 1/(1-cutoff+r*r)}},Repulsion.DEFAULT_OPTIONS={strength:1,anchor:void 0,range:[0,1/0],cutoff:0,cap:1/0,decayFunction:Repulsion.DECAY_FUNCTIONS.GRAVITY},Repulsion.prototype.setOptions=function(options){void 0!==options.anchor&&(options.anchor.position instanceof Vector&&(this.options.anchor=options.anchor.position),options.anchor instanceof Array&&(this.options.anchor=new Vector(options.anchor)),delete options.anchor);for(var key in options)this.options[key]=options[key]},Repulsion.prototype.applyForce=function(targets,source){var options=this.options,force=this.force,disp=this.disp,strength=options.strength,anchor=options.anchor||source.position,cap=options.cap,cutoff=options.cutoff,rMin=options.range[0],rMax=options.range[1],decayFn=options.decayFunction;if(0!==strength)for(var index in targets){var particle=targets[index];if(particle!==source){var m1=particle.mass,p1=particle.position;disp.set(p1.sub(anchor));var r=disp.norm();rMax>r&&r>rMin&&(force.set(disp.normalize(strength*m1*decayFn(r,cutoff)).cap(cap)),particle.applyForce(force))}}},module.exports=Repulsion},{"../../math/Vector":35,"./Force":54}],56:[function(require,module){function RotationalDrag(options){Drag.call(this,options)}var Drag=require("./Drag");RotationalDrag.prototype=Object.create(Drag.prototype),RotationalDrag.prototype.constructor=RotationalDrag,RotationalDrag.DEFAULT_OPTIONS=Drag.DEFAULT_OPTIONS,RotationalDrag.FORCE_FUNCTIONS=Drag.FORCE_FUNCTIONS,RotationalDrag.FORCE_FUNCTIONS={LINEAR:function(angularVelocity){return angularVelocity},QUADRATIC:function(angularVelocity){return angularVelocity.mult(angularVelocity.norm())}},RotationalDrag.prototype.applyForce=function(targets){for(var strength=this.options.strength,forceFunction=this.options.forceFunction,force=this.force,index=0;index<targets.length;index++){var particle=targets[index];forceFunction(particle.angularVelocity).mult(-100*strength).put(force),particle.applyTorque(force)}},RotationalDrag.prototype.setOptions=function(options){for(var key in options)this.options[key]=options[key]},module.exports=RotationalDrag},{"./Drag":53}],57:[function(require,module){function RotationalSpring(options){Spring.call(this,options)}var Spring=require("./Spring");RotationalSpring.prototype=Object.create(Spring.prototype),RotationalSpring.prototype.constructor=RotationalSpring,RotationalSpring.DEFAULT_OPTIONS=Spring.DEFAULT_OPTIONS,RotationalSpring.FORCE_FUNCTIONS=Spring.FORCE_FUNCTIONS,RotationalSpring.prototype.applyForce=function(targets){for(var force=this.force,options=this.options,disp=this.disp,stiffness=options.stiffness,damping=options.damping,restLength=options.length,anchor=options.anchor,i=0;i<targets.length;i++){var target=targets[i];disp.set(anchor.sub(target.orientation));var dist=disp.norm()-restLength;if(0===dist)return;var m=target.mass;stiffness*=m,damping*=m,force.set(disp.normalize(stiffness*this.forceFunction(dist,this.options.lMax))),damping&&force.set(force.add(target.angularVelocity.mult(-damping))),target.applyTorque(force)}},RotationalSpring.prototype.getEnergy=function(target){var options=this.options,restLength=options.length,anchor=options.anchor,strength=options.stiffness,dist=anchor.sub(target.orientation).norm()-restLength;return.5*strength*dist*dist},module.exports=RotationalSpring},{"./Spring":58}],58:[function(require,module){function Spring(options){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),options&&this.setOptions(options),this.disp=new Vector(0,0,0),_init.call(this),Force.call(this)}function _setForceFunction(fn){this.forceFunction=fn}function _calcStiffness(){var options=this.options;options.stiffness=Math.pow(2*pi/options.period,2)}function _calcDamping(){var options=this.options;options.damping=4*pi*options.dampingRatio/options.period}function _calcEnergy(strength,dist){return.5*strength*dist*dist}function _init(){_setForceFunction.call(this,this.options.forceFunction),_calcStiffness.call(this),_calcDamping.call(this)}var Force=require("./Force"),Vector=require("../../math/Vector");Spring.prototype=Object.create(Force.prototype),Spring.prototype.constructor=Spring;var pi=Math.PI;Spring.FORCE_FUNCTIONS={FENE:function(dist,rMax){var rMaxSmall=.99*rMax,r=Math.max(Math.min(dist,rMaxSmall),-rMaxSmall);return r/(1-r*r/(rMax*rMax))},HOOK:function(dist){return dist}},Spring.DEFAULT_OPTIONS={period:300,dampingRatio:.1,length:0,maxLength:1/0,anchor:void 0,forceFunction:Spring.FORCE_FUNCTIONS.HOOK},Spring.prototype.setOptions=function(options){void 0!==options.anchor&&(options.anchor.position instanceof Vector&&(this.options.anchor=options.anchor.position),options.anchor instanceof Vector&&(this.options.anchor=options.anchor),options.anchor instanceof Array&&(this.options.anchor=new Vector(options.anchor))),void 0!==options.period&&(this.options.period=options.period),void 0!==options.dampingRatio&&(this.options.dampingRatio=options.dampingRatio),void 0!==options.length&&(this.options.length=options.length),void 0!==options.forceFunction&&(this.options.forceFunction=options.forceFunction),void 0!==options.maxLength&&(this.options.maxLength=options.maxLength),_init.call(this)},Spring.prototype.applyForce=function(targets,source){for(var force=this.force,disp=this.disp,options=this.options,stiffness=options.stiffness,damping=options.damping,restLength=options.length,lMax=options.maxLength,anchor=options.anchor||source.position,i=0;i<targets.length;i++){var target=targets[i],p2=target.position,v2=target.velocity;anchor.sub(p2).put(disp);var dist=disp.norm()-restLength;if(0===dist)return;var m=target.mass;stiffness*=m,damping*=m,disp.normalize(stiffness*this.forceFunction(dist,lMax)).put(force),damping&&(source?force.add(v2.sub(source.velocity).mult(-damping)).put(force):force.add(v2.mult(-damping)).put(force)),target.applyForce(force),source&&source.applyForce(force.mult(-1)),this.setEnergy(_calcEnergy(stiffness,dist))}},Spring.prototype.getEnergy=function(target){var options=this.options,restLength=options.length,anchor=options.anchor,strength=options.stiffness,dist=anchor.sub(target.position).norm()-restLength;return.5*strength*dist*dist},Spring.prototype.setAnchor=function(anchor){this.options.anchor||(this.options.anchor=new Vector),this.options.anchor.set(anchor)},module.exports=Spring},{"../../math/Vector":35,"./Force":54}],59:[function(require,module){function VectorField(options){this.options=Object.create(VectorField.DEFAULT_OPTIONS),options&&this.setOptions(options),_setFieldOptions.call(this,this.options.field),Force.call(this),this.evaluation=new Vector(0,0,0)}function _setFieldOptions(field){var FIELDS=VectorField.FIELDS;switch(field){case FIELDS.CONSTANT:this.options.direction||(this.options.direction=new Vector(0,1,0));break;case FIELDS.POINT_ATTRACTOR:this.options.position||(this.options.position=new Vector(0,0,0));break;case FIELDS.SPHERE_ATTRACTOR:this.options.radius||(this.options.radius=1)}}function _evaluate(v){var evaluation=this.evaluation,field=this.options.field;return evaluation.set(v),field(evaluation,this.options)}var Force=require("./Force"),Vector=require("../../math/Vector");VectorField.prototype=Object.create(Force.prototype),VectorField.prototype.constructor=VectorField,VectorField.FIELDS={CONSTANT:function(v,options){return v.set(options.direction)},LINEAR:function(v){return v},RADIAL:function(v){return v.set(v.mult(-1,v))},SPHERE_ATTRACTOR:function(v,options){return v.set(v.mult((options.radius-v.norm())/v.norm()))},POINT_ATTRACTOR:function(v,options){return v.set(options.position.sub(v))}},VectorField.DEFAULT_OPTIONS={strength:1,field:VectorField.FIELDS.CONSTANT},VectorField.prototype.setOptions=function(options){for(var key in options)this.options[key]=options[key]},VectorField.prototype.applyForce=function(targets){for(var force=this.force,i=0;i<targets.length;i++){var particle=targets[i];force.set(_evaluate.call(this,particle.position).mult(particle.mass*this.options.strength)),particle.applyForce(force)}},module.exports=VectorField},{"../../math/Vector":35,"./Force":54}],60:[function(require,module){function SymplecticEuler(options){this.options=Object.create(SymplecticEuler.DEFAULT_OPTIONS),this._optionsManager=new OptionsManager(this.options),options&&this.setOptions(options)}var OptionsManager=require("../../core/OptionsManager");SymplecticEuler.DEFAULT_OPTIONS={velocityCap:void 0,angularVelocityCap:void 0},SymplecticEuler.prototype.setOptions=function(options){this._optionsManager.patch(options)},SymplecticEuler.prototype.getOptions=function(){return this._optionsManager.value()},SymplecticEuler.prototype.integrateVelocity=function(body,dt){var v=body.velocity,w=body.inverseMass,f=body.force;f.isZero()||(v.add(f.mult(dt*w)).put(v),f.clear())},SymplecticEuler.prototype.integratePosition=function(body,dt){var p=body.position,v=body.velocity;this.options.velocityCap&&v.cap(this.options.velocityCap).put(v),p.add(v.mult(dt)).put(p)},SymplecticEuler.prototype.integrateAngularMomentum=function(body,dt){var L=body.angularMomentum,t=body.torque;t.isZero()||(this.options.angularVelocityCap&&t.cap(this.options.angularVelocityCap).put(t),L.add(t.mult(dt)).put(L),t.clear())},SymplecticEuler.prototype.integrateOrientation=function(body,dt){var q=body.orientation,w=body.angularVelocity;w.isZero()||q.add(q.multiply(w).scalarMultiply(.5*dt)).put(q)},module.exports=SymplecticEuler},{"../../core/OptionsManager":10}],61:[function(require,module){function CanvasSurface(options){options&&options.canvasSize&&(this._canvasSize=options.canvasSize),Surface.apply(this,arguments),this._canvasSize||(this._canvasSize=this.getSize()),this._backBuffer=document.createElement("canvas"),this._canvasSize&&(this._backBuffer.width=this._canvasSize[0],this._backBuffer.height=this._canvasSize[1]),this._contextId=void 0}var Surface=require("../core/Surface");CanvasSurface.prototype=Object.create(Surface.prototype),CanvasSurface.prototype.constructor=CanvasSurface,CanvasSurface.prototype.elementType="canvas",CanvasSurface.prototype.elementClass="famous-surface",CanvasSurface.prototype.setContent=function(){},CanvasSurface.prototype.deploy=function(target){this._canvasSize&&(target.width=this._canvasSize[0],target.height=this._canvasSize[1]),"2d"===this._contextId&&(target.getContext(this._contextId).drawImage(this._backBuffer,0,0),this._backBuffer.width=0,this._backBuffer.height=0)},CanvasSurface.prototype.recall=function(target){this.getSize();this._backBuffer.width=target.width,this._backBuffer.height=target.height,"2d"===this._contextId&&(this._backBuffer.getContext(this._contextId).drawImage(target,0,0),target.width=0,target.height=0)},CanvasSurface.prototype.getContext=function(contextId){return this._contextId=contextId,this._currTarget?this._currTarget.getContext(contextId):this._backBuffer.getContext(contextId)},CanvasSurface.prototype.setSize=function(size,canvasSize){Surface.prototype.setSize.apply(this,arguments),canvasSize&&(this._canvasSize=[canvasSize[0],canvasSize[1]]),this._currTarget&&(this._currTarget.width=this._canvasSize[0],this._currTarget.height=this._canvasSize[1])},module.exports=CanvasSurface},{"../core/Surface":14}],62:[function(require,module){function ContainerSurface(options){Surface.call(this,options),this._container=document.createElement("div"),this._container.classList.add("famous-group"),this._container.classList.add("famous-container-group"),this._shouldRecalculateSize=!1,this.context=new Context(this._container),this.setContent(this._container)}var Surface=require("../core/Surface"),Context=require("../core/Context");ContainerSurface.prototype=Object.create(Surface.prototype),ContainerSurface.prototype.constructor=ContainerSurface,ContainerSurface.prototype.elementType="div",ContainerSurface.prototype.elementClass="famous-surface",ContainerSurface.prototype.add=function(){return this.context.add.apply(this.context,arguments)},ContainerSurface.prototype.render=function(){return this._sizeDirty&&(this._shouldRecalculateSize=!0),Surface.prototype.render.apply(this,arguments)},ContainerSurface.prototype.deploy=function(){return this._shouldRecalculateSize=!0,Surface.prototype.deploy.apply(this,arguments)},ContainerSurface.prototype.commit=function(){var previousSize=this._size?[this._size[0],this._size[1]]:null,result=Surface.prototype.commit.apply(this,arguments);return(this._shouldRecalculateSize||previousSize&&(this._size[0]!==previousSize[0]||this._size[1]!==previousSize[1]))&&(this.context.setSize(),this._shouldRecalculateSize=!1),this.context.update(),result},module.exports=ContainerSurface},{"../core/Context":2,"../core/Surface":14}],63:[function(require,module){function ImageSurface(){this._imageUrl=void 0,Surface.apply(this,arguments)}var Surface=require("../core/Surface");ImageSurface.prototype=Object.create(Surface.prototype),ImageSurface.prototype.constructor=ImageSurface,ImageSurface.prototype.elementType="img",ImageSurface.prototype.elementClass="famous-surface",ImageSurface.prototype.setContent=function(imageUrl){this._imageUrl=imageUrl,this._contentDirty=!0},ImageSurface.prototype.deploy=function(target){target.src=this._imageUrl||""},ImageSurface.prototype.recall=function(target){target.src=""},module.exports=ImageSurface},{"../core/Surface":14}],64:[function(require,module){function InputSurface(options){this._placeholder=options.placeholder||"",this._value=options.value||"",this._type=options.type||"text",this._name=options.name||"",Surface.apply(this,arguments),this.on("click",this.focus.bind(this))}var Surface=require("../core/Surface");InputSurface.prototype=Object.create(Surface.prototype),InputSurface.prototype.constructor=InputSurface,InputSurface.prototype.elementType="input",InputSurface.prototype.elementClass="famous-surface",InputSurface.prototype.setPlaceholder=function(str){return this._placeholder=str,this._contentDirty=!0,this},InputSurface.prototype.focus=function(){return this._currTarget&&this._currTarget.focus(),this},InputSurface.prototype.blur=function(){return this._currTarget&&this._currTarget.blur(),this},InputSurface.prototype.setValue=function(str){return this._value=str,this._contentDirty=!0,this},InputSurface.prototype.setType=function(str){return this._type=str,this._contentDirty=!0,this},InputSurface.prototype.getValue=function(){return this._currTarget?this._currTarget.value:this._value},InputSurface.prototype.setName=function(str){return this._name=str,this._contentDirty=!0,this},InputSurface.prototype.getName=function(){return this._name},InputSurface.prototype.deploy=function(target){""!==this._placeholder&&(target.placeholder=this._placeholder),target.value=this._value,target.type=this._type,target.name=this._name},module.exports=InputSurface},{"../core/Surface":14}],65:[function(require,module){function VideoSurface(options){this._videoUrl=void 0,this.options=Object.create(VideoSurface.DEFAULT_OPTIONS),options&&this.setOptions(options),Surface.apply(this,arguments)}var Surface=require("../core/Surface");VideoSurface.prototype=Object.create(Surface.prototype),VideoSurface.prototype.constructor=VideoSurface,VideoSurface.DEFAULT_OPTIONS={autoplay:!1},VideoSurface.prototype.elementType="video",VideoSurface.prototype.elementClass="famous-surface",VideoSurface.prototype.setOptions=function(options){for(var key in VideoSurface.DEFAULT_OPTIONS)void 0!==options[key]&&(this.options[key]=options[key])},VideoSurface.prototype.setContent=function(videoUrl){this._videoUrl=videoUrl,this._contentDirty=!0},VideoSurface.prototype.deploy=function(target){target.src=this._videoUrl,target.autoplay=this.options.autoplay},VideoSurface.prototype.recall=function(target){target.src=""},module.exports=VideoSurface},{"../core/Surface":14}],66:[function(require,module){function CachedMap(mappingFunction){this._map=mappingFunction||null,this._cachedOutput=null,this._cachedInput=Number.NaN}CachedMap.create=function(mappingFunction){var instance=new CachedMap(mappingFunction);return instance.get.bind(instance)},CachedMap.prototype.get=function(input){return input!==this._cachedInput&&(this._cachedInput=input,this._cachedOutput=this._map(input)),this._cachedOutput},module.exports=CachedMap},{}],67:[function(require,module){var Easing={inQuad:function(t){return t*t},outQuad:function(t){return-(t-=1)*t+1},inOutQuad:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},inCubic:function(t){return t*t*t},outCubic:function(t){return--t*t*t+1},inOutCubic:function(t){return(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},inQuart:function(t){return t*t*t*t},outQuart:function(t){return-(--t*t*t*t-1)},inOutQuart:function(t){return(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},inQuint:function(t){return t*t*t*t*t},outQuint:function(t){return--t*t*t*t*t+1},inOutQuint:function(t){return(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},inSine:function(t){return-1*Math.cos(t*(Math.PI/2))+1},outSine:function(t){return Math.sin(t*(Math.PI/2))},inOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},inExpo:function(t){return 0===t?0:Math.pow(2,10*(t-1))},outExpo:function(t){return 1===t?1:-Math.pow(2,-10*t)+1},inOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*--t)+2)},inCirc:function(t){return-(Math.sqrt(1-t*t)-1)},outCirc:function(t){return Math.sqrt(1- --t*t)},inOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},inElastic:function(t){var s=1.70158,p=0,a=1;return 0===t?0:1===t?1:(p||(p=.3),s=p/(2*Math.PI)*Math.asin(1/a),-(a*Math.pow(2,10*(t-=1))*Math.sin(2*(t-s)*Math.PI/p)))},outElastic:function(t){var s=1.70158,p=0,a=1;return 0===t?0:1===t?1:(p||(p=.3),s=p/(2*Math.PI)*Math.asin(1/a),a*Math.pow(2,-10*t)*Math.sin(2*(t-s)*Math.PI/p)+1)},inOutElastic:function(t){var s=1.70158,p=0,a=1;return 0===t?0:2===(t/=.5)?1:(p||(p=.3*1.5),s=p/(2*Math.PI)*Math.asin(1/a),1>t?-.5*a*Math.pow(2,10*(t-=1))*Math.sin(2*(t-s)*Math.PI/p):a*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-s)*Math.PI/p)*.5+1)},inBack:function(t,s){return void 0===s&&(s=1.70158),t*t*((s+1)*t-s)},outBack:function(t,s){return void 0===s&&(s=1.70158),--t*t*((s+1)*t+s)+1},inOutBack:function(t,s){return void 0===s&&(s=1.70158),(t/=.5)<1?.5*t*t*(((s*=1.525)+1)*t-s):.5*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)},inBounce:function(t){return 1-Easing.outBounce(1-t)},outBounce:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},inOutBounce:function(t){return.5>t?.5*Easing.inBounce(2*t):.5*Easing.outBounce(2*t-1)+.5}};module.exports=Easing},{}],68:[function(require,module){function MultipleTransition(method){this.method=method,this._instances=[],this.state=[]}var Utility=require("../utilities/Utility");MultipleTransition.SUPPORTS_MULTIPLE=!0,MultipleTransition.prototype.get=function(){for(var i=0;i<this._instances.length;i++)this.state[i]=this._instances[i].get();return this.state},MultipleTransition.prototype.set=function(endState,transition,callback){for(var _allCallback=Utility.after(endState.length,callback),i=0;i<endState.length;i++)this._instances[i]||(this._instances[i]=new this.method),this._instances[i].set(endState[i],transition,_allCallback)},MultipleTransition.prototype.reset=function(startState){for(var i=0;i<startState.length;i++)this._instances[i]||(this._instances[i]=new this.method),this._instances[i].reset(startState[i])},module.exports=MultipleTransition},{"../utilities/Utility":77}],69:[function(require,module){function SnapTransition(state){state=state||0,this.endState=new Vector(state),this.initState=new Vector,this._dimensions=1,this._restTolerance=1e-10,this._absRestTolerance=this._restTolerance,this._callback=void 0,this.PE=new PE,this.particle=new Particle,this.spring=new Spring({anchor:this.endState}),this.PE.addBody(this.particle),this.PE.attach(this.spring,this.particle)}function _getEnergy(){return this.particle.getEnergy()+this.spring.getEnergy(this.particle)}function _setAbsoluteRestTolerance(){var distance=this.endState.sub(this.initState).normSquared();this._absRestTolerance=0===distance?this._restTolerance:this._restTolerance*distance}function _setTarget(target){this.endState.set(target),_setAbsoluteRestTolerance.call(this)}function _wake(){this.PE.wake()}function _sleep(){this.PE.sleep()}function _setParticlePosition(p){this.particle.position.set(p)}function _setParticleVelocity(v){this.particle.velocity.set(v)}function _getParticlePosition(){return 0===this._dimensions?this.particle.getPosition1D():this.particle.getPosition()}function _getParticleVelocity(){return 0===this._dimensions?this.particle.getVelocity1D():this.particle.getVelocity()}function _setCallback(callback){this._callback=callback}function _setupDefinition(definition){var defaults=SnapTransition.DEFAULT_OPTIONS;void 0===definition.period&&(definition.period=defaults.period),void 0===definition.dampingRatio&&(definition.dampingRatio=defaults.dampingRatio),void 0===definition.velocity&&(definition.velocity=defaults.velocity),this.spring.setOptions({period:definition.period,dampingRatio:definition.dampingRatio}),_setParticleVelocity.call(this,definition.velocity)}function _update(){if(this.PE.isSleeping()){if(this._callback){var cb=this._callback;this._callback=void 0,cb()}}else _getEnergy.call(this)<this._absRestTolerance&&(_setParticlePosition.call(this,this.endState),_setParticleVelocity.call(this,[0,0,0]),_sleep.call(this))}var PE=require("../physics/PhysicsEngine"),Particle=require("../physics/bodies/Particle"),Spring=require("../physics/constraints/Snap"),Vector=require("../math/Vector");SnapTransition.SUPPORTS_MULTIPLE=3,SnapTransition.DEFAULT_OPTIONS={period:100,dampingRatio:.2,velocity:0},SnapTransition.prototype.reset=function(state,velocity){this._dimensions=state instanceof Array?state.length:0,this.initState.set(state),_setParticlePosition.call(this,state),_setTarget.call(this,state),velocity&&_setParticleVelocity.call(this,velocity),_setCallback.call(this,void 0)},SnapTransition.prototype.getVelocity=function(){return _getParticleVelocity.call(this)},SnapTransition.prototype.setVelocity=function(velocity){this.call(this,_setParticleVelocity(velocity))},SnapTransition.prototype.isActive=function(){return!this.PE.isSleeping()},SnapTransition.prototype.halt=function(){this.set(this.get())},SnapTransition.prototype.get=function(){return _update.call(this),_getParticlePosition.call(this)},SnapTransition.prototype.set=function(state,definition,callback){return definition?(this._dimensions=state instanceof Array?state.length:0,_wake.call(this),_setupDefinition.call(this,definition),_setTarget.call(this,state),void _setCallback.call(this,callback)):(this.reset(state),void(callback&&callback()))},module.exports=SnapTransition},{"../math/Vector":35,"../physics/PhysicsEngine":40,"../physics/bodies/Particle":43,"../physics/constraints/Snap":49}],70:[function(require,module){function SpringTransition(state){state=state||0,this.endState=new Vector(state),this.initState=new Vector,this._dimensions=void 0,this._restTolerance=1e-10,this._absRestTolerance=this._restTolerance,this._callback=void 0,this.PE=new PE,this.spring=new Spring({anchor:this.endState}),this.particle=new Particle,this.PE.addBody(this.particle),this.PE.attach(this.spring,this.particle)}function _getEnergy(){return this.particle.getEnergy()+this.spring.getEnergy(this.particle)}function _setParticlePosition(p){this.particle.setPosition(p)}function _setParticleVelocity(v){this.particle.setVelocity(v)}function _getParticlePosition(){return 0===this._dimensions?this.particle.getPosition1D():this.particle.getPosition()}function _getParticleVelocity(){return 0===this._dimensions?this.particle.getVelocity1D():this.particle.getVelocity()}function _setCallback(callback){this._callback=callback}function _wake(){this.PE.wake()}function _sleep(){this.PE.sleep()}function _update(){if(this.PE.isSleeping()){if(this._callback){var cb=this._callback;this._callback=void 0,cb()}}else _getEnergy.call(this)<this._absRestTolerance&&(_setParticlePosition.call(this,this.endState),_setParticleVelocity.call(this,[0,0,0]),_sleep.call(this))}function _setupDefinition(definition){var defaults=SpringTransition.DEFAULT_OPTIONS;void 0===definition.period&&(definition.period=defaults.period),void 0===definition.dampingRatio&&(definition.dampingRatio=defaults.dampingRatio),void 0===definition.velocity&&(definition.velocity=defaults.velocity),definition.period<150&&(definition.period=150,console.warn("The period of a SpringTransition is capped at 150 ms. Use a SnapTransition for faster transitions")),this.spring.setOptions({period:definition.period,dampingRatio:definition.dampingRatio}),_setParticleVelocity.call(this,definition.velocity)}function _setAbsoluteRestTolerance(){var distance=this.endState.sub(this.initState).normSquared();this._absRestTolerance=0===distance?this._restTolerance:this._restTolerance*distance}function _setTarget(target){this.endState.set(target),_setAbsoluteRestTolerance.call(this)}var PE=require("../physics/PhysicsEngine"),Particle=require("../physics/bodies/Particle"),Spring=require("../physics/forces/Spring"),Vector=require("../math/Vector");SpringTransition.SUPPORTS_MULTIPLE=3,SpringTransition.DEFAULT_OPTIONS={period:300,dampingRatio:.5,velocity:0},SpringTransition.prototype.reset=function(pos,vel){this._dimensions=pos instanceof Array?pos.length:0,this.initState.set(pos),_setParticlePosition.call(this,pos),_setTarget.call(this,pos),vel&&_setParticleVelocity.call(this,vel),_setCallback.call(this,void 0)},SpringTransition.prototype.getVelocity=function(){return _getParticleVelocity.call(this)},SpringTransition.prototype.setVelocity=function(v){this.call(this,_setParticleVelocity(v))},SpringTransition.prototype.isActive=function(){return!this.PE.isSleeping()},SpringTransition.prototype.halt=function(){this.set(this.get())},SpringTransition.prototype.get=function(){return _update.call(this),_getParticlePosition.call(this)},SpringTransition.prototype.set=function(endState,definition,callback){return definition?(this._dimensions=endState instanceof Array?endState.length:0,_wake.call(this),_setupDefinition.call(this,definition),_setTarget.call(this,endState),void _setCallback.call(this,callback)):(this.reset(endState),void(callback&&callback()))},module.exports=SpringTransition},{"../math/Vector":35,"../physics/PhysicsEngine":40,"../physics/bodies/Particle":43,"../physics/forces/Spring":58}],71:[function(require,module){function Transitionable(start){this.currentAction=null,this.actionQueue=[],this.callbackQueue=[],this.state=0,this.velocity=void 0,this._callback=void 0,this._engineInstance=null,this._currentMethod=null,this.set(start)}function _loadNext(){if(this._callback){var callback=this._callback;this._callback=void 0,callback()}if(this.actionQueue.length<=0)return void this.set(this.get());this.currentAction=this.actionQueue.shift(),this._callback=this.callbackQueue.shift();var method=null,endValue=this.currentAction[0],transition=this.currentAction[1];transition instanceof Object&&transition.method?(method=transition.method,"string"==typeof method&&(method=transitionMethods[method])):method=TweenTransition,this._currentMethod!==method&&(this._engineInstance=!(endValue instanceof Object)||method.SUPPORTS_MULTIPLE===!0||endValue.length<=method.SUPPORTS_MULTIPLE?new method:new MultipleTransition(method),this._currentMethod=method),this._engineInstance.reset(this.state,this.velocity),void 0!==this.velocity&&(transition.velocity=this.velocity),this._engineInstance.set(endValue,transition,_loadNext.bind(this))}var MultipleTransition=require("./MultipleTransition"),TweenTransition=require("./TweenTransition"),transitionMethods={};Transitionable.registerMethod=function(name,engineClass){return name in transitionMethods?!1:(transitionMethods[name]=engineClass,!0)},Transitionable.unregisterMethod=function(name){return name in transitionMethods?(delete transitionMethods[name],!0):!1},Transitionable.prototype.set=function(endState,transition,callback){if(!transition)return this.reset(endState),callback&&callback(),this;var action=[endState,transition];return this.actionQueue.push(action),this.callbackQueue.push(callback),this.currentAction||_loadNext.call(this),this},Transitionable.prototype.reset=function(startState,startVelocity){this._currentMethod=null,this._engineInstance=null,this.state=startState,this.velocity=startVelocity,this.currentAction=null,this.actionQueue=[],this.callbackQueue=[]},Transitionable.prototype.delay=function(duration,callback){this.set(this._engineInstance.get(),{duration:duration,curve:function(){return 0
}},callback)},Transitionable.prototype.get=function(timestamp){return this._engineInstance&&(this._engineInstance.getVelocity&&(this.velocity=this._engineInstance.getVelocity()),this.state=this._engineInstance.get(timestamp)),this.state},Transitionable.prototype.isActive=function(){return!!this.currentAction},Transitionable.prototype.halt=function(){this.set(this.get())},module.exports=Transitionable},{"./MultipleTransition":68,"./TweenTransition":73}],72:[function(require,module){function TransitionableTransform(transform){this._final=Transform.identity.slice(),this.translate=new Transitionable([0,0,0]),this.rotate=new Transitionable([0,0,0]),this.skew=new Transitionable([0,0,0]),this.scale=new Transitionable([1,1,1]),transform&&this.set(transform)}function _build(){return Transform.build({translate:this.translate.get(),rotate:this.rotate.get(),skew:this.skew.get(),scale:this.scale.get()})}var Transitionable=require("./Transitionable"),Transform=require("../core/Transform"),Utility=require("../utilities/Utility");TransitionableTransform.prototype.setTranslate=function(translate,transition,callback){return this.translate.set(translate,transition,callback),this._final=this._final.slice(),this._final[12]=translate[0],this._final[13]=translate[1],void 0!==translate[2]&&(this._final[14]=translate[2]),this},TransitionableTransform.prototype.setScale=function(scale,transition,callback){return this.scale.set(scale,transition,callback),this._final=this._final.slice(),this._final[0]=scale[0],this._final[5]=scale[1],void 0!==scale[2]&&(this._final[10]=scale[2]),this},TransitionableTransform.prototype.setRotate=function(eulerAngles,transition,callback){return this.rotate.set(eulerAngles,transition,callback),this._final=_build.call(this),this._final=Transform.build({translate:this.translate.get(),rotate:eulerAngles,scale:this.scale.get(),skew:this.skew.get()}),this},TransitionableTransform.prototype.setSkew=function(skewAngles,transition,callback){return this.skew.set(skewAngles,transition,callback),this._final=Transform.build({translate:this.translate.get(),rotate:this.rotate.get(),scale:this.scale.get(),skew:skewAngles}),this},TransitionableTransform.prototype.set=function(transform,transition,callback){this._final=transform;var components=Transform.interpret(transform),_callback=callback?Utility.after(4,callback):null;return this.translate.set(components.translate,transition,_callback),this.rotate.set(components.rotate,transition,_callback),this.skew.set(components.skew,transition,_callback),this.scale.set(components.scale,transition,_callback),this},TransitionableTransform.prototype.setDefaultTransition=function(transition){this.translate.setDefault(transition),this.rotate.setDefault(transition),this.skew.setDefault(transition),this.scale.setDefault(transition)},TransitionableTransform.prototype.get=function(){return this.isActive()?_build.call(this):this._final},TransitionableTransform.prototype.getFinal=function(){return this._final},TransitionableTransform.prototype.isActive=function(){return this.translate.isActive()||this.rotate.isActive()||this.scale.isActive()||this.skew.isActive()},TransitionableTransform.prototype.halt=function(){this._final=this.get(),this.translate.halt(),this.rotate.halt(),this.skew.halt(),this.scale.halt()},module.exports=TransitionableTransform},{"../core/Transform":15,"../utilities/Utility":77,"./Transitionable":71}],73:[function(require,module){function TweenTransition(options){this.options=Object.create(TweenTransition.DEFAULT_OPTIONS),options&&this.setOptions(options),this._startTime=0,this._startValue=0,this._updateTime=0,this._endValue=0,this._curve=void 0,this._duration=0,this._active=!1,this._callback=void 0,this.state=0,this.velocity=void 0}function _interpolate(a,b,t){return(1-t)*a+t*b}function _clone(obj){return obj instanceof Object?obj instanceof Array?obj.slice(0):Object.create(obj):obj}function _normalize(transition,defaultTransition){var result={curve:defaultTransition.curve};return defaultTransition.duration&&(result.duration=defaultTransition.duration),defaultTransition.speed&&(result.speed=defaultTransition.speed),transition instanceof Object&&(void 0!==transition.duration&&(result.duration=transition.duration),transition.curve&&(result.curve=transition.curve),transition.speed&&(result.speed=transition.speed)),"string"==typeof result.curve&&(result.curve=TweenTransition.getCurve(result.curve)),result}function _calculateVelocity(current,start,curve,duration,t){var velocity,eps=1e-7,speed=(curve(t)-curve(t-eps))/eps;if(current instanceof Array){velocity=[];for(var i=0;i<current.length;i++)velocity[i]=speed*(current[i]-start[i])/duration}else velocity=speed*(current-start)/duration;return velocity}function _calculateState(start,end,t){var state;if(start instanceof Array){state=[];for(var i=0;i<start.length;i++)state[i]=_interpolate(start[i],end[i],t)}else state=_interpolate(start,end,t);return state}TweenTransition.Curves={linear:function(t){return t},easeIn:function(t){return t*t},easeOut:function(t){return t*(2-t)},easeInOut:function(t){return.5>=t?2*t*t:-2*t*t+4*t-1},easeOutBounce:function(t){return t*(3-2*t)},spring:function(t){return(1-t)*Math.sin(6*Math.PI*t)+t}},TweenTransition.SUPPORTS_MULTIPLE=!0,TweenTransition.DEFAULT_OPTIONS={curve:TweenTransition.Curves.linear,duration:500,speed:0};var registeredCurves={};TweenTransition.registerCurve=function(curveName,curve){return registeredCurves[curveName]?!1:(registeredCurves[curveName]=curve,!0)},TweenTransition.unregisterCurve=function(curveName){return registeredCurves[curveName]?(delete registeredCurves[curveName],!0):!1},TweenTransition.getCurve=function(curveName){return registeredCurves[curveName]},TweenTransition.getCurves=function(){return registeredCurves},TweenTransition.prototype.setOptions=function(options){void 0!==options.curve&&(this.options.curve=options.curve),void 0!==options.duration&&(this.options.duration=options.duration),void 0!==options.speed&&(this.options.speed=options.speed)},TweenTransition.prototype.set=function(endValue,transition,callback){if(!transition)return this.reset(endValue),void(callback&&callback());if(this._startValue=_clone(this.get()),transition=_normalize(transition,this.options),transition.speed){var startValue=this._startValue;if(startValue instanceof Object){var variance=0;for(var i in startValue)variance+=(endValue[i]-startValue[i])*(endValue[i]-startValue[i]);transition.duration=Math.sqrt(variance)/transition.speed}else transition.duration=Math.abs(endValue-startValue)/transition.speed}this._startTime=Date.now(),this._endValue=_clone(endValue),this._startVelocity=_clone(transition.velocity),this._duration=transition.duration,this._curve=transition.curve,this._active=!0,this._callback=callback},TweenTransition.prototype.reset=function(startValue,startVelocity){if(this._callback){var callback=this._callback;this._callback=void 0,callback()}this.state=_clone(startValue),this.velocity=_clone(startVelocity),this._startTime=0,this._duration=0,this._updateTime=0,this._startValue=this.state,this._startVelocity=this.velocity,this._endValue=this.state,this._active=!1},TweenTransition.prototype.getVelocity=function(){return this.velocity},TweenTransition.prototype.get=function(timestamp){return this.update(timestamp),this.state},TweenTransition.prototype.update=function(timestamp){if(this._active){if(timestamp||(timestamp=Date.now()),!(this._updateTime>=timestamp)){this._updateTime=timestamp;var timeSinceStart=timestamp-this._startTime;if(timeSinceStart>=this._duration)this.state=this._endValue,this.velocity=_calculateVelocity(this.state,this._startValue,this._curve,this._duration,1),this._active=!1;else if(0>timeSinceStart)this.state=this._startValue,this.velocity=this._startVelocity;else{var t=timeSinceStart/this._duration;this.state=_calculateState(this._startValue,this._endValue,this._curve(t)),this.velocity=_calculateVelocity(this.state,this._startValue,this._curve,this._duration,t)}}}else if(this._callback){var callback=this._callback;this._callback=void 0,callback()}},TweenTransition.prototype.isActive=function(){return this._active},TweenTransition.prototype.halt=function(){this.reset(this.get())},TweenTransition.registerCurve("linear",TweenTransition.Curves.linear),TweenTransition.registerCurve("easeIn",TweenTransition.Curves.easeIn),TweenTransition.registerCurve("easeOut",TweenTransition.Curves.easeOut),TweenTransition.registerCurve("easeInOut",TweenTransition.Curves.easeInOut),TweenTransition.registerCurve("easeOutBounce",TweenTransition.Curves.easeOutBounce),TweenTransition.registerCurve("spring",TweenTransition.Curves.spring),TweenTransition.customCurve=function(v1,v2){return v1=v1||0,v2=v2||0,function(t){return v1*t+(-2*v1-v2+3)*t*t+(v1+v2-2)*t*t*t}},module.exports=TweenTransition},{}],74:[function(require,module){function WallTransition(state){state=state||0,this.endState=new Vector(state),this.initState=new Vector,this.spring=new Spring({anchor:this.endState}),this.wall=new Wall,this._restTolerance=1e-10,this._dimensions=1,this._absRestTolerance=this._restTolerance,this._callback=void 0,this.PE=new PE,this.particle=new Particle,this.PE.addBody(this.particle),this.PE.attach([this.wall,this.spring],this.particle)}function _getEnergy(){return this.particle.getEnergy()+this.spring.getEnergy(this.particle)}function _setAbsoluteRestTolerance(){var distance=this.endState.sub(this.initState).normSquared();this._absRestTolerance=0===distance?this._restTolerance:this._restTolerance*distance}function _wake(){this.PE.wake()}function _sleep(){this.PE.sleep()}function _setTarget(target){this.endState.set(target);var dist=this.endState.sub(this.initState).norm();this.wall.setOptions({distance:this.endState.norm(),normal:0===dist?this.particle.velocity.normalize(-1):this.endState.sub(this.initState).normalize(-1)}),_setAbsoluteRestTolerance.call(this)}function _setParticlePosition(p){this.particle.position.set(p)}function _setParticleVelocity(v){this.particle.velocity.set(v)}function _getParticlePosition(){return 0===this._dimensions?this.particle.getPosition1D():this.particle.getPosition()}function _getParticleVelocity(){return 0===this._dimensions?this.particle.getVelocity1D():this.particle.getVelocity()}function _setCallback(callback){this._callback=callback}function _update(){if(this.PE.isSleeping()){if(this._callback){var cb=this._callback;this._callback=void 0,cb()}}else{var energy=_getEnergy.call(this);energy<this._absRestTolerance&&(_sleep.call(this),_setParticlePosition.call(this,this.endState),_setParticleVelocity.call(this,[0,0,0]))}}function _setupDefinition(def){var defaults=WallTransition.DEFAULT_OPTIONS;void 0===def.period&&(def.period=defaults.period),void 0===def.dampingRatio&&(def.dampingRatio=defaults.dampingRatio),void 0===def.velocity&&(def.velocity=defaults.velocity),void 0===def.restitution&&(def.restitution=defaults.restitution),this.spring.setOptions({period:def.period,dampingRatio:def.dampingRatio}),this.wall.setOptions({restitution:def.restitution}),_setParticleVelocity.call(this,def.velocity)}var PE=require("../physics/PhysicsEngine"),Particle=require("../physics/bodies/Particle"),Spring=require("../physics/forces/Spring"),Wall=require("../physics/constraints/Wall"),Vector=require("../math/Vector");WallTransition.SUPPORTS_MULTIPLE=3,WallTransition.DEFAULT_OPTIONS={period:300,dampingRatio:.5,velocity:0,resitution:.5},WallTransition.prototype.reset=function(state,velocity){this._dimensions=state instanceof Array?state.length:0,this.initState.set(state),_setParticlePosition.call(this,state),velocity&&_setParticleVelocity.call(this,velocity),_setTarget.call(this,state),_setCallback.call(this,void 0)},WallTransition.prototype.getVelocity=function(){return _getParticleVelocity.call(this)},WallTransition.prototype.setVelocity=function(velocity){this.call(this,_setParticleVelocity(velocity))},WallTransition.prototype.isActive=function(){return!this.PE.isSleeping()},WallTransition.prototype.halt=function(){this.set(this.get())},WallTransition.prototype.get=function(){return _update.call(this),_getParticlePosition.call(this)},WallTransition.prototype.set=function(state,definition,callback){return definition?(this._dimensions=state instanceof Array?state.length:0,_wake.call(this),_setupDefinition.call(this,definition),_setTarget.call(this,state),void _setCallback.call(this,callback)):(this.reset(state),void(callback&&callback()))},module.exports=WallTransition},{"../math/Vector":35,"../physics/PhysicsEngine":40,"../physics/bodies/Particle":43,"../physics/constraints/Wall":51,"../physics/forces/Spring":58}],75:[function(require,module){var KeyCodes={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ENTER:13,LEFT_ARROW:37,RIGHT_ARROW:39,UP_ARROW:38,DOWN_ARROW:40,SPACE:32,SHIFT:16,TAB:9};module.exports=KeyCodes},{}],76:[function(require,module){function addTimerFunction(fn){return FamousEngine.on(_event,fn),fn}function setTimeout(fn,duration){var t=getTime(),callback=function(){var t2=getTime();t2-t>=duration&&(fn.apply(this,arguments),FamousEngine.removeListener(_event,callback))};return addTimerFunction(callback)}function setInterval(fn,duration){var t=getTime(),callback=function(){var t2=getTime();t2-t>=duration&&(fn.apply(this,arguments),t=getTime())};return addTimerFunction(callback)}function after(fn,numTicks){if(void 0===numTicks)return void 0;var callback=function(){numTicks--,0>=numTicks&&(fn.apply(this,arguments),clear(callback))};return addTimerFunction(callback)}function every(fn,numTicks){numTicks=numTicks||1;var initial=numTicks,callback=function(){numTicks--,0>=numTicks&&(fn.apply(this,arguments),numTicks=initial)};return addTimerFunction(callback)}function clear(fn){FamousEngine.removeListener(_event,fn)}function debounce(func,wait){var timeout,ctx,timestamp,result,args;return function(){ctx=this,args=arguments,timestamp=getTime();var fn=function(){var last=getTime-timestamp;wait>last?timeout=setTimeout(fn,wait-last):(timeout=null,result=func.apply(ctx,args))};return timeout||(timeout=setTimeout(fn,wait)),result}}var FamousEngine=require("../core/Engine"),_event="prerender",getTime=window.performance?function(){return window.performance.now()}:function(){return Date.now()};module.exports={setTimeout:setTimeout,setInterval:setInterval,debounce:debounce,after:after,every:every,clear:clear}},{"../core/Engine":4}],77:[function(require,module){var Utility={};Utility.Direction={X:0,Y:1,Z:2},Utility.after=function(count,callback){var counter=count;return function(){counter--,0===counter&&callback.apply(this,arguments)}},Utility.loadURL=function(url,callback){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){4===this.readyState&&callback&&callback(this.responseText)},xhr.open("GET",url),xhr.send()},Utility.createDocumentFragmentFromHTML=function(html){var element=document.createElement("div");element.innerHTML=html;for(var result=document.createDocumentFragment();element.hasChildNodes();)result.appendChild(element.firstChild);return result},module.exports=Utility},{}],78:[function(require,module){function Deck(){SequentialLayout.apply(this,arguments),this.state=new Transitionable(0),this._isOpen=!1,this.setOutputFunction(function(input,offset,index){var state=_getState.call(this),positionMatrix=this.options.direction===Utility.Direction.X?Transform.translate(state*offset,0,.001*(state-1)*offset):Transform.translate(0,state*offset,.001*(state-1)*offset),output=input.render();if(this.options.stackRotation){var amount=this.options.stackRotation*index*(1-state);output={transform:Transform.rotateZ(amount),origin:[.5,.5],target:output}}return{transform:positionMatrix,size:input.getSize(),target:output}})}function _getState(returnFinal){return returnFinal?this._isOpen?1:0:this.state.get()}function _setState(pos,transition,callback){this.state.halt(),this.state.set(pos,transition,callback)}var Transform=require("../core/Transform"),OptionsManager=require("../core/OptionsManager"),Transitionable=require("../transitions/Transitionable"),Utility=require("../utilities/Utility"),SequentialLayout=require("./SequentialLayout");Deck.prototype=Object.create(SequentialLayout.prototype),Deck.prototype.constructor=Deck,Deck.DEFAULT_OPTIONS=OptionsManager.patch(SequentialLayout.DEFAULT_OPTIONS,{transition:{curve:"easeOutBounce",duration:500},stackRotation:0}),Deck.prototype.getSize=function(){var originalSize=SequentialLayout.prototype.getSize.apply(this,arguments),firstSize=this._items?this._items.get().getSize():[0,0];firstSize||(firstSize=[0,0]);var state=_getState.call(this),invState=1-state;return[firstSize[0]*invState+originalSize[0]*state,firstSize[1]*invState+originalSize[1]*state]},Deck.prototype.isOpen=function(){return this._isOpen},Deck.prototype.open=function(callback){this._isOpen=!0,_setState.call(this,1,this.options.transition,callback)},Deck.prototype.close=function(callback){this._isOpen=!1,_setState.call(this,0,this.options.transition,callback)},Deck.prototype.toggle=function(callback){this._isOpen?this.close(callback):this.open(callback)},module.exports=Deck},{"../core/OptionsManager":10,"../core/Transform":15,"../transitions/Transitionable":71,"../utilities/Utility":77,"./SequentialLayout":89}],79:[function(require,module){function EdgeSwapper(options){this._currentTarget=null,this._size=[void 0,void 0],this._controller=new RenderController(options),this._controller.inTransformFrom(CachedMap.create(_transformMap.bind(this,1e-4))),this._controller.outTransformFrom(CachedMap.create(_transformMap.bind(this,-1e-4))),this._eventInput=new EventHandler,EventHandler.setInputHandler(this,this._eventInput),this._entityId=Entity.register(this),options&&this.setOptions(options)}function _transformMap(zMax,progress){return Transform.translate(this._size[0]*(1-progress),0,zMax*(1-progress))}var CachedMap=require("../transitions/CachedMap"),Entity=require("../core/Entity"),EventHandler=require("../core/EventHandler"),Transform=require("../core/Transform"),RenderController=require("./RenderController");EdgeSwapper.prototype.show=function(content){this._currentTarget&&this._eventInput.unpipe(this._currentTarget),this._currentTarget=content,this._currentTarget&&this._currentTarget.trigger&&this._eventInput.pipe(this._currentTarget),this._controller.show.apply(this._controller,arguments)},EdgeSwapper.prototype.setOptions=function(options){this._controller.setOptions(options)},EdgeSwapper.prototype.render=function(){return this._entityId},EdgeSwapper.prototype.commit=function(context){return this._size[0]=context.size[0],this._size[1]=context.size[1],{transform:context.transform,opacity:context.opacity,origin:context.origin,size:context.size,target:this._controller.render()}},module.exports=EdgeSwapper},{"../core/Entity":5,"../core/EventHandler":7,"../core/Transform":15,"../transitions/CachedMap":66,"./RenderController":84}],80:[function(require,module){function Flipper(options){this.options=Object.create(Flipper.DEFAULT_OPTIONS),this._optionsManager=new OptionsManager(this.options),options&&this.setOptions(options),this._side=0,this.state=new Transitionable(0),this.frontNode=new RenderNode,this.backNode=new RenderNode}var Transform=require("../core/Transform"),Transitionable=require("../transitions/Transitionable"),RenderNode=require("../core/RenderNode"),OptionsManager=require("../core/OptionsManager"),Utility=require("../utilities/Utility");Flipper.DEFAULT_OPTIONS={transition:!0,cull:!0,direction:Utility.Direction.Y},Flipper.prototype.flip=function(side,callback){void 0===side&&(side=1===this._side?0:1),this._side=side,this.state.set(side,this.options.transition,callback)},Flipper.prototype.setOptions=function(options){return this._optionsManager.setOptions(options)},Flipper.prototype.setFront=function(obj){return this.frontNode.set(obj)},Flipper.prototype.setBack=function(obj){return this.backNode.set(obj)},Flipper.prototype.render=function(){var pos=this.state.get(),axis=this.options.direction,frontRotation=[0,0,0],backRotation=[0,0,0];return frontRotation[axis]=Math.PI*pos,backRotation[axis]=Math.PI*(pos+1),this.options.cull&&!this.state.isActive()?pos?this.backNode.render():this.frontNode.render():[{transform:Transform.rotate.apply(null,frontRotation),target:this.frontNode.render()},{transform:Transform.rotate.apply(null,backRotation),target:this.backNode.render()}]},module.exports=Flipper},{"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15,"../transitions/Transitionable":71,"../utilities/Utility":77}],81:[function(require,module){function GridLayout(options){this.options=Object.create(GridLayout.DEFAULT_OPTIONS),this.optionsManager=new OptionsManager(this.options),options&&this.setOptions(options),this.id=Entity.register(this),this._modifiers=[],this._states=[],this._contextSizeCache=[0,0],this._dimensionsCache=[0,0],this._activeCount=0}function _reflow(size,cols,rows){rows||(rows=size[1]/this.options.cellSize[1]|0),cols||(cols=size[0]/this.options.cellSize[0]|0);for(var rowSize=size[1]/rows,colSize=size[0]/cols,i=0;rows>i;i++)for(var currY=Math.round(rowSize*i),j=0;cols>j;j++){var currX=Math.round(colSize*j),currIndex=i*cols+j;currIndex in this._modifiers||_createModifier.call(this,currIndex),_animateModifier.call(this,currIndex,[Math.round(colSize*(j+1))-currX,Math.round(rowSize*(i+1))-currY],[currX,currY,0],1)}for(this._dimensionsCache=[this.options.dimensions[0],this.options.dimensions[1]],this._contextSizeCache=[size[0],size[1]],this._activeCount=rows*cols,i=this._activeCount;i<this._modifiers.length;i++)_animateModifier.call(this,i,[Math.round(colSize),Math.round(rowSize)],[0,0],0)}function _createModifier(index){var transitionItem={transform:new TransitionableTransform(Transform.identity),opacity:new Transitionable(0),size:new Transitionable([0,0])},modifier=new Modifier({transform:transitionItem.transform,opacity:transitionItem.opacity,size:transitionItem.size});this._states[index]=transitionItem,this._modifiers[index]=modifier}function _animateModifier(index,size,position,opacity){var currState=this._states[index],currSize=currState.size,currOpacity=currState.opacity,currTransform=currState.transform,transition=this.options.transition;currTransform.halt(),currOpacity.halt(),currSize.halt(),currTransform.setTranslate(position,transition),currSize.set(size,transition),currOpacity.set(opacity,transition)}var Entity=require("../core/Entity"),Transform=(require("../core/RenderNode"),require("../core/Transform")),ViewSequence=require("../core/ViewSequence"),Modifier=require("../core/Modifier"),OptionsManager=require("../core/OptionsManager"),Transitionable=require("../transitions/Transitionable"),TransitionableTransform=require("../transitions/TransitionableTransform");GridLayout.DEFAULT_OPTIONS={dimensions:[1,1],cellSize:[250,250],transition:!1},GridLayout.prototype.render=function(){return this.id},GridLayout.prototype.setOptions=function(options){return this.optionsManager.setOptions(options)},GridLayout.prototype.sequenceFrom=function(sequence){sequence instanceof Array&&(sequence=new ViewSequence(sequence)),this.sequence=sequence},GridLayout.prototype.commit=function(context){var transform=context.transform,opacity=context.opacity,origin=context.origin,size=context.size,cols=this.options.dimensions[0],rows=this.options.dimensions[1];(size[0]!==this._contextSizeCache[0]||size[1]!==this._contextSizeCache[1]||cols!==this._dimensionsCache[0]||rows!==this._dimensionsCache[1])&&_reflow.call(this,size,cols,rows);for(var sequence=this.sequence,result=[],currIndex=0;sequence&&currIndex<this._modifiers.length;){var item=sequence.get(),modifier=this._modifiers[currIndex];currIndex>=this._activeCount&&this._states[currIndex].opacity.isActive()&&(this._modifiers.splice(currIndex,1),this._states.splice(currIndex,1)),item&&(result[currIndex]=modifier.modify({origin:origin,target:item.render()})),sequence=sequence.getNext(),currIndex++}size&&(transform=Transform.moveThen([-size[0]*origin[0],-size[1]*origin[1],0],transform));var nextSpec={transform:transform,opacity:opacity,size:size,target:result};return nextSpec},module.exports=GridLayout},{"../core/Entity":5,"../core/Modifier":9,"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15,"../core/ViewSequence":17,"../transitions/Transitionable":71,"../transitions/TransitionableTransform":72}],82:[function(require,module){function HeaderFooterLayout(options){this.options=Object.create(HeaderFooterLayout.DEFAULT_OPTIONS),this._optionsManager=new OptionsManager(this.options),options&&this.setOptions(options),this._entityId=Entity.register(this),this.header=new RenderNode,this.footer=new RenderNode,this.content=new RenderNode}function _resolveNodeSize(node,defaultSize){var nodeSize=node.getSize();return nodeSize?nodeSize[this.options.direction]:defaultSize}function _outputTransform(offset){return this.options.direction==HeaderFooterLayout.DIRECTION_X?Transform.translate(offset,0,0):Transform.translate(0,offset,0)}function _finalSize(directionSize,size){return this.options.direction==HeaderFooterLayout.DIRECTION_X?[directionSize,size[1]]:[size[0],directionSize]}var Entity=require("../core/Entity"),RenderNode=require("../core/RenderNode"),Transform=require("../core/Transform"),OptionsManager=require("../core/OptionsManager");HeaderFooterLayout.DIRECTION_X=0,HeaderFooterLayout.DIRECTION_Y=1,HeaderFooterLayout.DEFAULT_OPTIONS={direction:HeaderFooterLayout.DIRECTION_Y,headerSize:void 0,footerSize:void 0,defaultHeaderSize:0,defaultFooterSize:0},HeaderFooterLayout.prototype.render=function(){return this._entityId},HeaderFooterLayout.prototype.setOptions=function(options){return this._optionsManager.setOptions(options)},HeaderFooterLayout.prototype.commit=function(context){var transform=context.transform,origin=context.origin,size=context.size,opacity=context.opacity,headerSize=void 0!==this.options.headerSize?this.options.headerSize:_resolveNodeSize.call(this,this.header,this.options.defaultHeaderSize),footerSize=void 0!==this.options.footerSize?this.options.footerSize:_resolveNodeSize.call(this,this.footer,this.options.defaultFooterSize),contentSize=size[this.options.direction]-headerSize-footerSize;size&&(transform=Transform.moveThen([-size[0]*origin[0],-size[1]*origin[1],0],transform));var result=[{size:_finalSize.call(this,headerSize,size),target:this.header.render()},{transform:_outputTransform.call(this,headerSize),size:_finalSize.call(this,contentSize,size),target:this.content.render()},{transform:_outputTransform.call(this,headerSize+contentSize),size:_finalSize.call(this,footerSize,size),target:this.footer.render()}],nextSpec={transform:transform,opacity:opacity,size:size,target:result};return nextSpec},module.exports=HeaderFooterLayout},{"../core/Entity":5,"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15}],83:[function(require,module){function Lightbox(options){this.options=Object.create(Lightbox.DEFAULT_OPTIONS),this._optionsManager=new OptionsManager(this.options),options&&this.setOptions(options),this._showing=!1,this.nodes=[],this.transforms=[],this.states=[]}var Transform=require("../core/Transform"),Modifier=require("../core/Modifier"),RenderNode=require("../core/RenderNode"),Utility=require("../utilities/Utility"),OptionsManager=require("../core/OptionsManager"),Transitionable=require("../transitions/Transitionable"),TransitionableTransform=require("../transitions/TransitionableTransform");Lightbox.DEFAULT_OPTIONS={inTransform:Transform.scale(.001,.001,.001),inOpacity:0,inOrigin:[.5,.5],outTransform:Transform.scale(.001,.001,.001),outOpacity:0,outOrigin:[.5,.5],showTransform:Transform.identity,showOpacity:1,showOrigin:[.5,.5],inTransition:!0,outTransition:!0,overlap:!1},Lightbox.prototype.setOptions=function(options){return this._optionsManager.setOptions(options)},Lightbox.prototype.show=function(renderable,transition,callback){if(!renderable)return this.hide(callback);if(transition instanceof Function&&(callback=transition,transition=void 0),this._showing){if(!this.options.overlap)return void this.hide(this.show.bind(this,renderable,callback));this.hide()}this._showing=!0;var stateItem={transform:new TransitionableTransform(this.options.inTransform),origin:new Transitionable(this.options.inOrigin),opacity:new Transitionable(this.options.inOpacity)},transform=new Modifier({transform:stateItem.transform,opacity:stateItem.opacity,origin:stateItem.origin}),node=new RenderNode;node.add(transform).add(renderable),this.nodes.push(node),this.states.push(stateItem),this.transforms.push(transform);var _cb=callback?Utility.after(3,callback):void 0;transition||(transition=this.options.inTransition),stateItem.transform.set(this.options.showTransform,transition,_cb),stateItem.opacity.set(this.options.showOpacity,transition,_cb),stateItem.origin.set(this.options.showOrigin,transition,_cb)},Lightbox.prototype.hide=function(transition,callback){if(this._showing){this._showing=!1,transition instanceof Function&&(callback=transition,transition=void 0);var node=this.nodes[this.nodes.length-1],transform=this.transforms[this.transforms.length-1],stateItem=this.states[this.states.length-1],_cb=Utility.after(3,function(){this.nodes.splice(this.nodes.indexOf(node),1),this.states.splice(this.states.indexOf(stateItem),1),this.transforms.splice(this.transforms.indexOf(transform),1),callback&&callback.call(this)}.bind(this));transition||(transition=this.options.outTransition),stateItem.transform.set(this.options.outTransform,transition,_cb),stateItem.opacity.set(this.options.outOpacity,transition,_cb),stateItem.origin.set(this.options.outOrigin,transition,_cb)}},Lightbox.prototype.render=function(){for(var result=[],i=0;i<this.nodes.length;i++)result.push(this.nodes[i].render());return result},module.exports=Lightbox},{"../core/Modifier":9,"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15,"../transitions/Transitionable":71,"../transitions/TransitionableTransform":72,"../utilities/Utility":77}],84:[function(require,module){function RenderController(){View.apply(this,arguments),this._showing=-1,this._outgoingRenderables=[],this._nextRenderable=null,this._renderables=[],this._nodes=[],this._modifiers=[],this._states=[],this.inTransformMap=RenderController.DefaultMap.transform,this.inOpacityMap=RenderController.DefaultMap.opacity,this.inOriginMap=RenderController.DefaultMap.origin,this.outTransformMap=RenderController.DefaultMap.transform,this.outOpacityMap=RenderController.DefaultMap.opacity,this.outOriginMap=RenderController.DefaultMap.origin,this._output=[]}function _mappedState(map,state){return map(state.get())}var Modifier=require("../core/Modifier"),RenderNode=require("../core/RenderNode"),Transform=require("../core/Transform"),Transitionable=require("../transitions/Transitionable"),View=require("../core/View");RenderController.prototype=Object.create(View.prototype),RenderController.prototype.constructor=RenderController,RenderController.DEFAULT_OPTIONS={inTransition:!0,outTransition:!0,overlap:!0},RenderController.DefaultMap={transform:function(){return Transform.identity},opacity:function(progress){return progress},origin:null},RenderController.prototype.inTransformFrom=function(transform){if(transform instanceof Function)this.inTransformMap=transform;else{if(!transform||!transform.get)throw new Error("inTransformFrom takes only function or getter object");this.inTransformMap=transform.get.bind(transform)}return this},RenderController.prototype.inOpacityFrom=function(opacity){if(opacity instanceof Function)this.inOpacityMap=opacity;else{if(!opacity||!opacity.get)throw new Error("inOpacityFrom takes only function or getter object");this.inOpacityMap=opacity.get.bind(opacity)}return this},RenderController.prototype.inOriginFrom=function(origin){if(origin instanceof Function)this.inOriginMap=origin;
else{if(!origin||!origin.get)throw new Error("inOriginFrom takes only function or getter object");this.inOriginMap=origin.get.bind(origin)}return this},RenderController.prototype.outTransformFrom=function(transform){if(transform instanceof Function)this.outTransformMap=transform;else{if(!transform||!transform.get)throw new Error("inTransformFrom takes only function or getter object");this.outTransformMap=transform.get.bind(transform)}return this},RenderController.prototype.outOpacityFrom=function(opacity){if(opacity instanceof Function)this.outOpacityMap=opacity;else{if(!opacity||!opacity.get)throw new Error("inOpacityFrom takes only function or getter object");this.outOpacityMap=opacity.get.bind(opacity)}return this},RenderController.prototype.outOriginFrom=function(origin){if(origin instanceof Function)this.outOriginMap=origin;else{if(!origin||!origin.get)throw new Error("inOriginFrom takes only function or getter object");this.outOriginMap=origin.get.bind(origin)}return this},RenderController.prototype.show=function(renderable,transition,callback){if(!renderable)return this.hide(callback);if(transition instanceof Function&&(callback=transition,transition=null),this._showing>=0){if(!this.options.overlap)return void(this._nextRenderable?this._nextRenderable=renderable:(this._nextRenderable=renderable,this.hide(function(){this._nextRenderable===renderable&&this.show(this._nextRenderable,callback),this._nextRenderable=null})));this.hide(callback)}var state=null,renderableIndex=this._renderables.indexOf(renderable);if(renderableIndex>=0){this._showing=renderableIndex,state=this._states[renderableIndex],state.halt();var outgoingIndex=this._outgoingRenderables.indexOf(renderable);outgoingIndex>=0&&this._outgoingRenderables.splice(outgoingIndex,1)}else{state=new Transitionable(0);var modifier=new Modifier({transform:this.inTransformMap?_mappedState.bind(this,this.inTransformMap,state):null,opacity:this.inOpacityMap?_mappedState.bind(this,this.inOpacityMap,state):null,origin:this.inOriginMap?_mappedState.bind(this,this.inOriginMap,state):null}),node=new RenderNode;node.add(modifier).add(renderable),this._showing=this._nodes.length,this._nodes.push(node),this._modifiers.push(modifier),this._states.push(state),this._renderables.push(renderable)}transition||(transition=this.options.inTransition),state.set(1,transition,callback)},RenderController.prototype.hide=function(transition,callback){if(!(this._showing<0)){var index=this._showing;this._showing=-1,transition instanceof Function&&(callback=transition,transition=void 0);var node=this._nodes[index],modifier=this._modifiers[index],state=this._states[index],renderable=this._renderables[index];modifier.transformFrom(this.outTransformMap?_mappedState.bind(this,this.outTransformMap,state):null),modifier.opacityFrom(this.outOpacityMap?_mappedState.bind(this,this.outOpacityMap,state):null),modifier.originFrom(this.outOriginMap?_mappedState.bind(this,this.outOriginMap,state):null),this._outgoingRenderables.indexOf(renderable)<0&&this._outgoingRenderables.push(renderable),transition||(transition=this.options.outTransition),state.halt(),state.set(0,transition,function(node,modifier,state,renderable){if(this._outgoingRenderables.indexOf(renderable)>=0){var index=this._nodes.indexOf(node);this._nodes.splice(index,1),this._modifiers.splice(index,1),this._states.splice(index,1),this._renderables.splice(index,1),this._outgoingRenderables.splice(this._outgoingRenderables.indexOf(renderable),1),this._showing>=index&&this._showing--}callback&&callback.call(this)}.bind(this,node,modifier,state,renderable))}},RenderController.prototype.render=function(){var result=this._output;result.length>this._nodes.length&&result.splice(this._nodes.length);for(var i=0;i<this._nodes.length;i++)result[i]=this._nodes[i].render();return result},module.exports=RenderController},{"../core/Modifier":9,"../core/RenderNode":11,"../core/Transform":15,"../core/View":16,"../transitions/Transitionable":71}],85:[function(require,module){function ScrollContainer(options){this.options=Object.create(ScrollContainer.DEFAULT_OPTIONS),this._optionsManager=new OptionsManager(this.options),options&&this.setOptions(options),this.container=new ContainerSurface(this.options.container),this.scrollview=new Scrollview(this.options.scrollview),this.surface.add(this.scrollview),EventHandler.setInputHandler(this,this.scrollview),EventHandler.setOutputHandler(this,this.scrollview),this.scrollview.subscribe(this.container)}var ContainerSurface=require("../surfaces/ContainerSurface"),EventHandler=require("../core/EventHandler"),Scrollview=require("./Scrollview"),Utility=require("../utilities/Utility"),OptionsManager=require("../core/OptionsManager");ScrollContainer.DEFAULT_OPTIONS={container:{properties:{overflow:"hidden"}},scrollview:{direction:Utility.Direction.X}},ScrollContainer.prototype.setOptions=function(options){return this._optionsManager.setOptions(options)},ScrollContainer.prototype.sequenceFrom=function(){return this.scrollview.sequenceFrom.apply(this.scrollview,arguments)},ScrollContainer.prototype.render=function(){return this.container.render.apply(this.container,arguments)},module.exports=ScrollContainer},{"../core/EventHandler":7,"../core/OptionsManager":10,"../surfaces/ContainerSurface":62,"../utilities/Utility":77,"./Scrollview":88}],86:[function(require,module){function Scrollview(options){this.options=Object.create(Scrollview.DEFAULT_OPTIONS),this._optionsManager=new OptionsManager(this.options),this._node=null,this._physicsEngine=new PhysicsEngine,this._particle=new Particle,this._physicsEngine.addBody(this._particle),this.spring=new Spring({anchor:[0,0,0]}),this.drag=new Drag({forceFunction:Drag.FORCE_FUNCTIONS.QUADRATIC}),this.friction=new Drag({forceFunction:Drag.FORCE_FUNCTIONS.LINEAR}),this.sync=new GenericSync({direction:this.options.direction}),this._eventInput=new EventHandler,this._eventOutput=new EventHandler,this._eventInput.pipe(this.sync),this.sync.pipe(this._eventInput),EventHandler.setInputHandler(this,this._eventInput),EventHandler.setOutputHandler(this,this._eventOutput),this._touchCount=0,this._springState=0,this._onEdge=0,this._pageSpringPosition=0,this._edgeSpringPosition=0,this._touchVelocity=void 0,this._earlyEnd=!1,this._needsPaginationCheck=!1,this._scroller=new Scroller,this._scroller.positionFrom(this.getPosition.bind(this)),options&&this.setOptions(options),_bindEvents.call(this)}function _handleStart(event){this._touchCount=event.count,void 0===event.count&&(this._touchCount=1),_detachAgents.call(this),this.setVelocity(0),this._touchVelocity=0,this._earlyEnd=!1}function _handleMove(event){var velocity=-event.velocity,delta=-event.delta;this._onEdge&&event.slip&&(0>velocity&&this._onEdge<0||velocity>0&&this._onEdge>0?this._earlyEnd||(_handleEnd.call(this,event),this._earlyEnd=!0):this._earlyEnd&&Math.abs(velocity)>Math.abs(this.getVelocity())&&_handleStart.call(this,event)),this._earlyEnd||(this._touchVelocity=velocity,event.slip?this.setVelocity(velocity):this.setPosition(this.getPosition()+delta))}function _handleEnd(event){if(this._touchCount=event.count||0,!this._touchCount){_detachAgents.call(this),this._onEdge&&_setSpring.call(this,this._edgeSpringPosition,SpringStates.EDGE),_attachAgents.call(this);var velocity=-event.velocity,speedLimit=this.options.speedLimit;event.slip&&(speedLimit*=this.options.edgeGrip),-speedLimit>velocity?velocity=-speedLimit:velocity>speedLimit&&(velocity=speedLimit),this.setVelocity(velocity),this._touchVelocity=void 0,this._needsPaginationCheck=!0}}function _bindEvents(){this._eventInput.bindThis(this),this._eventInput.on("start",_handleStart),this._eventInput.on("update",_handleMove),this._eventInput.on("end",_handleEnd),this._scroller.on("edgeHit",function(data){this._edgeSpringPosition=data.position}.bind(this))}function _attachAgents(){this._springState?this._physicsEngine.attach([this.spring],this._particle):this._physicsEngine.attach([this.drag,this.friction],this._particle)}function _detachAgents(){this._springState=SpringStates.NONE,this._physicsEngine.detachAll()}function _nodeSizeForDirection(node){var direction=this.options.direction,nodeSize=(node.getSize()||this._scroller.getSize())[direction];return nodeSize||(nodeSize=this._scroller.getSize()[direction]),nodeSize}function _handleEdge(edgeDetected){!this._onEdge&&edgeDetected?(this.sync.setOptions({scale:this.options.edgeGrip}),this._touchCount||this._springState===SpringStates.EDGE||_setSpring.call(this,this._edgeSpringPosition,SpringStates.EDGE)):this._onEdge&&!edgeDetected&&(this.sync.setOptions({scale:1}),this._springState&&Math.abs(this.getVelocity())<.001&&(_detachAgents.call(this),_attachAgents.call(this))),this._onEdge=edgeDetected}function _handlePagination(){if(this._needsPaginationCheck&&!this._touchCount&&this._springState!==SpringStates.EDGE){var velocity=this.getVelocity();if(!(Math.abs(velocity)>=this.options.pageStopSpeed)){var position=this.getPosition(),velocitySwitch=Math.abs(velocity)>this.options.pageSwitchSpeed,nodeSize=_nodeSizeForDirection.call(this,this._node),positionNext=position>.5*nodeSize,velocityNext=velocity>0;positionNext&&!velocitySwitch||velocitySwitch&&velocityNext?this.goToNextPage():_setSpring.call(this,0,SpringStates.PAGE),this._needsPaginationCheck=!1}}}function _setSpring(position,springState){var springOptions;springState===SpringStates.EDGE?(this._edgeSpringPosition=position,springOptions={anchor:[this._edgeSpringPosition,0,0],period:this.options.edgePeriod,dampingRatio:this.options.edgeDamp}):springState===SpringStates.PAGE&&(this._pageSpringPosition=position,springOptions={anchor:[this._pageSpringPosition,0,0],period:this.options.pagePeriod,dampingRatio:this.options.pageDamp}),this.spring.setOptions(springOptions),springState&&!this._springState&&(_detachAgents.call(this),this._springState=springState,_attachAgents.call(this)),this._springState=springState}function _normalizeState(){for(var position=this.getPosition(),nodeSize=_nodeSizeForDirection.call(this,this._node),nextNode=this._node.getNext();position>nodeSize+TOLERANCE&&nextNode;)_shiftOrigin.call(this,-nodeSize),position-=nodeSize,this._scroller.sequenceFrom(nextNode),this._node=nextNode,nextNode=this._node.getNext(),nodeSize=_nodeSizeForDirection.call(this,this._node);for(var previousNodeSize,previousNode=this._node.getPrevious();-TOLERANCE>position&&previousNode;)previousNodeSize=_nodeSizeForDirection.call(this,previousNode),this._scroller.sequenceFrom(previousNode),this._node=previousNode,_shiftOrigin.call(this,previousNodeSize),position+=previousNodeSize,previousNode=this._node.getPrevious()}function _shiftOrigin(amount){this._edgeSpringPosition+=amount,this._pageSpringPosition+=amount,this.setPosition(this.getPosition()+amount),this._springState===SpringStates.EDGE?this.spring.setOptions({anchor:[this._edgeSpringPosition,0,0]}):this._springState===SpringStates.PAGE&&this.spring.setOptions({anchor:[this._pageSpringPosition,0,0]})}var Utility=require("../utilities/Utility"),PhysicsEngine=require("../physics/PhysicsEngine"),Particle=require("../physics/bodies/Particle"),Drag=require("../physics/forces/Drag"),Spring=require("../physics/forces/Spring"),GenericSync=require("../inputs/GenericSync"),EventHandler=require("../core/EventHandler"),OptionsManager=require("../core/OptionsManager"),ViewSequence=require("../core/ViewSequence"),Scroller=require("../views/Scroller"),TOLERANCE=.5;Scrollview.DEFAULT_OPTIONS={direction:Utility.Direction.Y,rails:!0,friction:.001,drag:1e-4,edgeGrip:.5,edgePeriod:300,edgeDamp:1,paginated:!1,pagePeriod:500,pageDamp:.8,pageStopSpeed:10,pageSwitchSpeed:.5,speedLimit:10};var SpringStates={NONE:0,EDGE:1,PAGE:2};Scrollview.prototype.outputFrom=function(){return this._scroller.outputFrom.apply(this._scroller,arguments)},Scrollview.prototype.getPosition=function(){return this._particle.getPosition1D()},Scrollview.prototype.setPosition=function(x){this._particle.setPosition1D(x)},Scrollview.prototype.getVelocity=function(){return this._touchCount?this._touchVelocity:this._particle.getVelocity1D()},Scrollview.prototype.setVelocity=function(v){this._particle.setVelocity1D(v)},Scrollview.prototype.setOptions=function(options){void 0!==options.direction&&("x"===options.direction?options.direction=Utility.Direction.X:"y"===options.direction&&(options.direction=Utility.Direction.Y)),this._scroller.setOptions(options),this._optionsManager.setOptions(options),void 0===this.options.margin&&(this.options.margin=1e3),this.drag.setOptions({strength:this.options.drag}),this.friction.setOptions({strength:this.options.friction}),this.spring.setOptions({period:this.options.edgePeriod,dampingRatio:this.options.edgeDamp}),this.sync.setOptions({rails:this.options.rails,direction:this.options.direction===Utility.Direction.X?GenericSync.DIRECTION_X:GenericSync.DIRECTION_Y})},Scrollview.prototype.goToPreviousPage=function(){if(!this._node)return null;var previousNode=this._node.getPrevious();if(previousNode){var currentPosition=this.getPosition(),previousNodeSize=_nodeSizeForDirection.call(this,previousNode);this._scroller.sequenceFrom(previousNode),this._node=previousNode;var previousSpringPosition=TOLERANCE>currentPosition?-previousNodeSize:0;_setSpring.call(this,previousSpringPosition,SpringStates.PAGE),_shiftOrigin.call(this,previousNodeSize)}return this._eventOutput.emit("pageChange",{direction:-1}),previousNode},Scrollview.prototype.goToNextPage=function(){if(!this._node)return null;var nextNode=this._node.getNext();if(nextNode){var currentPosition=this.getPosition(),currentNodeSize=_nodeSizeForDirection.call(this,this._node),nextNodeSize=_nodeSizeForDirection.call(this,nextNode);this._scroller.sequenceFrom(nextNode),this._node=nextNode;var nextSpringPosition=currentPosition>currentNodeSize-TOLERANCE?currentNodeSize+nextNodeSize:currentNodeSize;_setSpring.call(this,nextSpringPosition,SpringStates.PAGE),_shiftOrigin.call(this,-currentNodeSize)}return this._eventOutput.emit("pageChange",{direction:1}),nextNode},Scrollview.prototype.sequenceFrom=function(node){return node instanceof Array&&(node=new ViewSequence({array:node})),this._node=node,this._scroller.sequenceFrom(node)},Scrollview.prototype.getSize=function(){return this._scroller.getSize.apply(this._scroller,arguments)},Scrollview.prototype.render=function(){return this._node?(_normalizeState.call(this),_handleEdge.call(this,this._scroller.onEdge()),this.options.paginated&&_handlePagination.call(this),this._scroller.render()):null},module.exports=Scrollview},{"../core/EventHandler":7,"../core/OptionsManager":10,"../core/ViewSequence":17,"../inputs/GenericSync":22,"../physics/PhysicsEngine":40,"../physics/bodies/Particle":43,"../physics/forces/Drag":53,"../physics/forces/Spring":58,"../utilities/Utility":77,"../views/Scroller":87}],87:[function(require,module){function Scroller(options){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),this._optionsManager=new OptionsManager(this.options),options&&this._optionsManager.setOptions(options),this._node=null,this._position=0,this._positionOffset=0,this._positionGetter=null,this._outputFunction=null,this._masterOutputFunction=null,this.outputFrom(),this._onEdge=0,this.group=new Group,this.group.add({render:_innerRender.bind(this)}),this._entityId=Entity.register(this),this._size=[void 0,void 0],this._contextSize=[void 0,void 0],this._eventInput=new EventHandler,this._eventOutput=new EventHandler,EventHandler.setInputHandler(this,this._eventInput),EventHandler.setOutputHandler(this,this._eventOutput)}function _sizeForDir(size){size||(size=this._contextSize);var dimension=this.options.direction===Utility.Direction.X?0:1;return void 0===size[dimension]?this._contextSize[dimension]:size[dimension]}function _output(node,offset,target){var size=node.getSize?node.getSize():this._contextSize,transform=this._outputFunction(offset);return target.push({transform:transform,target:node.render()}),_sizeForDir.call(this,size)}function _getClipSize(){return this.options.clipSize?this.options.clipSize:_sizeForDir.call(this,this._contextSize)}function _normalizeState(){for(var nodeSize=_sizeForDir.call(this,this._node.getSize()),nextNode=this._node&&this._node.getNext?this._node.getNext():null;nextNode&&this._position+this._positionOffset>=nodeSize;)this._positionOffset-=nodeSize,this._node=nextNode,nodeSize=_sizeForDir.call(this,this._node.getSize()),nextNode=this._node&&this._node.getNext?this._node.getNext():null;for(var prevNode=this._node&&this._node.getPrevious?this._node.getPrevious():null;prevNode&&this._position+this._positionOffset<0;){var prevNodeSize=_sizeForDir.call(this,prevNode.getSize());this._positionOffset+=prevNodeSize,this._node=prevNode,prevNode=this._node&&this._node.getPrevious?this._node.getPrevious():null}}function _innerRender(){var size=null,position=this._position,result=[];this._onEdge=0;for(var offset=-this._positionOffset,clipSize=_getClipSize.call(this),currNode=this._node;currNode&&offset-position<clipSize+this.options.margin;)offset+=_output.call(this,currNode,offset,result),currNode=currNode.getNext?currNode.getNext():null;var sizeNode=this._node,nodesSize=_sizeForDir.call(this,sizeNode.getSize());if(clipSize>offset){for(;sizeNode&&clipSize>nodesSize;)sizeNode=sizeNode.getPrevious(),sizeNode&&(nodesSize+=_sizeForDir.call(this,sizeNode.getSize()));for(sizeNode=this._node;sizeNode&&clipSize>nodesSize;)sizeNode=sizeNode.getNext(),sizeNode&&(nodesSize+=_sizeForDir.call(this,sizeNode.getSize()))}var edgeSize=void 0!==nodesSize&&clipSize>nodesSize?nodesSize:clipSize;for(!currNode&&edgeSize>=offset-position?(this._onEdge=1,this._eventOutput.emit("edgeHit",{position:offset-edgeSize})):!this._node.getPrevious()&&0>=position&&(this._onEdge=-1,this._eventOutput.emit("edgeHit",{position:0})),currNode=this._node&&this._node.getPrevious?this._node.getPrevious():null,offset=-this._positionOffset,currNode&&(size=currNode.getSize?currNode.getSize():this._contextSize,offset-=_sizeForDir.call(this,size));currNode&&offset-position>-(_getClipSize.call(this)+this.options.margin);)_output.call(this,currNode,offset,result),currNode=currNode.getPrevious?currNode.getPrevious():null,currNode&&(size=currNode.getSize?currNode.getSize():this._contextSize,offset-=_sizeForDir.call(this,size));return _normalizeState.call(this),result}var Entity=require("../core/Entity"),Group=require("../core/Group"),OptionsManager=require("../core/OptionsManager"),Transform=require("../core/Transform"),Utility=require("../utilities/Utility"),ViewSequence=require("../core/ViewSequence"),EventHandler=require("../core/EventHandler");Scroller.DEFAULT_OPTIONS={direction:Utility.Direction.Y,margin:0,clipSize:void 0},Scroller.prototype.setOptions=function(options){return this._optionsManager.setOptions(options)},Scroller.prototype.onEdge=function(){return this._onEdge},Scroller.prototype.outputFrom=function(fn,masterFn){fn||(fn=function(offset){return this.options.direction===Utility.Direction.X?Transform.translate(offset,0):Transform.translate(0,offset)}.bind(this),masterFn||(masterFn=fn)),this._outputFunction=fn,this._masterOutputFunction=masterFn?masterFn:function(offset){return Transform.inverse(fn(-offset))}},Scroller.prototype.positionFrom=function(position){position instanceof Function?this._positionGetter=position:position&&position.get?this._positionGetter=position.get.bind(position):(this._positionGetter=null,this._position=position),this._positionGetter&&(this._position=this._positionGetter.call(this))},Scroller.prototype.sequenceFrom=function(node){node instanceof Array&&(node=new ViewSequence({array:node})),this._node=node,this._positionOffset=0},Scroller.prototype.getSize=function(actual){return actual?this._contextSize:this._size},Scroller.prototype.render=function(){return this._node?(this._positionGetter&&(this._position=this._positionGetter.call(this)),this._entityId):null},Scroller.prototype.commit=function(context){var transform=context.transform,opacity=context.opacity,origin=context.origin,size=context.size;this.options.clipSize||size[0]===this._contextSize[0]&&size[1]===this._contextSize[1]||(this._onEdge=0,this._contextSize=size,this.options.direction===Utility.Direction.X?(this._size[0]=_getClipSize.call(this),this._size[1]=void 0):(this._size[0]=void 0,this._size[1]=_getClipSize.call(this)));var scrollTransform=this._masterOutputFunction(-this._position);return{transform:Transform.multiply(transform,scrollTransform),opacity:opacity,origin:origin,target:this.group.render()}},module.exports=Scroller},{"../core/Entity":5,"../core/EventHandler":7,"../core/Group":8,"../core/OptionsManager":10,"../core/Transform":15,"../core/ViewSequence":17,"../utilities/Utility":77}],88:[function(require,module){module.exports=require(86)},{"../core/EventHandler":7,"../core/OptionsManager":10,"../core/ViewSequence":17,"../inputs/GenericSync":22,"../physics/PhysicsEngine":40,"../physics/bodies/Particle":43,"../physics/forces/Drag":53,"../physics/forces/Spring":58,"../utilities/Utility":77,"../views/Scroller":87}],89:[function(require,module){function SequentialLayout(options){this._items=null,this._size=null,this._outputFunction=SequentialLayout.DEFAULT_OUTPUT_FUNCTION,this.options=Object.create(this.constructor.DEFAULT_OPTIONS),this.optionsManager=new OptionsManager(this.options),options&&this.setOptions(options)}var OptionsManager=require("../core/OptionsManager"),Transform=require("../core/Transform"),ViewSequence=require("../core/ViewSequence"),Utility=require("../utilities/Utility");SequentialLayout.DEFAULT_OPTIONS={direction:Utility.Direction.Y,defaultItemSize:[50,50]},SequentialLayout.DEFAULT_OUTPUT_FUNCTION=function(input,offset){var transform=this.options.direction===Utility.Direction.X?Transform.translate(offset,0):Transform.translate(0,offset);return{transform:transform,target:input.render()}},SequentialLayout.prototype.getSize=function(){return this._size||this.render(),this._size},SequentialLayout.prototype.sequenceFrom=function(items){return items instanceof Array&&(items=new ViewSequence(items)),this._items=items,this},SequentialLayout.prototype.setOptions=function(){return this.optionsManager.setOptions.apply(this.optionsManager,arguments),this},SequentialLayout.prototype.setOutputFunction=function(outputFunction){return this._outputFunction=outputFunction,this},SequentialLayout.prototype.render=function(){for(var length=0,girth=0,lengthDim=this.options.direction===Utility.Direction.X?0:1,girthDim=this.options.direction===Utility.Direction.X?1:0,currentNode=this._items,result=[];currentNode;){var itemSize,item=currentNode.get();item&&item.getSize&&(itemSize=item.getSize()),itemSize||(itemSize=this.options.defaultItemSize),itemSize[girthDim]!==!0&&(girth=Math.max(girth,itemSize[girthDim]));var output=this._outputFunction.call(this,item,length,result.length);result.push(output),itemSize[lengthDim]&&itemSize[lengthDim]!==!0&&(length+=itemSize[lengthDim]),currentNode=currentNode.getNext()}return girth||(girth=void 0),this._size||(this._size=[0,0]),this._size[lengthDim]=length,this._size[girthDim]=girth,{size:this.getSize(),target:result}},module.exports=SequentialLayout},{"../core/OptionsManager":10,"../core/Transform":15,"../core/ViewSequence":17,"../utilities/Utility":77}],90:[function(require,module){function NavigationBar(){View.apply(this,arguments),this.title=new Surface({classes:this.options.classes,content:this.options.content}),this.back=new Surface({size:[this.options.size[1],this.options.size[1]],classes:this.options.classes,content:this.options.backContent}),this.back.on("click",function(){this._eventOutput.emit("back",{})}.bind(this)),this.more=new Surface({size:[this.options.size[1],this.options.size[1]],classes:this.options.classes,content:this.options.moreContent}),this.more.on("click",function(){this._eventOutput.emit("more",{})}.bind(this)),this.layout=new Scene({id:"master",size:this.options.size,target:[{transform:Transform.inFront,origin:[0,.5],target:this.back},{origin:[.5,.5],target:this.title},{transform:Transform.inFront,origin:[1,.5],target:this.more}]}),this._add(this.layout),this.optionsManager.on("change",function(event){var key=event.id,data=event.value;"size"===key?(this.layout.id.master.setSize(data),this.title.setSize(data),this.back.setSize([data[1],data[1]]),this.more.setSize([data[1],data[1]])):"backClasses"===key?this.back.setOptions({classes:this.options.classes.concat(this.options.backClasses)}):"backContent"===key?this.back.setContent(this.options.backContent):"classes"===key?(this.title.setOptions({classes:this.options.classes}),this.back.setOptions({classes:this.options.classes.concat(this.options.backClasses)}),this.more.setOptions({classes:this.options.classes.concat(this.options.moreClasses)})):"content"===key?this.setContent(this.options.content):"moreClasses"===key?this.more.setOptions({classes:this.options.classes.concat(this.options.moreClasses)}):"moreContent"===key&&this.more.setContent(this.options.content)}.bind(this))}var Scene=require("../core/Scene"),Surface=require("../core/Surface"),Transform=require("../core/Transform"),View=require("../core/View");NavigationBar.prototype=Object.create(View.prototype),NavigationBar.prototype.constructor=NavigationBar,NavigationBar.DEFAULT_OPTIONS={size:[void 0,50],backClasses:["back"],backContent:"&#x25c0;",classes:["navigation"],content:"",moreClasses:["more"],moreContent:"&#x271a;"},NavigationBar.prototype.setContent=function(content){return this.title.setContent(content)},module.exports=NavigationBar},{"../core/Scene":12,"../core/Surface":14,"../core/Transform":15,"../core/View":16}],91:[function(require,module){function Slider(options){this.options={size:[200,60],indicatorSize:[200,30],labelSize:[200,30],range:[0,1],precision:2,defaultValue:0,label:"",fillColor:"rgba(170, 170, 170, 1)"},options&&this.setOptions(options),this.value=this.options.defaultValue,this.indicator=new CanvasSurface({size:this.options.indicatorSize}),this.indicator.addClass("slider-back"),this.label=new Surface({size:this.options.labelSize,content:this.options.label,classes:["slider-label"]}),this.label.setProperties({"pointer-events":"none"}),this.eventOutput=new EventHandler,this.eventInput=new EventHandler,EventHandler.setInputHandler(this,this.eventInput),EventHandler.setOutputHandler(this,this.eventOutput),this.sync=new GenericSync(this.get.bind(this),{scale:(this.options.range[1]-this.options.range[0])/this.options.indicatorSize[0],direction:GenericSync.DIRECTION_X}),this.eventInput.on("update",function(data){this.set(data.p)}.bind(this)),this.indicator.pipe(this.sync).pipe(this.eventInput),this._drawPos=0,_updateLabel.call(this)}function _updateLabel(){this.label.setContent(this.options.label+'<span style="float: right">'+this.get().toFixed(this.options.precision)+"</span>")}var Surface=require("../core/Surface"),CanvasSurface=require("../surfaces/CanvasSurface"),GenericSync=require("../inputs/GenericSync"),Transform=require("../core/Transform"),EventHandler=require("../core/EventHandler");Slider.prototype.getOptions=function(){return this.options},Slider.prototype.setOptions=function(options){void 0!==options.size&&(this.options.size=options.size),void 0!==options.indicatorSize&&(this.options.indicatorSize=options.indicatorSize),void 0!==options.labelSize&&(this.options.labelSize=options.labelSize),void 0!==options.range&&(this.options.range=options.range),void 0!==options.precision&&(this.options.precision=options.precision),void 0!==options.defaultValue&&(this.options.defaultValue=options.defaultValue),void 0!==options.label&&(this.options.label=options.label),void 0!==options.fillColor&&(this.options.fillColor=options.fillColor)},Slider.prototype.get=function(){return this.value},Slider.prototype.set=function(val){this.value=Math.min(Math.max(this.options.range[0],val),this.options.range[1]),_updateLabel.call(this),this.eventOutput.emit("change",{value:this.get(),range:this.options.range})},Slider.prototype.getSize=function(){return this.options.size},Slider.prototype.render=function(){var range=this.options.range,fillSize=Math.floor((this.get()-range[0])/(range[1]-range[0])*this.options.indicatorSize[0]);if(fillSize<this._drawPos)this.indicator.getContext("2d").clearRect(fillSize,0,this._drawPos-fillSize+1,this.options.indicatorSize[1]);else if(fillSize>this._drawPos){var ctx=this.indicator.getContext("2d");ctx.fillStyle=this.options.fillColor,ctx.fillRect(this._drawPos-1,0,fillSize-this._drawPos+1,this.options.indicatorSize[1])}return this._drawPos=fillSize,{size:this.options.size,target:[{origin:[.5,0],target:this.indicator.render()},{transform:Transform.translate(0,0,1),origin:[.5,1],target:this.label.render()}]}},module.exports=Slider},{"../core/EventHandler":7,"../core/Surface":14,"../core/Transform":15,"../inputs/GenericSync":22,"../surfaces/CanvasSurface":61}],92:[function(require,module){function TabBar(){View.apply(this,arguments),this.layout=new GridLayout,this.buttons=[],this._buttonIds={},this._buttonCallbacks={},this.layout.sequenceFrom(this.buttons),this._add(this.layout),this._optionsManager.on("change",_updateOptions.bind(this))}function _updateOptions(data){var id=data.id,value=data.value;if("direction"===id)this.layout.setOptions({dimensions:_resolveGridDimensions.call(this.buttons.length,this.options.direction)});else if("buttons"===id)for(var i in this.buttons)this.buttons[i].setOptions(value);else if("sections"===id)for(var sectionId in this.options.sections)this.defineSection(sectionId,this.options.sections[sectionId])}function _resolveGridDimensions(count,direction){return direction===Utility.Direction.X?[count,1]:[1,count]}var Utility=require("../utilities/Utility"),View=require("../core/View"),GridLayout=require("../views/GridLayout"),ToggleButton=require("./ToggleButton");TabBar.prototype=Object.create(View.prototype),TabBar.prototype.constructor=TabBar,TabBar.DEFAULT_OPTIONS={sections:[],widget:ToggleButton,size:[void 0,50],direction:Utility.Direction.X,buttons:{toggleMode:ToggleButton.ON}},TabBar.prototype.defineSection=function(id,content){var button,i=this._buttonIds[id];if(void 0===i){i=this.buttons.length,this._buttonIds[id]=i;var widget=this.options.widget;button=new widget,this.buttons[i]=button,this.layout.setOptions({dimensions:_resolveGridDimensions(this.buttons.length,this.options.direction)})}else button=this.buttons[i],button.unbind("select",this._buttonCallbacks[id]);this.options.buttons&&button.setOptions(this.options.buttons),button.setOptions(content),this._buttonCallbacks[id]=this.select.bind(this,id),button.on("select",this._buttonCallbacks[id])},TabBar.prototype.select=function(id){var btn=this._buttonIds[id];this.buttons[btn]&&this.buttons[btn].isSelected()?this._eventOutput.emit("select",{id:id}):this.buttons[btn]&&this.buttons[btn].select();for(var i=0;i<this.buttons.length;i++)i!==btn&&this.buttons[i].deselect()},module.exports=TabBar},{"../core/View":16,"../utilities/Utility":77,"../views/GridLayout":81,"./ToggleButton":93}],93:[function(require,module){function ToggleButton(options){this.options={content:"",offClasses:["off"],onClasses:["on"],size:void 0,outTransition:{curve:"easeInOut",duration:300},inTransition:{curve:"easeInOut",duration:300},toggleMode:ToggleButton.TOGGLE,crossfade:!0},this._eventOutput=new EventHandler,EventHandler.setOutputHandler(this,this._eventOutput),this.offSurface=new Surface,this.offSurface.on("click",function(){this.options.toggleMode!==ToggleButton.OFF&&this.select()}.bind(this)),this.offSurface.pipe(this._eventOutput),this.onSurface=new Surface,this.onSurface.on("click",function(){this.options.toggleMode!==ToggleButton.ON&&this.deselect()}.bind(this)),this.onSurface.pipe(this._eventOutput),this.arbiter=new RenderController({overlap:this.options.crossfade}),this.deselect(),options&&this.setOptions(options)}var Surface=require("../core/Surface"),EventHandler=require("../core/EventHandler"),RenderController=require("../views/RenderController");ToggleButton.OFF=0,ToggleButton.ON=1,ToggleButton.TOGGLE=2,ToggleButton.prototype.select=function(){this.selected=!0,this.arbiter.show(this.onSurface,this.options.inTransition),this._eventOutput.emit("select")
},ToggleButton.prototype.deselect=function(){this.selected=!1,this.arbiter.show(this.offSurface,this.options.outTransition),this._eventOutput.emit("deselect")},ToggleButton.prototype.isSelected=function(){return this.selected},ToggleButton.prototype.setOptions=function(options){void 0!==options.content&&(this.options.content=options.content,this.offSurface.setContent(this.options.content),this.onSurface.setContent(this.options.content)),options.offClasses&&(this.options.offClasses=options.offClasses,this.offSurface.setClasses(this.options.offClasses)),options.onClasses&&(this.options.onClasses=options.onClasses,this.onSurface.setClasses(this.options.onClasses)),void 0!==options.size&&(this.options.size=options.size,this.onSurface.setSize(this.options.size),this.offSurface.setSize(this.options.size)),void 0!==options.toggleMode&&(this.options.toggleMode=options.toggleMode),void 0!==options.outTransition&&(this.options.outTransition=options.outTransition),void 0!==options.inTransition&&(this.options.inTransition=options.inTransition),void 0!==options.crossfade&&(this.options.crossfade=options.crossfade,this.arbiter.setOptions({overlap:this.options.crossfade}))},ToggleButton.prototype.getSize=function(){return this.options.size},ToggleButton.prototype.render=function(){return this.arbiter.render()},module.exports=ToggleButton},{"../core/EventHandler":7,"../core/Surface":14,"../views/RenderController":84}]},{},[1]);
//# sourceMappingURL=./famous.js.map